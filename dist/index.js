"use strict";var Et=Object.create;var x=Object.defineProperty;var St=Object.getOwnPropertyDescriptor;var Tt=Object.getOwnPropertyNames;var Rt=Object.getPrototypeOf,kt=Object.prototype.hasOwnProperty;var T=(t,e)=>{for(var s in e)x(t,s,{get:e[s],enumerable:!0})},xe=(t,e,s,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Tt(e))!kt.call(t,r)&&r!==s&&x(t,r,{get:()=>e[r],enumerable:!(a=St(e,r))||a.enumerable});return t};var M=(t,e,s)=>(s=t!=null?Et(Rt(t)):{},xe(e||!t||!t.__esModule?x(s,"default",{value:t,enumerable:!0}):s,t)),Mt=t=>xe(x({},"__esModule",{value:!0}),t);var fr={};T(fr,{bot:()=>m,connection:()=>c,gradients:()=>S});module.exports=Mt(fr);var ze=require("telegraf");var Ce=M(require("dotenv"));Ce.default.config();var{TOKEN:Ae,PASSWORD:Le,SQLHOST:We,SQLUSER:He,SQLDATABASE:Ge,SQLPASSWORD:Qe,HTMLSTART1:Oe,HTMLSTART2:Fe,HTMLEND:je}=process.env;if(!Ae||!Le||!We||!He||!Ge||!Qe||!Oe||!Fe||!je)throw new Error("Missing environment variables");var Dt=new Map().set(-1,"free").set(0,"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D, \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B \u043D\u0435 \u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D").set(1,"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D, \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B \u0447\u0430\u0441\u0442\u0438\u0447\u043D\u043E \u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D").set(2,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 1 \u043C\u0435\u0441\u044F\u0446").set(3,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 2 \u043C\u0435\u0441\u044F\u0446\u0430").set(4,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 3 \u043C\u0435\u0441\u044F\u0446\u0430").set(5,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 4 \u043C\u0435\u0441\u044F\u0446\u0430").set(6,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 5 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(7,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 6 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(8,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 7 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(9,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 8 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(10,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 9 \u043C\u0435\u0441\u044F\u0446\u0435\u0432"),Pt={args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--headless","--no-zygote","--disable-gpu"],headless:!0,ignoreHTTPSErrors:!0},y={TOKEN:Ae,PASSWORD:Le,SQLHOST:We,SQLUSER:He,SQLDATABASE:Ge,SQLPASSWORD:Qe,HTMLSTART1:Oe,HTMLSTART2:Fe,HTMLEND:je,puppeteer:Pt,payment:Dt};var Ze=M(require("mysql"));var C=class{constructor(e){this.css=e.css}},A=class{constructor(){}get light(){return this._light[Math.floor(Math.random()*(this._light.length-1))].css}get dark(){return this._dark[Math.floor(Math.random()*(this._dark.length-1))].css}async load(){let e=await Ke.light(),s=await Ke.dark();return this._light=e.map(a=>new C(a)),this._dark=s.map(a=>new C(a)),this}},Ke={light:async()=>new Promise(async function(t,e){c.query("SELECT * FROM gradients",async(s,a)=>{if(s)throw new Error("SQL ERROR in Gradients");t(a)})}),dark:async()=>new Promise(async function(t,e){c.query("SELECT * FROM replGradients",async(s,a)=>{if(s)throw new Error("SQL ERROR in Gradients");t(a)})})};var Ut={host:y.SQLHOST,user:y.SQLUSER,database:y.SQLDATABASE,password:y.SQLPASSWORD},L=class{constructor(){this.bot=new ze.Telegraf(y.TOKEN),this.connection=Ze.default.createPool(Ut),this.bot.launch(),this.bot.telegram.sendMessage(6018898378,"\u0411\u043E\u0442 \u0437\u0430\u043F\u0443\u0449\u0435\u043D!").then(e=>setTimeout(()=>{this.bot.telegram.deleteMessage(e.chat.id,e.message_id).catch(s=>console.log(s))},30*1e3)).catch(e=>{console.log(e)})}async addGradients(){return this.gradients=await new A().load(),this.gradients}};var ee=require("cron");var ae={};T(ae,{regenerate:()=>It,sender:()=>Nt});var Je=M(require("xlsx")),Ye=require("telegraf");var W=class{constructor(e,s,a,r,n,i){this._bots=e,this._groupName=s,this._id=a,this._name=r,this._role=i,this._userName=n}get bots(){return this._bots}get groupName(){return this._groupName}get id(){return this._id}get name(){return this._name}get role(){return this._role}get userName(){return this._userName}set groupName(e){this._groupName=e,c.query(`UPDATE users SET groupName = '${e}' WHERE userId = '${this.id}'`)}set name(e){this._name=e,c.query(`UPDATE users SET name = '${e}' WHERE userId = '${this._id}'`)}set userName(e){this._userName=e}};var H=class{constructor(e,s,a,r){this.id=e,this._count=s,this._day=a,this._lastDate=r}get count(){return this._count}get day(){return this._day}get lastDate(){return this._lastDate}set count(e){this._count=e,c.query(`UPDATE users SET duty = '${e}' WHERE userId = '${this.id}'`)}set day(e){this._day=e,c.query(`UPDATE users SET scheduleDate = '${e}' WHERE userId = '${this.id}'`)}set lastDate(e){this._lastDate=e,c.query(`UPDATE users SET dutyDate = '${e}' WHERE userId = '${this.id}'`)}};var G=class{constructor(e,s,a,r,n){this.id=e,this._paid=s,this._price=a,this._status=r,this.referral=n}get paid(){return this._paid}get price(){return this._price}get status(){return this._status}set paid(e){this._paid=e,c.query(`UPDATE users SET paidWhenever = '${e}' WHERE userId = '${this.id}'`)}set status(e){this._status=e,c.query(`UPDATE users SET payment = '${e}' WHERE userId = '${this.id}'`)}};var Q=class{constructor(e,s,a,r,n,i){this.id=e,this._duty=s,this._lightMode=a,this._replacement=r,this._schedule=n,this._theme=i}get theme(){return this._theme}get schedule(){return this._schedule}get replacement(){return this._replacement}get lightMode(){return this._lightMode}get duty(){return this._duty}set theme(e){let s=e.match(/\.(jpeg|jpg|png)$/)!=null?e:this._theme,a=e==="standard"?"standard":s;this._theme=a,c.query(`UPDATE users SET theme = '${a}' WHERE userId = '${this.id}'`)}set schedule(e){this._schedule=e,c.query(`UPDATE users SET settingsSchedule = '${e}' WHERE userId = '${this.id}'`)}set replacement(e){this._replacement=e,c.query(`UPDATE users SET settingsReplacement = '${e}' WHERE userId = '${this.id}'`)}set lightMode(e){this._lightMode=e,c.query(`UPDATE users SET lightMode = '${e}' WHERE userId = '${this.id}'`)}set duty(e){this._duty=e,c.query(`UPDATE users SET settingsDuty = '${e}' WHERE userId = '${this.id}'`)}switchSchedule(){let e=this._schedule==="on"?"off":"on";this._schedule=e,c.query(`UPDATE users SET settingsSchedule = '${e}' WHERE userId = '${this.id}'`)}switchReplacement(){let e=this._replacement==="on"?"off":"on";this._replacement=e,c.query(`UPDATE users SET settingsReplacement = '${e}' WHERE userId = '${this.id}'`)}switchLightMode(){let e=this._lightMode===0?1:0;this._lightMode=e,c.query(`UPDATE users SET lightMode = '${e}' WHERE userId = '${this.id}'`)}switchDuty(){let e=this._duty==="on"?"off":"on";this._duty=e,c.query(`UPDATE users SET settingsDuty = '${e}' WHERE userId = '${this.id}'`)}};var O=class{constructor(e,s,a,r){this.id=e,this._key=a,this._status=r}async load(){let e=await Ve.agents(this.id),s=await Ve.user(this.id);return this._agents=e,this._agentsApprove=e.filter(a=>a.status==="true").length,this._user=s,this}get agentsApprove(){return this._agentsApprove}get agents(){return this._agents}get user(){return this._user}get key(){return this._key}get status(){return this._status}insertReferral(e){this._agents.push({agentId:this.id,userId:e,refKey:this._key,status:"true"}),c.query(`INSERT INTO referrals (agentId,userId,refKey) VALUES('${this.id}','${e}','${this._key}')`)}set status(e){this._status=e,c.query(`UPDATE users SET refKeyStatus = '${e}' WHERE userId = '${this.id}'`)}setUserStatus(e){this._user.status=e,c.query(`UPDATE referrals SET status = '${e}' WHERE userId = '${this.id}'`)}set agentsApprove(e){this._agentsApprove=e,c.query(`UPDATE users SET refAgents = '${e}' WHERE userId = '${this.id}'`)}},Ve={agents:async t=>new Promise(async function(e,s){c.query(`SELECT * FROM referrals WHERE agentId = '${t}'`,(a,r)=>{if(a)throw new Error("SQL ERROR in UserReferral");e(r)})}),user:async t=>new Promise(async function(e,s){c.query(`SELECT * FROM referrals WHERE userId = '${t}'`,(a,r)=>{if(a)throw new Error("SQL ERROR in UserReferral");e(r[0])})})};var u=class{constructor(){}async load(e,s){if(s?.res){let r=await a(s.res);return this.settings=r.settings,this.info=r.info,this.duty=r.duty,this.payment=r.payment,this}else if(s?.refKey){let r=await re.refKey(s.refKey),n=await a(r);return this.settings=n.settings,this.info=n.info,this.duty=n.duty,this.payment=n.payment,this}else{let r=await re.userId(e),n=await a(r);return this.settings=n.settings,this.info=n.info,this.duty=n.duty,this.payment=n.payment,this}async function a(r){let n=await new O(e,r.refAgents,r.refKey,r.refKeyStatus).load();return{duty:new H(e,r.duty,r.scheduleDate,r.dutyDate),info:new W(r.groupBots,r.groupName,e,r.name,r.userName,r.role),payment:new G(e,r.paidWhenever,r.price,r.payment,n),settings:new Q(e,r.settingsDuty,r.lightMode,r.settingsReplacement,r.settingsSchedule,r.theme)}}}},$=class{constructor(){}async createUser(e,s,a,r,n){c.query(`INSERT INTO users (userId,userName,payment,name,refKey) values('${e}','${s}','${a}','${r}','${n}')`,async(i,f)=>{if(i)throw new Error("SQL ERROR in Users");this.all.push(await new u().load(e,{res:f[0]}))})}getUser(e){return this.all.find(s=>s.info.id===e)}async load(){let e=await re.all();return this.all=await Promise.all(e.map(async s=>await new u().load(s.userId,s))),this}},re={refKey:async t=>new Promise(async function(e,s){c.query(`SELECT * FROM users WHERE refKey = '${t}'`,async(a,r)=>{if(a)throw new Error("SQL ERROR in Users");if(r[0])e(r[0]);else throw new Error("USER not found")})}),userId:async t=>new Promise(async function(e,s){c.query(`SELECT * FROM users WHERE userId = '${t}'`,async(a,r)=>{if(a)throw new Error("SQL ERROR in USER");if(r[0])e(r[0]);else throw new Error("USER not found")})}),all:async()=>new Promise(async function(t,e){c.query("SELECT * FROM users",async(s,a)=>{if(s)throw new Error("SQL ERROR in Users");t(a)})})};var R=class{constructor(){}async load(e,s,a,r){if(s&&a&&r)this.name=e,this.next=s,this._replacement=a,this._schedule=r;else{let f=await F.groups(e);this.name=f.name,this.next=f.next,this._replacement=f.replacement,this._schedule=f.schedule}let n=await F.users(e),i=await F.duty(e);return this._users=await Promise.all(n.map(async f=>new u().load(f.userId,f))),this._duties=i,this}get replacement(){return this._replacement}get schedule(){return this._schedule}get users(){return this._users}get duties(){return this._duties}getUser(e){return this._users.find(s=>s.info.id===e)}getDuty(e,s){return this._duties.filter(a=>a.date>e&&a.date<s)}set schedule(e){this._schedule=e,c.query(`UPDATE groups SET schedule = '${e}' WHERE name = '${this.name}'`)}insertDuty(e,s,a){this._duties.push({group:this.name,date:e,user:s,name:a}),c.query(`INSERT INTO duty (\`group\`,\`date\`,\`user\`,\`name\`) values('${this.name}','${e}','${s}','${a}')`)}},k=class{constructor(){}getGroup(e){return this.all.find(s=>s.name===e)}async load(){let e=await F.all();return this.all=await Promise.all(e.map(async s=>new R().load(s.name,s.next,s.replacement,s.schedule))),this}},F={groups:async t=>new Promise(async function(e,s){c.query(`SELECT * FROM groups WHERE name = '${t}'`,async(a,r)=>{if(a)throw new Error("SQL ERROR in Group");e(r[0])})}),users:async t=>new Promise(async function(e,s){c.query(`SELECT * FROM users WHERE groupName = '${t}'`,async(a,r)=>{if(a)throw new Error("SQL ERROR in Group Users");e(r)})}),duty:async t=>new Promise(async function(e,s){c.query(`SELECT * FROM duty WHERE \`group\` = '${t}'`,async(a,r)=>{if(a)throw new Error("SQL ERROR in Group Duty");e(r)})}),all:async()=>new Promise(async function(t,e){c.query("SELECT * FROM groups",async(s,a)=>{if(s)throw new Error("SQL ERROR in Groups");t(a)})})};var Xe=M(require("node-html-to-image"));var E=class{constructor(e,s){this.gradient=e,this.html=s}async getImage(){let e=await(0,Xe.default)({html:`${y.HTMLSTART1}${this.gradient}${y.HTMLSTART2}${this.html}${y.HTMLEND}`,puppeteerArgs:y.puppeteer});return this._image=e,e}};async function It(t,e){return new Promise(async function(s){let a=await fetch(t).catch(n=>{console.log(n)}),r=[];if(!a?.ok)r="notfound";else{let n=new Date(`${e.slice(-4)}-${e.slice(3,5)}-${e.slice(0,2)}`).getTime(),i=[],f=await new $().load();for(let o of f.all)i.indexOf(o.info.groupName)===-1&&o.info.groupName!=="null"&&i.push(o.info.groupName);for(let o of i){let l=await qt(a,o);r.push({group:o,html:l,date:n})}}s(r)})}async function Nt(t){let e=await new k().load();if(t==="notfound")await m.telegram.sendMessage(6018898378,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").catch(s=>{console.log(s)});else for(let s of t)if(typeof s!="string"&&s.html!==""){let a=e.getGroup(s.group);if(a){a.schedule=s.html;let r=S.light,n=await new E(r,s.html).getImage();for(let i of a.users)if(i.payment.status!==0&&i.settings.schedule==="on"&&await h.payment.groupTG(i)){let f=`background-image: url(${i.settings.theme});`,o=i.settings.theme==="standard"?n:await new E(f,s.html).getImage();await m.telegram.sendPhoto(i.info.id,Ye.Input.fromBuffer(Buffer.from(o),"schedule.png")).then(async()=>{await h.payment.alert(i)}).catch(l=>{console.log(l)})}}}}async function qt(t,e){let s=Je.default.read(Buffer.from(await t.clone().arrayBuffer())),a=s.SheetNames,r=s.Sheets[a[1]],n,i=[];for(let f in r)if(f.toString()[0]==="B"&&r[f].v===e){n=Number(f.slice(1))-3;for(let o=n+1;o<n+28;o++){let l=[];l.push(r[`A${o}`]?`<td><b>${r[`A${o}`].v}</b></td>`:"<td></td>"),l.push(r[`B${o}`]?`<td><b>${r[`B${o}`].v}</b></td>`:"<td></td>"),l.push(r[`C${o}`]?`<td><b>${r[`C${o}`].v}</b></td>`:"<td></td>"),l.push(r[`D${o}`]?`<td><b>${r[`D${o}`].v}</b></td>`:"<td></td>"),l.push(r[`E${o}`]?`<td><b>${r[`E${o}`].v}</b></td>`:"<td></td>"),l.push(r[`F${o}`]?`<td><b>${r[`F${o}`].v}</b></td>`:"<td></td>"),l.push(r[`G${o}`]?`<td><b>${r[`G${o}`].v}</b></td>`:"<td></td>"),i.push((o-n)%4===0?`<tr>${l.join(" ")}</tr><tr><td colspan="7" class="line"></td></tr>`:`<tr>${l.join(" ")}</tr>`)}}return i.join("")}var se={};T(se,{regenerate:()=>xt,sender:()=>Ct});var et=M(require("pdf-parse")),tt=M(require("word-extractor")),rt=require("telegraf");var j=class{constructor(e){this.html=e.html,this.date=e.date,this.link=e.link}},D=class{constructor(){}async load(){let e=await vt.replacements();return this.replacements=e.map(s=>new j(s)).reverse(),this}insertReplacement(e,s,a){this.replacements.push(new j({link:e,date:s,html:a})),c.query(`INSERT INTO replacements (link,date,html) VALUES('${e}','${s}','${a}')`)}getReplacement(e){return this.replacements[e]}},vt={replacements:async()=>new Promise(async function(t,e){c.query("SELECT * FROM replacements",(s,a)=>{if(s)throw new Error("SQL ERROR in Replacements");t(a)})})};var Bt=new tt.default;async function xt(t,e){return new Promise(async function(s){let a=await fetch(t).catch(n=>{console.log(n)}),r={date:new Date(`${e.slice(-4)}-${e.slice(3,5)}-${e.slice(0,2)}`).getTime(),html:"null",typeFile:t.slice(-3),fileBuffer:a?.ok?Buffer.from(await a.clone().arrayBuffer()):Buffer.from([0]),link:t};if(a?.ok){let n=[],i=r.typeFile==="pdf"?(await(0,et.default)(r.fileBuffer)).text:(await Bt.extract(r.fileBuffer)).getBody(),f=(await new k().load()).all.map(g=>g.name),o=i.replace(/\t/g," ").split(`
`).filter(g=>!g.startsWith("\u0413\u0440\u0443\u043F\u043F\u0430")&&!g.startsWith("\u041F\u0410\u0420\u0410")&&g.replace(" ","")!==""&&!g.startsWith("\u041F\u0420\u0415\u041F\u041E\u0414\u0410\u0412\u0410\u0422\u0415\u041B\u042C")&&!g.startsWith("\u0417\u0410\u041C\u0415\u041D\u0410")&&g.replace(" ","")!=="\u041F\u041E"&&!g.startsWith("\u0420\u0410\u0421\u041F\u0418\u0421\u0410\u041D\u0418\u042E")),l=0;for(let g in o)if(o[l])if(o[l].match(/ЗАМЕНЫ/g)===null){let b="",w="",B=1;if(f.some(p=>(b=p,String(o[l]).includes(p.replace("-"," ")))),f.some(p=>(b=p,String(o[l]).includes(p)))||f.some(p=>(b=p,String(o[l]).includes(p.replace("-"," "))))?(w=[o[l]],o[l+1]&&!f.some(p=>String(o[l+1]).includes(p))&&!f.some(p=>String(o[l+1]).includes(p.replace("-"," ")))&&o[l+1].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+1]}`),o[l+2]&&!f.some(p=>String(o[l+2]).includes(p))&&!f.some(p=>String(o[l+2]).includes(p.replace("-"," ")))&&o[l+2].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+2]}`),o[l+3]&&!f.some(p=>String(o[l+3]).includes(p))&&!f.some(p=>String(o[l+3]).includes(p.replace("-"," ")))&&o[l+3].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+3]}`),o[l+4]&&!f.some(p=>String(o[l+4]).includes(p))&&!f.some(p=>String(o[l+4]).includes(p.replace("-"," ")))&&o[l+4].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+4]}`),o[l+5]&&!f.some(p=>String(o[l+5]).includes(p))&&!f.some(p=>String(o[l+5]).includes(p.replace("-"," ")))&&o[l+5].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+5]}`),o[l+6]&&!f.some(p=>String(o[l+6]).includes(p))&&!f.some(p=>String(o[l+6]).includes(p.replace("-"," ")))&&o[l+6].match(/ЗАМЕНЫ/g)===null&&w.push(`${o[l+6]}`)))))),B=w.length,b&&(w=w.join(" ").slice(b.length+1))):b&&(w=o[l].slice(b.length+1)),typeof w=="string"){let p=w.replace(/ +/g," ").split(/\. (?=[А-Яа-я0-9(])|\) (?=[А-Яа-я0-9(])/g).reverse()[0],v=w.replace(/ +/g," ").match(/[0-9]п([,\-])[0-9]п|[0-9]([,\-])[0-9]п|[0-9]п|[0-9]/)?.[0];v&&(w=w.replace(/ +/g," ").replace(v,"").replace(p,"")),n.push({text:`${w}`,group:b,pair:v,auditorium:p}),l+=B}}else n.push({text:`${o[l]} ${o[l+1]}`,group:"null",pair:"null",auditorium:"null"}),l+=2;r.html=await At(n)}s(r)})}async function Ct(t){let e=await new $().load(),s=await new D().load(),a=s.getReplacement(0);if(t.html!=="null"&&t.html!==a.html){s.insertReplacement(t.link,t.date,t.html);let r=S.dark,n=await new E(r,t.html).getImage();for(let i of e.all){let f=`background-image: url(${i.settings.theme});`,o=i.settings.theme==="standard"?n:await new E(f,t.html).getImage();i.payment.status!==0&&i.settings.replacement==="on"&&await h.payment.groupTG(i)&&await m.telegram.sendPhoto(i.userId,rt.Input.fromBuffer(Buffer.from(o),"replacement.png")).then(async()=>{await h.payment.alert(i)}).catch(l=>{console.log(l)})}}else await m.telegram.sendMessage(6018898378,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B")}async function At(t){let e=[];for(let s in t)if(t[s].group==="null")e.push(`<tr><td colspan="8"><b>${t[s].text}</b></td></tr>`),e.push('<tr><td><b>\u0413\u0440\u0443\u043F\u043F\u0430</b></td><td><b>\u041F\u0430\u0440\u0430</b></td><td colspan="2"><b>\u041F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td><td><b><===></b></td><td colspan="2"><b>\u0417\u0430\u043C\u0435\u043D\u0430</b></td><td><b>\u0410\u0443\u0434\u0438\u0442\u043E\u0440\u0438\u044F</b></td></tr>'),e.push('<tr><td colspan="8" class="line"></td></tr>');else{let a=/[А-Я][а-я]+ [А-Я].[А-Я].|\([а-я]+\)|\([А-Яа-я0-9 .]+ +[А-Яа-я0-9 .]+\)|[А-Яа-я0-9]+/g,n=t[s].text.replace(/ +/g," ").match(a),i=[],f=0;for(let l in n)if(Number(l)===f)if(n[Number(l)+1]&&n[Number(l)+1].startsWith("(")){let g=[`${n[Number(l)]}`,`
${n[Number(l)+1]}`];n[Number(l)+2]&&n[Number(l)+2].startsWith("(")&&(g.push(`
${n[Number(l)+2]}`),n[Number(l)+3]&&n[Number(l)+3].startsWith("(")&&g.push(`
${n[Number(l)+3]}`)),f+=g.length,i.push(g.join(" "))}else i.push(n[Number(l)]),f+=1;let o=`<td colspan="5"><b>${i.join(" ")}</b></td>`;i.length===1?o=`<td colspan="2"><b>${i[0]}</b></td><td><b></b></td><td colspan="2"><b></b></td>`:i.length===3?o=`<td colspan="2"><b>${i[0]}</b></td><td><b>${i[1]}</b></td><td colspan="2"><b>${i[2]}</b></td>`:i.length===2?o=`<td colspan="2"><b>${i[0]}</b></td><td><b></b></td><td colspan="2"><b>${i[1]}</b></td>`:i.length===4&&(o=`<td><b>${i[0]}</b></td><td><b>${i[1]}</b></td><td></td><td><b>${i[2]}</b></td><td><b>${i[3]}</b></td>`),t[Number(s)+1]?.group==="null"?(e.push(`<tr><td><b>${t[s].group}</b></td><td><b>${t[s].pair}</b></td>${o}<td><b>${t[s].auditorium}</b></td></tr>`),e.push('<tr><td colspan="8" class="line"></td></tr>')):e.push(`<tr><td><b>${t[s].group}</b></td><td><b>${t[s].pair}</b></td>${o}<td><b>${t[s].auditorium}</b></td></tr>`)}return e.join("")}var ie={};T(ie,{alert:()=>at,groupTG:()=>Gt,paid:()=>Ht,preAlert:()=>Wt,recount:()=>Lt,refBonus:()=>Qt,referral:()=>ne});async function Lt(){let t=await new $().load();for(let e of t.all){let s=e.payment.price-e.payment.price/100*(e.payment.referral.agentsApprove*6);e.payment.status===1?(await ne(e,"false"),await m.telegram.sendMessage(e.info.id,`\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0437\u0430 \u043D\u0435\u0443\u043F\u043B\u0430\u0442\u0443(\u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0438\u043B\u0438 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(s*2)}\u0440</b>)
\u{1F517}<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>`,{parse_mode:"HTML"}).catch(a=>{console.log(a)})):e.payment.status===2?(await ne(e,"false"),await m.telegram.sendMessage(e.info.id,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(s)}\u0440</b>
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u044C \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(s*2)}\u0440, ${Math.round(s*3)}\u0440, ${Math.round(s*4)}\u0440, ${Math.round(s*5)}\u0440, ${Math.round(s*6)}\u0440)
\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)
\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435
<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>

\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 3 \u043C\u0435\u0441\u044F\u0446\u0430`,{parse_mode:"HTML"}).catch(a=>{console.log(a)})):e.payment.status>2&&await m.telegram.sendMessage(e.info.id,`\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043C\u0435\u043D\u0435\u043D \u043D\u0430 ${y.payment.get(e.payment.status-1)}`,{parse_mode:"HTML"}).catch(a=>{console.log(a)}),e.payment.status>0&&(e.payment.status+=-1)}}async function Wt(){let e=["31.01","28.02","31.03","30.04","31.05","30.06","31.07","31.08","30.09","31.10","30.11","31.12"][new Date().getMonth()],s=await new $().load();for(let a of s.all)a.payment.status===1&&(await m.telegram.sendMessage(a.info.id,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0434\u043E ${e}, \u0438\u043D\u0430\u0447\u0435 \u0431\u0443\u0434\u0435\u0442\u0435 \u043E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043E\u0442 \u0431\u043E\u0442\u0430`).catch(r=>{console.log(r)}),await at(a))}async function at(t){if(t.payment.status===1){let e=t.payment.price-t.payment.price/100*(t.payment.referral.agentsApprove*6);await m.telegram.sendMessage(t.info.id,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(e)}\u0440</b>
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u044C \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(e*2)}\u0440, ${Math.round(e*3)}\u0440, ${Math.round(e*4)}\u0440, ${Math.round(e*5)}\u0440, ${Math.round(e*6)}\u0440)
\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)
\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435
<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>

\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 3 \u043C\u0435\u0441\u044F\u0446\u0430`,{parse_mode:"HTML"}).catch(s=>{console.log(s)})}}async function Ht(){return new Promise(async function(t){let e=await new $().load();e.all.sort((n,i)=>n.info.name.localeCompare(i.info.name));let s=[[]],a=0,r=0;for(let n of e.all)a%5===0&&a!==0?(r+=1,s.push([]),s[r].push({text:n.info.name,callback_data:`userPaid${n.info.id}`}),a+=1):(s[r].push({text:n.info.name,callback_data:`userPaid${n.info.id}`}),a+=1);t(s)})}async function ne(t,e){let s=t.payment.referral.user,a=e==="true"?"false":"true";if(s&&s.status===a){let r=await new u().load(s.agentId),n=e==="true"?r.payment.referral.agentsApprove+1:r.payment.referral.agentsApprove-1;t.payment.referral.setUserStatus(e),t.payment.referral.agentsApprove=n}}async function Gt(t){if(t.info.id<0){let e=await new $().load(),s=t.info.bots;for(let a of e.all)if(a.info.id!==t.info.id&&-1<a.payment.status&&a.payment.status<2){let r=await m.telegram.getChatMember(t.info.id,a.info.id);(r.status==="member"||r.status==="creator"||r.status==="administrator")&&(s+=1)}return s===Number(m.telegram.getChatMembersCount(t.info.id))}else return!0}async function Qt(t){let e=0;if(t.info.id===1177837026||t.info.id===6018898378){let s=t.payment.referral.agents;for(let a of s){let r=await new u().load(a.userId);a.status==="true"&&r.payment.paid==="true"&&(e+=1)}}return t.info.id===1177837026||t.info.id===6018898378?38*e:6*t.payment.referral.agentsApprove}var pe={};T(pe,{paidStatus:()=>de,setDutyDay:()=>ce,setGroup:()=>me,settings:()=>U,userPaid:()=>oe,userStatus:()=>le,vipStatus:()=>ue});var _=require("telegraf");async function oe(t,e){let s=t.callbackQuery?.data,a=Number(s.slice(e)),r=await new u().load(a);t.editMessageText(`\u0422\u0435\u043A\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441: ${y.payment.get(r.payment.status)}
\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u043D\u0430:`,{reply_markup:{inline_keyboard:[[_.Markup.button.callback("true",`userStatus_2___${a}`),_.Markup.button.callback("false",`userStatus_1___${a}`),_.Markup.button.callback("free",`userStatus_f___${a}`),_.Markup.button.callback("vip",`userStatus_vip_${a}`),_.Markup.button.callback("ban",`userStatus_0___${a}`),_.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(n=>{console.log(n)})}async function le(t){let e=t.callbackQuery?.data,s=Number(e.slice(15)),a=s===0?void 0:await new u().load(s);if(e.slice(11).startsWith("vip"))t.editMessageText("\u0423\u0440\u043E\u0432\u0435\u043D\u044C VIP:",{reply_markup:{inline_keyboard:[[_.Markup.button.callback("2\u043C\u0435\u0441",`vipStatus_3_${s}`),_.Markup.button.callback("3\u043C\u0435\u0441",`vipStatus_4_${s}`),_.Markup.button.callback("4\u043C\u0435\u0441",`vipStatus_5_${s}`),_.Markup.button.callback("5\u043C\u0435\u0441",`vipStatus_6_${s}`),_.Markup.button.callback("6\u043C\u0435\u0441",`vipStatus_7_${s}`),_.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(r=>{console.log(r)});else if(e.slice(11).startsWith("0")){if(!a)return;a.payment.status=0,await h.payment.referral(a,"false"),await m.telegram.sendMessage(a.info.id,"\u0412\u044B \u0431\u044B\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C").catch(r=>{console.log(r)}),await t.telegram.answerCbQuery(String(t.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(r=>{console.log(r)})}else if(e.slice(11).startsWith("undo")){let r=await h.payment.paid();t.editMessageText("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:r}}).catch(n=>{console.log(n)})}else{if(!a)return;let r=e.slice(11).startsWith("f")?-1:Number(e.slice(11,12));a.payment.status=r,r!==1&&(await h.payment.referral(a,"true"),a.payment.paid="true"),r===1&&await h.payment.referral(a,"false"),await m.telegram.sendMessage(a.info.id,`\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0441\u0442\u0430\u0442\u0443\u0441: ${y.payment.get(r)}`).catch(n=>{console.log(n)}),await t.telegram.answerCbQuery(String(t.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(n=>{console.log(n)})}}async function ue(t){let e=t.callbackQuery?.data,s=Number(e.slice(12)),a=await new u().load(s),r=Number(e.slice(10,11));a.payment.status=r,a.payment.paid="true",await h.payment.referral(a,"true"),await m.telegram.sendMessage(a.info.id,`\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0441\u0442\u0430\u0442\u0443\u0441: ${y.payment.get(r)}`).catch(n=>{console.log(n)}),await t.telegram.answerCbQuery(String(t.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(n=>{console.log(n)})}async function me(t){let e=t.callbackQuery?.data,s=t.from?.id,a=String(e.slice(8));if(s){let r=await new u().load(s);r.info.groupName=a,await t.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u0430 \u0433\u0440\u0443\u043F\u043F\u0430: ${a}`).catch(n=>{console.log(n)})}}async function de(t){let e=t.callbackQuery?.data,s=Number(e.slice(10));await m.telegram.sendMessage(s,"\u041E\u0448\u0438\u0431\u043A\u0430. \u0412\u044B \u043D\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443!").catch(a=>{console.log(a)}),m.telegram.deleteMessage(Number(t.callbackQuery?.from.id),Number(t.callbackQuery?.message?.message_id)).catch(a=>{console.log(a)})}async function ce(t){let e=t.callbackQuery?.data,s=t.from?.id,a=Number(e.slice(10)),r=new Map().set(1,"\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A").set(2,"\u0412\u0442\u043E\u0440\u043D\u0438\u043A").set(3,"\u0421\u0440\u0435\u0434\u0430").set(4,"\u0427\u0435\u0442\u0432\u0435\u0440\u0433").set(5,"\u041F\u044F\u0442\u043D\u0438\u0446\u0430").set(6,"\u0421\u0443\u0431\u0431\u043E\u0442\u0430");if(s){let n=await new u().load(s);n.duty.day=a,await t.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D \u0434\u0435\u043D\u044C: ${r.get(a)}`).catch(i=>{console.log(i)})}}var U={keyboard:async t=>[[_.Markup.button.callback(`\u0414\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430: ${t.settings.duty}`,`settingsDuty${t.info.id}`),_.Markup.button.callback(`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${t.settings.schedule}`,`settingsSchedule${t.info.id}`),_.Markup.button.callback(`\u0417\u0430\u043C\u0435\u043D\u044B: ${t.settings.replacement}`,`settingsReplacement${t.info.id}`)]],schedule:async t=>{let e=t.callbackQuery?.data,s=await new u().load(Number(e.slice(16)));s.settings.switchSchedule(),await t.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await U.keyboard(s)}}).catch(a=>{console.log(a)})},replacement:async t=>{let e=t.callbackQuery?.data,s=await new u().load(Number(e.slice(19)));s.settings.switchReplacement(),await t.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await h.callback_query.settings.keyboard(s)}}).catch(a=>{console.log(a)})},duty:async t=>{let e=t.callbackQuery?.data,s=await new u().load(Number(e.slice(12)));s.settings.switchDuty(),await t.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await h.callback_query.settings.keyboard(s)}}).catch(a=>{console.log(a)})}};var ge={};T(ge,{duty:()=>fe});async function fe(t){if(t.chat?.id){let e=await new u().load(t.chat.id),s=new Date().getTime(),a=new Date().getDay();if(a!==0&&e.payment.status!==0&&e.duty.lastDate+432e5<=s){let r=await new R().load(e.info.groupName);r.insertDuty(s,e.info.id,e.info.name);let n=r.users;e.duty.count+=1,e.duty.lastDate=s;for(let i of n)(i.info.role==="admin"||i.duty.day===a)&&i.info.groupName===e.info.groupName&&console.log(i.duty.day);await t.reply("\u0423\u0441\u043F\u0435\u0448\u043D\u043E")}else await m.telegram.sendMessage(t.chat.id,"\u0421\u0435\u0433\u043E\u0434\u043D\u044F \u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435, \u0432\u044B \u0443\u0436\u0435 \u043E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B\u0438 \u0438\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B").catch(r=>{console.log(r)})}}var he={};T(he,{generateHTML:()=>nt,sender:()=>Ot});var st=require("telegraf");async function Ot(){let t=await new $().load(),e=S.light,s=[],a=new Map;for(let r of t.all)s.indexOf(r.info.groupName)===-1&&r.info.groupName!=="null"&&s.push(r.info.groupName);for(let r of s){let n=await nt(r,0),i=await new E(e,n).getImage();a.set(r,{html:n,standard:i})}for(let r of t.all)if(r.payment.status!==0&&r.settings.duty==="on"&&await h.payment.groupTG(r)&&r.info.id===6018898378){let n=`background-image: url(${r.settings.theme});`,i=r.settings.theme==="standard"?a.get(r.info.groupName).standard:await new E(n,a.get(r.info.groupName).html).getImage();await m.telegram.sendPhoto(r.userId,st.Input.fromBuffer(Buffer.from(i),"duty.png")).then(async()=>{await h.payment.alert(r)}).catch(f=>{console.log(f)})}}async function nt(t,e){let s=await new R().load(t),a=s.users,r=[[],[],[],[],[],[]],n=[[],[],[],[],[],[]],i=[[],[],[],[],[],[]],f=[],o=[],l=[],g=a.sort((d,te)=>te.duty.count-d.duty.count);for(let d of a)d.duty.day!==-1&&r[d.duty.day-1].push(d.info.name);for(let d of g)d.duty.day!==-1&&i[d.duty.day-1].push(`${d.info.name}-${d.duty.count}`);let b=new Date(new Date().getTime()-6048e5*e),w=b.getDate()-b.getDay(),B=w+6,p=new Date(b.setDate(w)),v=new Date(b.setDate(B)),_t=s.getDuty(p.getTime(),v.getTime());for(let d of _t){let te=new Date(d.date).getDay();n[te-1].push(d.name)}for(let d=0;d<5;d++)f.push(`<tr><td><b>${r[0]&&r[0][d]?r[0][d]:""}</b></td><td><b>${r[1]&&r[1][d]?r[1][d]:""}</b></td><td><b>${r[3]&&r[2][d]?r[2][d]:""}</b></td><td><b>${r[3]&&r[3][d]?r[3][d]:""}</b></td><td><b>${r[4]&&r[4][d]?r[4][d]:""}</b></td><td><b>${r[5]&&r[5][d]?r[5][d]:""}</b></td></tr>`),o.push(`<tr><td><b>${n[0]&&n[0][d]?n[0][d]:""}</b></td><td><b>${n[1]&&n[1][d]?n[1][d]:""}</b></td><td><b>${n[2]&&n[2][d]?n[2][d]:""}</b></td><td><b>${n[3]&&n[3][d]?n[3][d]:""}</b></td><td><b>${n[4]&&n[4][d]?n[4][d]:""}</b></td><td><b>${n[5]&&n[5][d]?n[5][d]:""}</b></td></tr>`),l.push(`<tr><td><b>${i[0]&&i[0][d]?i[0][d]:""}</b></td><td><b>${i[1]&&i[1][d]?i[1][d]:""}</b></td><td><b>${i[2]&&i[2][d]?i[2][d]:""}</b></td><td><b>${i[3]&&i[3][d]?i[3][d]:""}</b></td><td><b>${i[4]&&i[4][d]?i[4][d]:""}</b></td><td><b>${i[5]&&i[5][d]?i[5][d]:""}</b></td></tr>`);return`
<tr><td colspan="6"><b>\u0414\u0435\u0436\u0443\u0440\u043D\u044B\u0435 \u043F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td></tr>
<tr><td><b>\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A</b></td><td><b>\u0412\u0442\u043E\u0440\u043D\u0438\u043A</b></td><td><b>\u0421\u0440\u0435\u0434\u0430</b></td><td><b>\u0427\u0435\u0442\u0432\u0435\u0440\u0433</b></td><td><b>\u041F\u044F\u0442\u043D\u0438\u0446\u0430</b></td><td><b>\u0421\u0443\u0431\u0431\u043E\u0442\u0430</b></td></tr>
<tr><td colspan="6" class="line"></td></tr>
${f.join("")}
<tr><td colspan="6" class="line"></td></tr>
<tr><td colspan="6"><b>\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B\u0438</b></td></tr>
<tr>
<td><b>${new Date(p.getTime()+864e5*1).getDate()}.${`0${new Date(p.getTime()+864e5*1).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*2).getDate()}.${`0${new Date(p.getTime()+864e5*2).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*3).getDate()}.${`0${new Date(p.getTime()+864e5*3).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*4).getDate()}.${`0${new Date(p.getTime()+864e5*4).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*5).getDate()}.${`0${new Date(p.getTime()+864e5*5).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*6).getDate()}.${`0${new Date(p.getTime()+864e5*6).getMonth()+1}`.slice(-2)}</b></td>
</tr>
<tr><td colspan="6" class="line"></td></tr>
${o.join("")}
<tr><td colspan="6" class="line"></td></tr>
<tr><td colspan="6"><b>\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0434\u0435\u0436\u0443\u0440\u0441\u0442\u0432</b></td></tr>
<tr><td colspan="6" class="line"></td></tr>
${l.join("")}
`}var h={schedule:ae,replacement:se,payment:ie,callback_query:pe,hears:ge,duty:he},it=()=>{m.hears("\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B",async t=>{await fe(t)}),m.on("callback_query",async t=>{let e=t.callbackQuery?.data;e.startsWith("userPaid")?await oe(t,8):e.startsWith("paidStatus")?await de(t):e.startsWith("userStatus")?await le(t):e.startsWith("vipStatus")?await ue(t):e.startsWith("settings")?e.startsWith("settingsSchedule")?await U.schedule(t):e.startsWith("settingsReplacement")?await U.replacement(t):e.startsWith("settingsDuty")&&await U.duty(t):e.startsWith("setGroup")?await me(t):e.startsWith("setDutyDay")&&await ce(t)})};async function ye(t){if(t.chat?.id&&t.from?.username){let e=await new $().load();e.getUser(t.chat.id)||(await e.createUser(t.chat.id,t.from.username,2,t.from.username,await Ft(t.chat.id)),await m.telegram.sendMessage(6018898378,`${t.chat.id} ${t.from.username}, \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u043B\u0441\u044F \u043A \u0431\u043E\u0442\u0443`)),await t.reply(`\u0412\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0431\u043E\u0442\u0430!
\u0414\u043B\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0439 \u0440\u0430\u0431\u043E\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 (/setname \u0432\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F) \u0438 (/setgroup).
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0432\u0432\u0435\u0441\u0442\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447 \u043A\u043E\u043C\u0430\u043D\u0434\u043E\u0439 (/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447), \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u0435 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 \u043C\u0435\u0441\u044F\u0446 \u0431\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`)}}async function Ft(t){return t<0?"null":t.toString().split("").map(Number).map(e=>(e||10)+64).map(e=>String.fromCharCode(Number(e))).join("")}async function be(t){let{text:e}=t;if(e=e?.slice(6),t.chat?.id===6018898378&&e&&!e.startsWith("monica_schedule_bot")){let s=await new $().load();for(let a of s.all)a.payment.status!==0&&(await m.telegram.sendMessage(a.info.id,e).catch(r=>{console.log(r)}),await h.payment.alert(a))}else await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function we(t){await t.reply("\u041D\u0435 \u0443\u0434\u0430\u043B\u044F\u0439\u0442\u0435 \u044D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435!",{reply_markup:{resize_keyboard:!0,keyboard:[["\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B"]]}})}var $e=class{constructor(){}async load(e,s){if(s)this.type=e,this._value=s.value,this._number=s.number;else{let a=await ot.settings(e);this.type=a.type,this._value=a.value,this._number=a.number}return this}get value(){return this._value}get number(){return this._number}set value(e){this._value=e,c.query(`UPDATE settings SET value = '${e}' WHERE type = '${this.type}'`)}set number(e){this._number=e,c.query(`UPDATE settings SET number = '${e}' WHERE type = '${this.type}'`)}},K=class{constructor(){}async load(){let e=await ot.all();return this.all=await Promise.all(e.map(async s=>new $e().load(s.type,s))),this}getSettings(e){return this.all.find(s=>s.type===e)}},ot={settings:async t=>new Promise(async function(e,s){c.query(`SELECT * FROM settings WHERE type = '${t}'`,(a,r)=>{if(a)throw new Error("SQL ERROR in Settings");e(r[0])})}),all:async()=>new Promise(async function(t,e){c.query("SELECT * FROM settings",async(s,a)=>{if(s)throw new Error("SQL ERROR in Settings");t(a)})})};async function _e(t,e){if(t===6018898378){let s=await new K().load(),a=[],r=s.getSettings("scheduleLink"),n=s.getSettings("replacementLink"),i=await(await fetch("http://rgkript.ru/raspisanie-zanyatiy/")).text(),f=new RegExp('<a href="http:\\/\\/rgkript.ru\\/wp-content\\/uploads\\/\\/'+new Date().getFullYear()+'[0-9/.\\-A-Za-z_]+"',"g"),o=Array.from(new Set(i.match(f))).map(g=>g.slice(9,-1)),l=i.match(/<strong>[А-Яа-я0-9. ]+/g);if(l)for(let g of l)g.match(/[0-9]+.[0-9]+.[0-9]+/g)&&a.push(g[0]);r&&o[0]!==r?.value?(r.value=o[0],await m.telegram.sendMessage(t,`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${a[0]} ${o[0].slice(36)}`).then(g=>{setTimeout(()=>{m.telegram.deleteMessage(g.chat.id,g.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(g=>{console.log(g)}),await h.schedule.regenerate(o[0],a[0]).then(async g=>{await h.schedule.sender(g)})):await m.telegram.sendMessage(t,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").then(g=>{setTimeout(()=>{m.telegram.deleteMessage(g.chat.id,g.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(g=>{console.log(g)}),n&&o[1]!==n?.value?(n.value=o[1],await m.telegram.sendMessage(t,`\u0417\u0430\u043C\u0435\u043D\u044B: ${a[1]} ${o[1].slice(36)}`).then(g=>{setTimeout(()=>{m.telegram.deleteMessage(g.chat.id,g.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(g=>{console.log(g)}),await h.replacement.regenerate(o[1],a[1]).then(async g=>{await h.replacement.sender(g)})):await m.telegram.sendMessage(t,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B").then(g=>{setTimeout(()=>{m.telegram.deleteMessage(g.chat.id,g.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(g=>{console.log(g)})}else await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function Ee(t){if(t.chat?.id){let e=await new u().load(t.chat.id);e?e.info.id>0?(await m.telegram.sendMessage(6018898378,`${e.info.name}(${e.info.id}) \u043E\u043F\u043E\u0432\u0435\u0441\u0442\u0438\u043B \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435, \u0441\u0442\u0430\u0442\u0443\u0441: ${y.payment.get(e.payment.status)}`,{reply_markup:{inline_keyboard:[[{text:"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`paidStatus${e.info.id}`},{text:"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`userPaid${e.info.id}`}]]}}),await t.reply("\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0443 \u043E\u043F\u043B\u0430\u0442\u044B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D, \u043E\u0436\u0438\u0434\u0430\u0439\u0442\u0435")):await t.reply("\u041E\u0448\u0438\u0431\u043A\u0430. \u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B"):await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Se(t){if(t.chat?.id){let e=await new u().load(t.chat.id);if(e){let s=e.info.groupName,a=e.info.id,r=e.info.name,n=e.payment.referral.key,i=await h.payment.refBonus(e);await t.reply(`\u0413\u0440\u0443\u043F\u043F\u0430: <b>${s}</b>
Id: \u{1F517}<code>${a}</code>
\u0424\u0430\u043C\u0438\u043B\u0438\u044F: <b>${r}</b>
\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B: <b>${y.payment.get(e.payment.status)}</b>
\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438: <b>${Math.floor(e.payment.price-e.payment.price*(i/100))}</b>
\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447: \u{1F517}<code>${n}</code>
\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432: <b>${i}%</b>
\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C: @a_korop`,{parse_mode:"HTML"})}else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Te(t){if(t.chat?.id){let e=await new u().load(t.chat.id),{text:s}=t;if(e)if(e.payment.referral.status==="false"){let a=s?.slice(10);if(a){let r=await new u().load(0,{refKey:a});r?e.info.id!==r.info.id?(e.payment.referral.status="true",e.payment.status=3,r.payment.referral.insertReferral(e.info.id),r.payment.referral.agentsApprove+=1,await t.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447!
\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 2 \u043C\u0435\u0441\u044F\u0446\u0430 (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 2-\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`)):await t.reply("\u0412\u044B \u043D\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u0441\u0432\u043E\u0439 \u0436\u0435 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447"):await t.reply(`\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u0430\u0433\u0435\u043D\u0442 \u0434\u043B\u044F \u043A\u043B\u044E\u0447\u0430: ${a}`)}else await t.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447(/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447)")}else await t.reply("\u0412\u044B \u0443\u0436\u0435 \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447, \u043B\u0438\u0431\u043E \u043E\u043F\u043B\u0430\u0447\u0438\u0432\u0430\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0440\u0430\u043D\u0435\u0435");else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var lt=require("telegraf");async function Re(t){if(t.chat?.id){let e=await new u().load(t.chat.id);if(e)if(e.payment.status!==0)if(await h.payment.groupTG(e)){let s=(await new D().load()).getReplacement(0).html;if(!s)return;let a=e.settings.theme==="standard"?S.dark:`background-image: url(${e.settings.theme});`,r=await new E(a,s).getImage();await t.replyWithPhoto(lt.Input.fromBuffer(Buffer.from(r),"schedule.png")),await h.payment.alert(e)}else await t.reply("\u041D\u0435 \u0432\u0441\u0435 \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443");else await t.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function ke(t){t.chat?.id===6018898378?(await t.reply("\u0411\u043E\u0442 \u0432\u044B\u043A\u043B\u044E\u0447\u0435\u043D!"),setTimeout(()=>{process.exit(0)},1e3*60)):await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}var ut=require("telegraf");async function Me(t){if(t.chat?.id){let e=await new u().load(t.chat.id);if(e)if(e.payment.status!==0)if(e.info.groupName!=="null"){let a=(await new R().load(e.info.groupName)).schedule;if(a!=="null")if(await h.payment.groupTG(e)){let r=e.settings.theme==="standard"?S.light:`background-image: url(${e.settings.theme});`,n=await new E(r,a).getImage();await t.replyWithPhoto(ut.Input.fromBuffer(Buffer.from(n),"schedule.png")),await h.payment.alert(e)}else await t.reply("\u041D\u0435 \u0432\u0441\u0435 \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443");else await t.reply("\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E")}else await t.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443 /setgroup");else await t.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function De(t){if(t.chat?.id)if(await new u().load(t.chat.id)){let s=await new k().load(),a=[[]],r=0,n=0;for(let i of s.all)r%5===0&&r!==0?(n+=1,a.push([]),a[n].push({text:i.name,callback_data:`setGroup${i.name}`}),r+=1):(a[n].push({text:i.name,callback_data:`setGroup${i.name}`}),r+=1);await t.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443:",{reply_markup:{inline_keyboard:a}})}else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}async function Pe(t){if(t.chat?.id){let e=await new u().load(t.chat.id),{text:s}=t;if(e){let a=s?.slice(9);a?(e.info.name=a,await t.reply(`\u0412\u0430\u0448\u0435 \u0438\u043C\u044F - ${a}`)):await t.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0438\u043C\u044F(/setname \u0432\u0430\u0448\u0435 \u0438\u043C\u044F)")}else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Ue(t){if(t.chat?.id){let e=await new u().load(t.chat.id);e?await t.reply("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await h.callback_query.settings.keyboard(e)}}):await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Ie(t){if(t.chat?.id===6018898378){let e=await h.payment.paid();await t.reply("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:e}})}else await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function Ne(t){if(t.chat?.id){let e=await new u().load(t.chat.id),{text:s}=t,a=s?.slice(7);e.payment.status!==0?e&&a&&!a.startsWith("monica_schedule_bot")?(e.settings.theme=a,await t.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0442\u0435\u043C\u0430: ${e.settings.theme}`)):await t.reply("\u041E\u0448\u0438\u0431\u043A\u0430, \u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0432\u044B \u043D\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0432 \u0431\u043E\u0442\u0435, \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443, \u043A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B \u0438\u043B\u0438 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0435 \u0432\u0435\u0434\u0435\u0442 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443"):await t.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C")}}async function qe(t){if(t.chat?.id)if(await new u().load(t.chat.id)){let s=[{name:"\u041F\u043D\u0434",value:1},{name:"\u0412\u0442\u0440",value:2},{name:"\u0421\u0440\u0434",value:3},{name:"\u0427\u0442\u0432",value:4},{name:"\u041F\u0442\u043D",value:5},{name:"\u0421\u0431\u0442",value:6}],a=[[]];for(let r of s)a[0].push({text:r.name,callback_data:`setDutyDay${r.value}`});await t.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u043D\u044C:",{reply_markup:{inline_keyboard:a}})}else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}var mt={start:ye,send:be,duty:we,fetch:_e,paid:Ee,profile:Se,referral:Te,replacement:Re,restart:ke,schedule:Me,setGroup:De,setName:Pe,settings:Ue,status:Ie,theme:Ne,setDutyDay:qe},dt=()=>{m.command("start",async t=>{await ye(t)}),m.command("fetch",async t=>{await _e(t.chat.id,t)}),m.command("send",async t=>{await be(t)}),m.command("schedule",async t=>{await Me(t)}),m.command("theme",async t=>{await Ne(t)}),m.command("status",async t=>{await Ie(t)}),m.command("settings",async t=>{await Ue(t)}),m.command("profile",async t=>{await Se(t)}),m.command("setname",async t=>{await Pe(t)}),m.command("setgroup",async t=>{await De(t)}),m.command("referral",async t=>{await Te(t)}),m.command("paid",async t=>{await Ee(t)}),m.command("replacement",async t=>{await Re(t)}),m.command("restart",async t=>{await ke(t)}),m.command("duty",async t=>{await we(t)}),m.command("setdutydate",async t=>{await qe(t)})};var ht=M(require("express")),yt=M(require("cors")),bt=M(require("path")),wt=M(require("http"));var z={};T(z,{default:()=>jt});async function jt(t,e){let s=await new u().load(t);return{table:await h.duty.generateHTML(s.info.groupName,e)}}var Z={};T(Z,{default:()=>Kt});async function Kt(t){let e=(await new D().load()).getReplacement(t);return{table:e?.html?e.html:"<tr><td><b>\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B!</b></td></tr>"}}var I={};T(I,{default:()=>zt,select:()=>Zt,update:()=>Vt});async function zt(t){let e=await new u().load(t),s=await new R().load(e.info.groupName);return{table:s.schedule!=="null"?s.schedule:"<tr><td><b>\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E!</b></td></tr>"}}async function Zt(t){let e=await new u().load(t),s=await new k().load(),a=[],r=[];for(let n of s.all)n.name===e.info.groupName?a.push(`<option selected value='${n.name}'>${n.name}</option>`):n.schedule==="null"?r.push(`<option disabled value='${n.name}'>${n.name}</option>`):a.push(`<option value='${n.name}'>${n.name}</option>`);return{table:a.concat(r).join("")}}async function Vt(t){let e=await new R().load(t);return{table:e.schedule!=="null"?e.schedule:"<tr><td><b>\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E!</b></td></tr>"}}var V={};T(V,{default:()=>Jt});async function Jt(t){let e=await new u().load(t);return{table:await Yt(e)}}async function Yt(t){let e=await h.payment.refBonus(t),s=new Map().set(1,"\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A").set(2,"\u0412\u0442\u043E\u0440\u043D\u0438\u043A").set(3,"\u0421\u0440\u0435\u0434\u0430").set(4,"\u0427\u0435\u0442\u0432\u0435\u0440\u0433").set(5,"\u041F\u044F\u0442\u043D\u0438\u0446\u0430").set(6,"\u0421\u0443\u0431\u0431\u043E\u0442\u0430").set(-1,"\u041D\u0435 \u0437\u0430\u0434\u0430\u043D\u043E"),a=await new k().load(),r=[];for(let i of a.all)i.name===t.info.groupName?r.push(`<option selected value='${i.name}'>${i.name}</option>`):r.push(`<option value='${i.name}'>${i.name}</option>`);let n=[];for(let i=1;i<7;i++)i===t.duty.day?n.push(`<option selected value='${i}'>${s.get(i)}</option>`):n.push(`<option value='${i}'>${s.get(i)}</option>`);return`
<tr><td colspan="2"><b class="profileB">\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F</b></td><td><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0438\u0442\u044C</b></td></tr>
<tr><td><b class="profileB">\u0413\u0440\u0443\u043F\u043F\u0430:</b></td><td><b class="profileB">${t.info.groupName}</b></td><td><b class="profileB"><form name="myForm"><select class="selectP" name="selectGroup" id="selectGroup">${r.join("")}</select></form>\u25BC</b></td></tr>
<tr><td><b class="profileB">\u0418\u043C\u044F:</b></td><td><b class="profileB">${t.info.name}</b></td><td><b class="profileB">|</b><form name="myForm1"><input class="inputP" type="text" id="name" name="name" required/></form></td></tr>
<tr><td><b class="profileB">\u0414\u0435\u043D\u044C \u0434\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430:</b></td><td><b class="profileB">${s.get(t.duty.day)}</b></td><td><b class="profileB"><form name="myForm2"><select class="selectP" name="selectDutyDay" id="selectDutyDay">${n.join("")}</select></form>\u25BC</b></td></tr>
<tr><td><b class="profileB">\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C id:</b></td><td><b class="profileB">${t.info.id}</b></td></tr>
<tr><td><b class="profileB">\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B:</b></td><td><b class="profileB">${y.payment.get(t.payment.status)}</b></td></tr>
<tr><td><b class="profileB">\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438:</b></td><td><b class="profileB">${Math.floor(t.payment.price-t.payment.price*(e/100))}\u0440</b></td></tr>
<tr><td><b class="profileB">\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447:</b></td><td><b class="profileB">${t.payment.referral.key}</b></td></tr>
<tr><td><b class="profileB">\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432:</b></td><td><b class="profileB">${e}%</b></td></tr>
<tr><td><b class="profileB">\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C:</b></td><td><b class="profileB">@a_korop</b></td></tr>
<tr><td colspan="2"></td><td><button onclick="update()"><b class="profileB">\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C</b></button></td></tr>
`}var N={};T(N,{dutyDay:()=>tr,group:()=>er,name:()=>rr});async function er(t,e){let s=await new u().load(t);s.info.groupName=decodeURI(e)}async function tr(t,e){let s=await new u().load(t);s.duty.day=e}async function rr(t,e){let s=await new u().load(t);s.info.name=decodeURI(e)}var P={};T(P,{default:()=>sr,duty:()=>or,replacement:()=>ir,schedule:()=>nr});async function sr(t){let e=await new u().load(t);return{table:await X(e)}}async function nr(t){let e=await new u().load(t);return e.settings.switchSchedule(),{table:await X(e)}}async function ir(t){let e=await new u().load(t);return e.settings.switchReplacement(),{table:await X(e)}}async function or(t){let e=await new u().load(t);return e.settings.switchDuty(),{table:await X(e)}}async function X(t){return`
<tr><td colspan="2"><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439</b></td></tr>
<tr><td><b class="profileB">\u041F\u043E\u044F\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044F:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsSchedule()"><b class="profileB">${t.settings.schedule}</b></button></td></tr>
<tr><td><b class="profileB">\u041F\u043E\u044F\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u044B\u0445 \u0437\u0430\u043C\u0435\u043D:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsReplacement()"><b class="profileB">${t.settings.replacement}</b></button></td></tr>
<tr><td><b class="profileB">\u0420\u0430\u0441\u0441\u044B\u043B\u043A\u0430 \u0442\u0430\u0431\u043B\u0438\u0446\u044B \u0434\u0435\u0436\u0443\u0440\u043D\u044B\u0445 \u0437\u0430 \u043D\u0435\u0434\u0435\u043B\u044E:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsDuty()"><b class="profileB">${t.settings.duty}</b></button></td></tr>
`}var q={};T(q,{bg:()=>ur,default:()=>lr,lightMode:()=>mr});async function lr(t){let e=await new u().load(t);return{table:await ve(e)}}async function ur(t,e){let s=await new u().load(t);return s.settings.theme=e,{table:await ve(s)}}async function mr(t){let e=await new u().load(t);return e.settings.switchLightMode(),{table:await ve(e)}}async function ve(t){return`
<tr><td colspan="4"><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0442\u0435\u043C\u044B</b></td></tr>
<tr><td><b class="profileB">\u0424\u043E\u043D:</b></td><td><form name="myForm"><input class="inputP" type="url" id="theme" name="theme" required/></form></td><td><button onclick="updateSettingsTheme()"><b class="profileB">\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C</b></button></td><td><button onclick="updateSettingsThemeStandard()"><b class="profileB">\u041F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E</b></button></td></tr>
<tr><td colspan="2"><b class="profileB">\u0422\u0435\u043C\u043D\u0430\u044F \u0442\u0435\u043C\u0430:</b></td><td colspan="2"><button style="width: 100%;" onclick="updateSettingsLightMode()"><b class="profileB">${t.settings.lightMode===0?"off":"on"}</b></button></td></tr>
    `}var J=require("fs"),Y=M(require("path"));async function ct(t){return{body:(0,J.readFileSync)(Y.default.join(t+"/html/profile.html"),"utf-8")}}async function pt(t){return{body:(0,J.readFileSync)(Y.default.join(t+"/html/settings.html"),"utf-8")}}async function ft(t,e){let s=await new u().load(e);return s&&s.payment.status!==0?{body:(0,J.readFileSync)(Y.default.join(t+"/html/home.html"),"utf-8")}:{body:'<table><tr><td><b class="profileB">\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0438\u043B\u0438 \u0435\u0449\u0435 \u043D\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043A \u0431\u043E\u0442\u0443!</b></td></tr></table>'}}async function gt(t){let e=await new u().load(t),s=e.settings.theme,a=e.settings.lightMode===0?S.light:S.dark;return{gradient:s==="standard"?a.slice(11,-1):`url(${s})`}}var $t=t=>{let e=(0,ht.default)();e.use((0,yt.default)()),e.get("/",(a,r)=>{r.sendFile(bt.default.join(t+"/html/index.html"))}),e.get("/home/[0-9]+",async(a,r)=>{r.send(await ft(t,Number(a.url.slice(6))))}),e.get("/home/scheduleTable/[0-9]+",async(a,r)=>{r.send(await I.default(Number(a.url.slice(20))))}),e.get("/home/scheduleTable/selectGroup/[0-9]+",async(a,r)=>{r.send(await I.select(Number(a.url.slice(32))))}),e.get("/home/scheduleTable/updateGroup/[0-9%A-Za-z-]+",async(a,r)=>{r.send(await I.update(decodeURI(a.url.slice(32))))}),e.get("/home/replacementTable/[0-9]+",async(a,r)=>{r.send(await Z.default(Number(a.url.slice(23))))}),e.get("/home/dutyTable/[0-9]+/[0-9]+",async(a,r)=>{let n=a.url.match(/[0-9]+/g);n&&r.send(await z.default(Number(n[0]),Number(n[1])))}),e.get("/profile",async(a,r)=>{r.send(await ct(t))}),e.get("/profile/[0-9]+",async(a,r)=>{r.send(await V.default(Number(a.url.slice(9))))}),e.get("/profile/editGroup/[0-9]+/[0-9%A-Za-z-]+",async(a,r)=>{let n=a.url.slice(19).match(/[0-9%A-Za-z\-]+/g);n&&await N.group(Number(n[0]),n[1]).then(()=>r.send())}),e.get("/profile/editDutyDay/[0-9]+/[0-9]+",async(a,r)=>{let n=a.url.slice(21).match(/[0-9]+/g);n&&await N.dutyDay(Number(n[0]),Number(n[1])).then(()=>r.send())}),e.get("/profile/editName/[0-9]+/[0-9%A-Za-z-]+",async(a,r)=>{let n=a.url.slice(18).match(/[0-9%A-Za-z\-]+/g);n&&await N.name(Number(n[0]),n[1]).then(()=>r.send())}),e.get("/settings",async(a,r)=>{r.send(await pt(t))}),e.get("/settings/notification/[0-9]+",async(a,r)=>{r.send(await P.default(Number(a.url.slice(23))))}),e.get("/settings/notification/schedule/[0-9]+",async(a,r)=>{r.send(await P.schedule(Number(a.url.slice(32))))}),e.get("/settings/notification/replacement/[0-9]+",async(a,r)=>{r.send(await P.replacement(Number(a.url.slice(35))))}),e.get("/settings/notification/duty/[0-9]+",async(a,r)=>{r.send(await P.duty(Number(a.url.slice(28))))}),e.get("/settings/theme/[0-9]+",async(a,r)=>{r.send(await q.default(Number(a.url.slice(16))))}),e.post("/settings/theme/bg",async(a,r)=>{r.send(await q.bg(Number(a.query.user),String(a.query.url)))}),e.post("/settings/theme/lightMode",async(a,r)=>{r.send(await q.lightMode(Number(a.query.user)))}),e.get("/randomGradient/[0-9]+",async(a,r)=>{r.send(await gt(Number(a.url.slice(16))))}),wt.default.createServer(e).listen(3e3,"localhost")};var Be=new L,{bot:m,connection:c}=Be,{gradients:S}=Be;Be.addGradients().then(t=>{S=t});$t(__dirname);dt();it();ee.CronJob.from({cronTime:"0 10 14 * * 1-5,7",onTick:async()=>{await mt.fetch(6018898378)},start:!0});ee.CronJob.from({cronTime:"0 0 13 1 * *",onTick:async()=>{await h.payment.recount().catch(t=>{console.log(t)})},start:!0});ee.CronJob.from({cronTime:"0 35 7 25-31 * *",onTick:async()=>{await h.payment.preAlert().catch(t=>{console.log(t)})},start:!0});0&&(module.exports={bot,connection,gradients});
