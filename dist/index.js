"use strict";var ke=Object.create;var k=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,Ce=Object.prototype.hasOwnProperty;var b=(e,t)=>{for(var a in t)k(e,a,{get:t[a],enumerable:!0})},Z=(e,t,a,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ie(t))!Ce.call(e,n)&&n!==a&&k(e,n,{get:()=>t[n],enumerable:!(r=Me(t,n))||r.enumerable});return e};var E=(e,t,a)=>(a=e!=null?ke(Pe(e)):{},Z(t||!e||!e.__esModule?k(a,"default",{value:e,enumerable:!0}):a,e)),Re=e=>Z(k({},"__esModule",{value:!0}),e);var ct={};b(ct,{bot:()=>u});module.exports=Re(ct);var J=E(require("dotenv"));J.default.config();var{TOKEN:Y,PASSWORD:ee,SQLHOST:te,SQLUSER:ae,SQLDATABASE:re,SQLPASSWORD:ne,HTMLSTART1:se,HTMLSTART2:oe,HTMLEND:ie,PUPPETEER:le}=process.env;if(!Y||!ee||!te||!ae||!re||!ne||!se||!oe||!ie||!le)throw new Error("Missing environment variables");var f={TOKEN:Y,PASSWORD:ee,SQLHOST:te,SQLUSER:ae,SQLDATABASE:re,SQLPASSWORD:ne,HTMLSTART1:se,HTMLSTART2:oe,HTMLEND:ie,PUPPETEER:eval(`(${le})`)};var $e=require("telegraf"),M=require("cron"),_e=E(require("path")),Ee=E(require("express")),Se=E(require("cors")),Te=E(require("http"));var g=E(require("mysql"));var y={host:f.SQLHOST,user:f.SQLUSER,database:f.SQLDATABASE,password:f.SQLPASSWORD};console.log(y);var o={users:{select:async e=>{let t=g.default.createConnection(y);return new Promise(async function(a,r){t.query(`SELECT * FROM users WHERE userId = '${e}'`,(n,i)=>{n&&r(n),console.log(i[0]),a(i[0])})})},select_all:async()=>{let e=g.default.createConnection(y);return new Promise(async function(t,a){e.query("SELECT * FROM users",(r,n)=>{r&&a(r),t(n)})})},select_refAgents_by_refKey:async e=>{let t=g.default.createConnection(y);return new Promise(async function(a,r){t.query(`SELECT * FROM users WHERE refKey = '${e}'`,(n,i)=>{n&&r(n),a(i[0])})})},insert:async(e,t,a,r,n)=>{g.default.createConnection(y).query(`INSERT INTO users (userId,userName,payment,name,refKey) values('${e}','${t}','${a}','${r}','${n}')`)},update_payment:async function(e,t){g.default.createConnection(y).query(`UPDATE users SET payment = '${t}' WHERE userId = '${e}'`)},update_theme:async function(e,t){g.default.createConnection(y).query(`UPDATE users SET theme = '${t}' WHERE userId = '${e}'`)},update_duty:async function(e,t){g.default.createConnection(y).query(`UPDATE users SET duty = '${t}' WHERE userId = '${e}'`)},update_dutyDate:async function(e,t){g.default.createConnection(y).query(`UPDATE users SET dutyDate = '${t}' WHERE userId = '${e}'`)},update_name:async(e,t)=>{g.default.createConnection(y).query(`UPDATE users SET name = '${t}' WHERE userId = '${e}'`)},update_refAgents:async(e,t)=>{g.default.createConnection(y).query(`UPDATE users SET refAgents = '${t}' WHERE userId = '${e}'`)},update_group:async(e,t)=>{g.default.createConnection(y).query(`UPDATE users SET groupName = '${t}' WHERE userId = '${e}'`)},update_refKeyStatus:async(e,t)=>{g.default.createConnection(y).query(`UPDATE users SET refKeyStatus = '${t}' WHERE userId = '${e}'`)},update_paidWhenever:async(e,t)=>{g.default.createConnection(y).query(`UPDATE users SET paidWhenever = '${t}' WHERE userId = '${e}'`)},settings:{update_schedule:async function(e,t){g.default.createConnection(y).query(`UPDATE users SET settingsSchedule = '${t}' WHERE userId = '${e}'`)},update_replacement:async function(e,t){g.default.createConnection(y).query(`UPDATE users SET settingsReplacement = '${t}' WHERE userId = '${e}'`)},update_duty:async function(e,t){g.default.createConnection(y).query(`UPDATE users SET settingsDuty = '${t}' WHERE userId = '${e}'`)}}},settings:{select:async e=>{let t=g.default.createConnection(y);return new Promise(async function(a,r){t.query(`SELECT * FROM settings WHERE type = '${e}'`,(n,i)=>{n&&r(n),a(i[0])})})},update_value:async(e,t)=>{g.default.createConnection(y).query(`UPDATE settings SET value = '${e}' WHERE type = '${t}'`)},update_number:async(e,t)=>{g.default.createConnection(y).query(`UPDATE settings SET number = '${e}' WHERE type = '${t}'`)}},groups:{select_all:async()=>{let e=g.default.createConnection(y);return new Promise(async function(t,a){e.query("SELECT * FROM groups",(r,n)=>{r&&a(r),t(n)})})},select_schedule:async e=>{let t=g.default.createConnection(y);return new Promise(async function(a,r){t.query(`SELECT * FROM groups WHERE name = '${e}'`,(n,i)=>{n&&r(n),a(i[0])})})},update_schedule:async(e,t)=>{g.default.createConnection(y).query(`UPDATE groups SET schedule = '${t}' WHERE name = '${e}'`)}},referral:{insert:async(e,t,a)=>{g.default.createConnection(y).query(`INSERT INTO referrals (agentId,userId,refKey) VALUES('${e}','${t}','${a}')`)},select_by_user:async e=>{let t=g.default.createConnection(y);return new Promise(async function(a,r){t.query(`SELECT * FROM referrals WHERE userId = '${e}'`,(n,i)=>{n&&r(n),a(i[0])})})},select_by_agent:async e=>{let t=g.default.createConnection(y);return new Promise(async function(a,r){t.query(`SELECT * FROM referrals WHERE agentId = '${e}'`,(n,i)=>{n&&r(n),a(i)})})},update_status:async(e,t)=>{g.default.createConnection(y).query(`UPDATE referrals SET status = '${t}' WHERE userId = '${e}'`)}},replacement:{select_by_index:async e=>{let t=g.default.createConnection(y);return new Promise(async function(a,r){t.query("SELECT * FROM replacements",(n,i)=>{n&&r(n),a(i[Number(i.length)-1-e])})})},insert:async(e,t,a)=>{g.default.createConnection(y).query(`INSERT INTO replacements (link,date,html) VALUES('${e}','${t}','${a}')`)}},gradients:{select_all_gradients:async()=>{let e=g.default.createConnection(y);return new Promise(async function(t,a){e.query("SELECT * FROM gradients",(r,n)=>{r&&a(r),t(n.map(i=>i.css))})})},select_all_replGradients:async()=>{let e=g.default.createConnection(y);return new Promise(async function(t,a){e.query("SELECT * FROM replGradients",(r,n)=>{r&&a(r),t(n.map(i=>i.css))})})}}};var C={};b(C,{regenerate:()=>Le,sender:()=>Ae});var ce=E(require("xlsx")),P=E(require("node-html-to-image")),ue=require("telegraf");async function Le(e,t){return new Promise(async function(a){let r=await fetch(e).catch(i=>{console.log(i)}),n=[];if(!r?.ok)n="notfound";else{let i=new Date(`${t.slice(-4)}-${t.slice(3,5)}-${t.slice(0,2)}`).getTime(),c=[],m=await o.users.select_all();for(let l of m)c.indexOf(l.groupName)===-1&&l.groupName!=="null"&&c.push(l.groupName);for(let l of c){let s=await xe(r,l);n.push({group:l,html:s,date:i})}}a(n)})}async function Ae(e){let t=await o.users.select_all();if(e==="notfound")await u.telegram.sendMessage(6018898378,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").catch(a=>{console.log(a)});else{let a=await o.gradients.select_all_gradients(),r=a[Math.floor(Math.random()*(a.length-1))];for(let n of e)if(typeof n!="string"&&n.html!==""){await o.groups.update_schedule(n.group,n.html);let i=await(0,P.default)({html:`${f.HTMLSTART1}${r}${f.HTMLSTART2}${n.html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});for(let c of t)if(c.payment!=="ban"&&e!=="notfound"&&c.settingsSchedule==="on"&&c.groupName===n.group){let m=`background-image: url(${c.theme});`,l=c.theme==="standard"?i:await(0,P.default)({html:`${f.HTMLSTART1}${m}${f.HTMLSTART2}${n.html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});await u.telegram.sendPhoto(c.userId,ue.Input.fromBuffer(Buffer.from(l),"schedule.png")).then(async()=>{await p.payment.alert(c)}).catch(s=>{console.log(s)})}}}}async function xe(e,t){let a=ce.default.read(Buffer.from(await e.clone().arrayBuffer())),r=a.SheetNames,n=a.Sheets[r[1]],i,c=[];for(let m in n)if(m.toString()[0]==="B"&&n[m].v===t){i=Number(m.slice(1))-3;for(let l=i+1;l<i+28;l++){let s=[];s.push(n[`A${l}`]?`<td><b>${n[`A${l}`].v}</b></td>`:"<td></td>"),s.push(n[`B${l}`]?`<td><b>${n[`B${l}`].v}</b></td>`:"<td></td>"),s.push(n[`C${l}`]?`<td><b>${n[`C${l}`].v}</b></td>`:"<td></td>"),s.push(n[`D${l}`]?`<td><b>${n[`D${l}`].v}</b></td>`:"<td></td>"),s.push(n[`E${l}`]?`<td><b>${n[`E${l}`].v}</b></td>`:"<td></td>"),s.push(n[`F${l}`]?`<td><b>${n[`F${l}`].v}</b></td>`:"<td></td>"),s.push(n[`G${l}`]?`<td><b>${n[`G${l}`].v}</b></td>`:"<td></td>"),c.push((l-i)%4===0?`<tr>${s.join(" ")}</tr><tr><td colspan="7" class="line"></td></tr>`:`<tr>${s.join(" ")}</tr>`)}}return c.join("")}var L={};b(L,{regenerate:()=>We,sender:()=>Ne});var me=E(require("pdf-parse")),pe=E(require("word-extractor")),R=E(require("node-html-to-image")),de=require("telegraf");var He=new pe.default;async function We(e,t){return new Promise(async function(a){let r=await fetch(e).catch(i=>{console.log(i)}),n={date:new Date(`${t.slice(-4)}-${t.slice(3,5)}-${t.slice(0,2)}`).getTime(),html:"null",typeFile:e.slice(-3),fileBuffer:r?.ok?Buffer.from(await r.clone().arrayBuffer()):Buffer.from([0]),link:e};if(r?.ok){let i=[],c=n.typeFile==="pdf"?(await(0,me.default)(n.fileBuffer)).text:(await He.extract(n.fileBuffer)).getBody(),m=(await o.groups.select_all()).map(h=>h.name),l=c.replace(/\t/g," ").split(`
`).filter(h=>!h.startsWith("\u0413\u0440\u0443\u043F\u043F\u0430")&&!h.startsWith("\u041F\u0410\u0420\u0410")&&h.replace(" ","")!==""&&!h.startsWith("\u041F\u0420\u0415\u041F\u041E\u0414\u0410\u0412\u0410\u0422\u0415\u041B\u042C")&&!h.startsWith("\u0417\u0410\u041C\u0415\u041D\u0410")&&h.replace(" ","")!=="\u041F\u041E"&&!h.startsWith("\u0420\u0410\u0421\u041F\u0418\u0421\u0410\u041D\u0418\u042E")),s=0;for(let h in l)if(l[s])if(l[s].match(/ЗАМЕНЫ/g)===null){let S="",w="",X=1;if(m.some(d=>(S=d,String(l[s]).includes(d.replace("-"," ")))),m.some(d=>(S=d,String(l[s]).includes(d)))||m.some(d=>(S=d,String(l[s]).includes(d.replace("-"," "))))?(w=[l[s]],l[s+1]&&!m.some(d=>String(l[s+1]).includes(d))&&!m.some(d=>String(l[s+1]).includes(d.replace("-"," ")))&&l[s+1].match(/ЗАМЕНЫ/g)===null&&(w.push(`${l[s+1]}`),l[s+2]&&!m.some(d=>String(l[s+2]).includes(d))&&!m.some(d=>String(l[s+2]).includes(d.replace("-"," ")))&&l[s+2].match(/ЗАМЕНЫ/g)===null&&(w.push(`${l[s+2]}`),l[s+3]&&!m.some(d=>String(l[s+3]).includes(d))&&!m.some(d=>String(l[s+3]).includes(d.replace("-"," ")))&&l[s+3].match(/ЗАМЕНЫ/g)===null&&(w.push(`${l[s+3]}`),l[s+4]&&!m.some(d=>String(l[s+4]).includes(d))&&!m.some(d=>String(l[s+4]).includes(d.replace("-"," ")))&&l[s+4].match(/ЗАМЕНЫ/g)===null&&(w.push(`${l[s+4]}`),l[s+5]&&!m.some(d=>String(l[s+5]).includes(d))&&!m.some(d=>String(l[s+5]).includes(d.replace("-"," ")))&&l[s+5].match(/ЗАМЕНЫ/g)===null&&(w.push(`${l[s+5]}`),l[s+6]&&!m.some(d=>String(l[s+6]).includes(d))&&!m.some(d=>String(l[s+6]).includes(d.replace("-"," ")))&&l[s+6].match(/ЗАМЕНЫ/g)===null&&w.push(`${l[s+6]}`)))))),X=w.length,S&&(w=w.join(" ").slice(S.length+1))):S&&(w=l[s].slice(S.length+1)),typeof w=="string"){let d=w.replace(/ +/g," ").split(/\. (?=[А-Яа-я0-9(])|\) (?=[А-Яа-я0-9(])/g).reverse()[0],I=w.replace(/ +/g," ").match(/[0-9]п([,\-])[0-9]п|[0-9]([,\-])[0-9]п|[0-9]п|[0-9]/)?.[0];I&&(w=w.replace(/ +/g," ").replace(I,"").replace(d,"")),i.push({text:`${w}`,group:S,pair:I,auditorium:d}),s+=X}}else i.push({text:`${l[s]} ${l[s+1]}`,group:"null",pair:"null",auditorium:"null"}),s+=2;n.html=await De(i)}a(n)})}async function Ne(e){let t=await o.users.select_all(),a=await o.replacement.select_by_index(0);if(e.html!=="null"&&e.html!==a.html){await o.replacement.insert(e.link,e.date,e.html);let r=await o.gradients.select_all_replGradients(),n=r[Math.floor(Math.random()*(r.length-1))],i=await(0,R.default)({html:`${f.HTMLSTART1}${n}${f.HTMLSTART2}${e.html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});for(let c of t){let m=`background-image: url(${c.theme});`,l=c.theme==="standard"?i:await(0,R.default)({html:`${f.HTMLSTART1}${m}${f.HTMLSTART2}${e.html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});c.payment!=="ban"&&c.settingsReplacement==="on"&&await u.telegram.sendPhoto(c.userId,de.Input.fromBuffer(Buffer.from(l),"replacement.png")).then(async()=>{await p.payment.alert(c)}).catch(s=>{console.log(s)})}}else await u.telegram.sendMessage(6018898378,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B")}async function De(e){let t=[];for(let a in e)if(e[a].group==="null")t.push(`<tr><td colspan="8"><b>${e[a].text}</b></td></tr>`),t.push('<tr><td><b>\u0413\u0440\u0443\u043F\u043F\u0430</b></td><td><b>\u041F\u0430\u0440\u0430</b></td><td colspan="2"><b>\u041F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td><td><b><===></b></td><td colspan="2"><b>\u0417\u0430\u043C\u0435\u043D\u0430</b></td><td><b>\u0410\u0443\u0434\u0438\u0442\u043E\u0440\u0438\u044F</b></td></tr>'),t.push('<tr><td colspan="8" class="line"></td></tr>');else{let r=/[А-Я][а-я]+ [А-Я].[А-Я].|\([а-я]+\)|\([А-Яа-я0-9 .]+ +[А-Яа-я0-9 .]+\)|[А-Яа-я0-9]+/g,i=e[a].text.replace(/ +/g," ").match(r),c=[],m=0;for(let s in i)if(Number(s)===m)if(i[Number(s)+1]&&i[Number(s)+1].startsWith("(")){let h=[`${i[Number(s)]}`,`
${i[Number(s)+1]}`];i[Number(s)+2]&&i[Number(s)+2].startsWith("(")&&(h.push(`
${i[Number(s)+2]}`),i[Number(s)+3]&&i[Number(s)+3].startsWith("(")&&h.push(`
${i[Number(s)+3]}`)),m+=h.length,c.push(h.join(" "))}else c.push(i[Number(s)]),m+=1;let l=`<td colspan="5"><b>${c.join(" ")}</b></td>`;c.length===1?l=`<td colspan="2"><b>${c[0]}</b></td><td><b></b></td><td colspan="2"><b></b></td>`:c.length===3?l=`<td colspan="2"><b>${c[0]}</b></td><td><b>${c[1]}</b></td><td colspan="2"><b>${c[2]}</b></td>`:c.length===2?l=`<td colspan="2"><b>${c[0]}</b></td><td><b></b></td><td colspan="2"><b>${c[1]}</b></td>`:c.length===4&&(l=`<td><b>${c[0]}</b></td><td><b>${c[1]}</b></td><td></td><td><b>${c[2]}</b></td><td><b>${c[3]}</b></td>`),e[Number(a)+1]?.group==="null"?(t.push(`<tr><td><b>${e[a].group}</b></td><td><b>${e[a].pair}</b></td>${l}<td><b>${e[a].auditorium}</b></td></tr>`),t.push('<tr><td colspan="8" class="line"></td></tr>')):t.push(`<tr><td><b>${e[a].group}</b></td><td><b>${e[a].pair}</b></td>${l}<td><b>${e[a].auditorium}</b></td></tr>`)}return await o.settings.update_value(t.join(""),"replacement"),t.join("")}var x={};b(x,{alert:()=>fe,paid:()=>Qe,preAlert:()=>ve,recount:()=>qe,referral:()=>A});async function qe(){let e=await o.users.select_all();for(let t of e){let a=t.price-t.price/100*(t.refAgents*6);if(t.payment==="true"&&(await o.users.update_payment(t.userId,"false"),await A(t,"false"),await u.telegram.sendMessage(t.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(a)}\u0440</b>
\u0414\u043B\u044F \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u0430 VIP \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(a*2)}\u0440, ${Math.round(a*3)}\u0440, ${Math.round(a*4)}\u0440, ${Math.round(a*5)}\u0440, ${Math.round(a*6)}\u0440)
\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)
\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435
<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>

\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 VIP2-3`,{parse_mode:"HTML"}).catch(r=>{console.log(r)})),t.payment==="false"&&(await o.users.update_payment(t.userId,"ban"),await A(t,"false"),await u.telegram.sendMessage(t.userId,`\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0437\u0430 \u043D\u0435\u0443\u043F\u043B\u0430\u0442\u0443(\u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0438\u043B\u0438 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(a*2)}\u0440</b>)
\u{1F517}<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>`,{parse_mode:"HTML"}).catch(r=>{console.log(r)})),t.payment.startsWith("vip")){let r=t.payment.slice(3)!=="0"?`vip${Number(t.payment.slice(3))-1}`:"true";await o.users.update_payment(t.userId,r),await u.telegram.sendMessage(t.userId,`\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043C\u0435\u043D\u0435\u043D \u043D\u0430 ${r==="true"?"\u043E\u043F\u043B\u0430\u0447\u0435\u043D":r}`,{parse_mode:"HTML"}).catch(n=>{console.log(n)})}}}async function ve(){let t=["31.01","28.02","31.03","30.04","31.05","30.06","31.07","31.08","30.09","31.10","30.11","31.12"][new Date().getMonth()],a=await o.users.select_all();for(let r of a)r.payment==="false"&&(await u.telegram.sendMessage(r.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0434\u043E ${t}, \u0438\u043D\u0430\u0447\u0435 \u0431\u0443\u0434\u0435\u0442\u0435 \u043E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043E\u0442 \u0431\u043E\u0442\u0430`).catch(n=>{console.log(n)}),await fe(r))}async function fe(e){if(e.payment==="false"){let t=e.price-e.price/100*(e.refAgents*6);await u.telegram.sendMessage(e.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(t)}\u0440</b>
\u0414\u043B\u044F \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u0430 VIP \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(t*2)}\u0440, ${Math.round(t*3)}\u0440, ${Math.round(t*4)}\u0440, ${Math.round(t*5)}\u0440, ${Math.round(t*6)}\u0440)
\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)
\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435
<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>

\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 VIP2-3`,{parse_mode:"HTML"}).catch(a=>{console.log(a)})}}async function Qe(){return new Promise(async function(e){let t=await o.users.select_all();t.sort((i,c)=>i.name.localeCompare(c.name));let a=[[]],r=0,n=0;for(let i of t)r%5===0&&r!==0?(n+=1,a.push([]),a[n].push({text:i.name,callback_data:`userPaid${i.userId}`}),r+=1):(a[n].push({text:i.name,callback_data:`userPaid${i.userId}`}),r+=1);e(a)})}async function A(e,t){let a=await o.referral.select_by_user(e.userId),r=t==="true"?"false":"true";if(a&&a.status===r){let n=await o.users.select(a.agentId),i=t==="true"?n.refAgents+1:n.refAgents-1;await o.referral.update_status(e.userId,t),await o.users.update_refAgents(a.agentId,i)}}var H={};b(H,{paidStatus:()=>Ke,setGroup:()=>Be,settings:()=>ge,userPaid:()=>Ue,userStatus:()=>Fe,vipStatus:()=>Ge});var _=require("telegraf");async function Ue(e,t){let r=(e.callbackQuery?.data).slice(t),n=await o.users.select(r);e.editMessageText(`\u0422\u0435\u043A\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441: ${n.payment}
\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u043D\u0430:`,{reply_markup:{inline_keyboard:[[_.Markup.button.callback("true",`userStatus_true__${r}`),_.Markup.button.callback("false",`userStatus_false_${r}`),_.Markup.button.callback("free",`userStatus_free__${r}`),_.Markup.button.callback("vip",`userStatus_vip___${r}`),_.Markup.button.callback("ban",`userStatus_ban___${r}`),_.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(i=>{console.log(i)})}async function Fe(e){let t=e.callbackQuery?.data,a=t.slice(17),r=await o.users.select(a);if(t.slice(11).startsWith("vip"))e.editMessageText("\u0423\u0440\u043E\u0432\u0435\u043D\u044C VIP:",{reply_markup:{inline_keyboard:[[_.Markup.button.callback("VIP0",`vipStatus_0_${a}`),_.Markup.button.callback("VIP1",`vipStatus_1_${a}`),_.Markup.button.callback("VIP2",`vipStatus_2_${a}`),_.Markup.button.callback("VIP3",`vipStatus_3_${a}`),_.Markup.button.callback("VIP4",`vipStatus_4_${a}`),_.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(n=>{console.log(n)});else if(t.slice(11).startsWith("ban"))await o.users.update_payment(a,"ban"),await p.payment.referral(r,"false"),await u.telegram.sendMessage(r.userId,"\u0412\u044B \u0431\u044B\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C").catch(n=>{console.log(n)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(n=>{console.log(n)});else if(t.slice(11).startsWith("undo")){let n=await p.payment.paid();e.editMessageText("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:n}}).catch(i=>{console.log(i)})}else{let n=t.slice(11).startsWith("false")?"false":t.slice(11,15);await o.users.update_payment(a,n),n!=="false"&&(await p.payment.referral(r,"true"),await o.users.update_paidWhenever(r.userId,"true")),n==="false"&&await p.payment.referral(r,"false"),await u.telegram.sendMessage(r.userId,`\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0441\u0442\u0430\u0442\u0443\u0441: ${n==="true"||n==="free"?"\u043E\u043F\u043B\u0430\u0447\u0435\u043D":"\u043D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D"}`).catch(i=>{console.log(i)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(i=>{console.log(i)})}}async function Ge(e){let t=e.callbackQuery?.data,a=t.slice(12),r=await o.users.select(a),n=`vip${t.slice(10,11)}`;await o.users.update_payment(a,n),await o.users.update_paidWhenever(a,"true"),await p.payment.referral(r,"true"),await u.telegram.sendMessage(r.userId,`\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0441\u0442\u0430\u0442\u0443\u0441: ${n}`).catch(i=>{console.log(i)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(i=>{console.log(i)})}async function Be(e){let t=e.callbackQuery?.data,a=e.from?.id,r=t.slice(8);a&&await o.users.update_group(a,r),await e.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u0430 \u0433\u0440\u0443\u043F\u043F\u0430: ${r}`).catch(n=>{console.log(n)})}async function Ke(e){let a=(e.callbackQuery?.data).slice(10);await u.telegram.sendMessage(a,"\u041E\u0448\u0438\u0431\u043A\u0430. \u0412\u044B \u043D\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443!").catch(r=>{console.log(r)}),u.telegram.deleteMessage(Number(e.callbackQuery?.from.id),Number(e.callbackQuery?.message?.message_id)).catch(r=>{console.log(r)})}var ge={keyboard:async e=>[[_.Markup.button.callback(`\u0414\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430: ${e.settingsDuty}`,`settingsDuty${e.userId}`),_.Markup.button.callback(`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${e.settingsSchedule}`,`settingsSchedule${e.userId}`),_.Markup.button.callback(`\u0417\u0430\u043C\u0435\u043D\u044B: ${e.settingsReplacement}`,`settingsReplacement${e.userId}`)]],schedule:async e=>{let t=e.callbackQuery?.data,a=await o.users.select(t.slice(16));await o.users.settings.update_schedule(a.userId,a.settingsSchedule==="on"?"off":"on"),a.settingsSchedule=a.settingsSchedule==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await ge.keyboard(a)}}).catch(r=>{console.log(r)})},replacement:async e=>{let t=e.callbackQuery?.data,a=await o.users.select(t.slice(19));await o.users.settings.update_replacement(a.userId,a.settingsReplacement==="on"?"off":"on"),a.settingsReplacement=a.settingsReplacement==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await p.callback_query.settings.keyboard(a)}}).catch(r=>{console.log(r)})},duty:async e=>{let t=e.callbackQuery?.data,a=await o.users.select(t.slice(12));await o.users.settings.update_duty(a.userId,a.settingsDuty==="on"?"off":"on"),a.settingsDuty=a.settingsDuty==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await p.callback_query.settings.keyboard(a)}}).catch(r=>{console.log(r)})}};var p={schedule:C,replacement:L,payment:x,callback_query:H};var W={};b(W,{execute:()=>Oe});async function Oe(e){e.chat?.id&&(await o.users.select(e.chat?.id)||(await o.users.insert(e.chat.id,e.from?.username,"true",e.from?.username,await je(e.chat.id)),await u.telegram.sendMessage(6018898378,`${e.chat.id} ${e.from?.username}, \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u043B\u0441\u044F \u043A \u0431\u043E\u0442\u0443`)),await e.reply(`\u0412\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0431\u043E\u0442\u0430!
\u0414\u043B\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0439 \u0440\u0430\u0431\u043E\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 (/setname \u0432\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F) \u0438 (/setgroup).
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0432\u0432\u0435\u0441\u0442\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447 \u043A\u043E\u043C\u0430\u043D\u0434\u043E\u0439 (/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447), \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u0435 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 \u043C\u0435\u0441\u044F\u0446 \u0431\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`))}async function je(e){return e<0?"null":e.toString().split("").map(Number).map(t=>(t||10)+64).map(t=>String.fromCharCode(Number(t))).join("")}var N={};b(N,{execute:()=>Ve});async function Ve(e){let{text:t}=e;if(t=t?.slice(6),e.chat?.id===6018898378&&t&&!t.startsWith("monica_schedule_bot")){let a=await o.users.select_all();for(let r of a)r.payment!=="ban"&&(await u.telegram.sendMessage(r.userId,t).catch(n=>{console.log(n)}),await p.payment.alert(r))}else await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}var D={};b(D,{execute:()=>ze});async function ze(e){await e.reply("\u041D\u0435 \u0443\u0434\u0430\u043B\u044F\u0439\u0442\u0435 \u044D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435!",{reply_markup:{resize_keyboard:!0,keyboard:[["\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B"]]}})}var q={};b(q,{execute:()=>Xe});async function Xe(e,t){if(e===6018898378){let a=[],r=(await o.settings.select("scheduleLink")).value,n=(await o.settings.select("replacementLink")).value,i=await(await fetch("http://rgkript.ru/raspisanie-zanyatiy/")).text(),c=new RegExp('<a href="http:\\/\\/rgkript.ru\\/wp-content\\/uploads\\/\\/'+new Date().getFullYear()+'[0-9/.\\-A-Za-z_]+"',"g"),m=Array.from(new Set(i.match(c))).map(s=>s.slice(9,-1)),l=i.match(/<strong>[А-Яа-я0-9. ]+/g);if(l)for(let s of l)s.match(/[0-9]+.[0-9]+.[0-9]+/g)&&a.push(s[0]);m[0]!==r?(await o.settings.update_value(m[0],"scheduleLink"),await u.telegram.sendMessage(e,`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${a[0]} ${m[0].slice(36)}`).then(s=>{setTimeout(()=>{u.telegram.deleteMessage(s.chat.id,s.message_id).catch(h=>{console.log(h)})},1e3*30)}).catch(s=>{console.log(s)}),await p.schedule.regenerate(m[0],a[0]).then(async s=>{await p.schedule.sender(s)})):await u.telegram.sendMessage(e,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").then(s=>{setTimeout(()=>{u.telegram.deleteMessage(s.chat.id,s.message_id).catch(h=>{console.log(h)})},1e3*30)}).catch(s=>{console.log(s)}),m[1]!==n?(await o.settings.update_value(m[1],"replacementLink"),await u.telegram.sendMessage(e,`\u0417\u0430\u043C\u0435\u043D\u044B: ${a[1]} ${m[1].slice(36)}`).then(s=>{setTimeout(()=>{u.telegram.deleteMessage(s.chat.id,s.message_id).catch(h=>{console.log(h)})},1e3*30)}).catch(s=>{console.log(s)}),await p.replacement.regenerate(m[1],a[1]).then(async s=>{await p.replacement.sender(s)})):await u.telegram.sendMessage(e,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B").then(s=>{setTimeout(()=>{u.telegram.deleteMessage(s.chat.id,s.message_id).catch(h=>{console.log(h)})},1e3*30)}).catch(s=>{console.log(s)})}else await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}var v={};b(v,{execute:()=>Ze});async function Ze(e){if(e.chat?.id){let t=await o.users.select(e.chat.id);t?t.userId>0?(await u.telegram.sendMessage(6018898378,`${t.name}(${t.userId}) \u043E\u043F\u043E\u0432\u0435\u0441\u0442\u0438\u043B \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435, \u0441\u0442\u0430\u0442\u0443\u0441: ${t.payment}`,{reply_markup:{inline_keyboard:[[{text:"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`paidStatus${t.userId}`},{text:"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`userPaid${t.userId}`}]]}}),await e.reply("\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0443 \u043E\u043F\u043B\u0430\u0442\u044B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D, \u043E\u0436\u0438\u0434\u0430\u0439\u0442\u0435")):await e.reply("\u041E\u0448\u0438\u0431\u043A\u0430. \u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B"):await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var Q={};b(Q,{execute:()=>Je});async function Je(e){if(console.log(e.chat?.id),e.chat?.id){console.log(1);let t=await o.users.select(e.chat.id);if(t){let a=t.groupName,r=t.userId,n=t.name,i=t.refKey,c=0;if(r===1177837026||r===6018898378){let l=await o.referral.select_by_agent(t.userId);for(let s of l){let h=await o.users.select(s.userId);s.status==="true"&&h.paidWhenever==="true"&&(c+=1)}await o.settings.update_number(36/100*c*39.5,"agentCost")}let m=r===1177837026||r===6018898378?38*c:6*t.refAgents;await e.reply(`\u0413\u0440\u0443\u043F\u043F\u0430: <b>${a}</b>
Id: \u{1F517}<code>${r}</code>
\u0424\u0430\u043C\u0438\u043B\u0438\u044F: <b>${n}</b>
\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B: <b>${t.payment==="true"?"\u043E\u043F\u043B\u0430\u0447\u0435\u043D":t.payment==="false"?"\u043D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D":t.payment}</b>
\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438: <b>${Math.floor(t.price-t.price*(m/100))}</b>
\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447: \u{1F517}<code>${i}</code>
\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432: <b>${m}%</b>
\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C: @a_korop`,{parse_mode:"HTML"})}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var U={};b(U,{execute:()=>Ye});async function Ye(e){if(e.chat?.id){let t=await o.users.select(e.chat.id),{text:a}=e;if(t)if(t.refKeyStatus==="false"){let r=a?.slice(10);if(r){let n=await o.users.select_refAgents_by_refKey(r);n?t.userId!==n.userId?(await o.users.update_refKeyStatus(t.userId,"true"),await o.users.update_payment(t.userId,"vip0"),await o.users.update_refAgents(n.userId,n.refAgents+1),await o.referral.insert(n.userId,t.userId,r),await e.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447!
\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 2 \u043C\u0435\u0441\u044F\u0446\u0430 (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 2-\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`)):await e.reply("\u0412\u044B \u043D\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u0441\u0432\u043E\u0439 \u0436\u0435 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447"):await e.reply(`\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u0430\u0433\u0435\u043D\u0442 \u0434\u043B\u044F \u043A\u043B\u044E\u0447\u0430: ${r}`)}else await e.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447(/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447)")}else await e.reply("\u0412\u044B \u0443\u0436\u0435 \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447, \u043B\u0438\u0431\u043E \u043E\u043F\u043B\u0430\u0447\u0438\u0432\u0430\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0440\u0430\u043D\u0435\u0435");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var F={};b(F,{execute:()=>et});var ye=require("telegraf"),he=E(require("node-html-to-image"));async function et(e){if(e.chat?.id){let t=await o.users.select(e.chat?.id);if(t)if(t.payment!=="ban"){let a=(await o.replacement.select_by_index(0)).html,r=await o.gradients.select_all_replGradients(),n=t.theme==="standard"?r[Math.floor(Math.random()*(r.length-1))]:`background-image: url(${t.theme});`,i=await(0,he.default)({html:`${f.HTMLSTART1}${n}${f.HTMLSTART2}${a}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});await e.replyWithPhoto(ye.Input.fromBuffer(Buffer.from(i),"schedule.png")),await p.payment.alert(t)}else await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var G={};b(G,{execute:()=>tt});async function tt(e){e.chat?.id===6018898378?(await e.reply("\u0411\u043E\u0442 \u0432\u044B\u043A\u043B\u044E\u0447\u0435\u043D!"),setTimeout(()=>{process.exit(0)},1e3*60)):await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}var B={};b(B,{execute:()=>at});var be=require("telegraf");var we=E(require("node-html-to-image"));async function at(e){if(e.chat?.id){let t=await o.users.select(e.chat.id);if(t)if(t.payment!=="ban")if(t.groupName!=="null"){let a=(await o.groups.select_schedule(t.groupName)).schedule;if(a!=="null"){let r=await o.gradients.select_all_gradients(),n=t.theme==="standard"?r[Math.floor(Math.random()*(r.length-1))]:`background-image: url(${t.theme});`,i=await(0,we.default)({html:`${f.HTMLSTART1}${n}${f.HTMLSTART2}${a}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});await e.replyWithPhoto(be.Input.fromBuffer(Buffer.from(i),"schedule.png")),await p.payment.alert(t)}else await e.reply("\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E")}else await e.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443 /setgroup");else await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var K={};b(K,{execute:()=>rt});async function rt(e){if(e.chat?.id)if(await o.users.select(e.chat.id)){let a=await o.groups.select_all(),r=[[]],n=0,i=0;for(let c of a)n%5===0&&n!==0?(i+=1,r.push([]),r[i].push({text:c.name,callback_data:`setGroup${c.name}`}),n+=1):(r[i].push({text:c.name,callback_data:`setGroup${c.name}`}),n+=1);await e.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443:",{reply_markup:{inline_keyboard:r}})}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}var O={};b(O,{execute:()=>nt});async function nt(e){if(e.chat?.id){let t=await o.users.select(e.chat.id),{text:a}=e;if(t){let r=a?.slice(9);r?(await o.users.update_name(t.userId,r),await e.reply(`\u0412\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F - ${r}`)):await e.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0444\u0430\u043C\u0438\u043B\u0438\u044E(/setname \u0432\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F)")}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var j={};b(j,{execute:()=>st});async function st(e){if(e.chat?.id){let t=await o.users.select(e.chat?.id);t?await e.reply("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await p.callback_query.settings.keyboard(t.userId)}}):await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var V={};b(V,{execute:()=>ot});async function ot(e){if(e.chat?.id===6018898378){let t=await p.payment.paid();await e.reply("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:t}})}else await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}var z={};b(z,{execute:()=>it});async function it(e){if(e.chat?.id){let t=await o.users.select(e.chat?.id),{text:a}=e,r=a?.slice(7);t.payment!=="ban"?t&&r&&!r.startsWith("monica_schedule_bot")&&r.match(/\.(jpeg|jpg|png)$/)!=null?(await o.users.update_theme(t.userId,r),await e.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0442\u0435\u043C\u0430: ${r}`)):await e.reply("\u041E\u0448\u0438\u0431\u043A\u0430, \u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0432\u044B \u043D\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0432 \u0431\u043E\u0442\u0435, \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443, \u043A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B \u0438\u043B\u0438 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0435 \u0432\u0435\u0434\u0435\u0442 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443"):await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C")}}var $={start:W,send:N,duty:D,fetch:q,paid:v,profile:Q,referral:U,replacement:F,restart:G,schedule:B,setGroup:K,setName:O,settings:j,status:V,theme:z};var u=new $e.Telegraf(f.TOKEN);u.launch();u.telegram.sendMessage(6018898378,"\u0411\u043E\u0442 \u0437\u0430\u043F\u0443\u0449\u0435\u043D!").then(e=>setTimeout(()=>{u.telegram.deleteMessage(e.chat.id,e.message_id)},30*1e3)).catch(e=>{console.log(e)});var T=(0,Ee.default)();T.use((0,Se.default)());T.get("/",(e,t)=>{t.sendFile(_e.join(__dirname+"/index.html"))});T.get("/scheduleTable/[0-9]+",async(e,t)=>{let a=await o.users.select(Number(e.url.slice(15))),r=await o.groups.select_schedule(a.groupName);t.send({table:r.schedule})});T.get("/replacementTable/[0-9]+",async(e,t)=>{let a=await o.replacement.select_by_index(Number(e.url.slice(18))),r=a?a.html:null;t.send({table:r})});T.get("/randomGradient",async(e,t)=>{let a=await o.gradients.select_all_gradients(),r=a[Math.floor(Math.random()*(a.length-1))];t.send({gradient:r.slice(11,-1)})});T.get("/selectGroup/[0-9]+",async(e,t)=>{let a=await o.users.select(Number(e.url.slice(13))),r=await o.groups.select_all(),n=[],i=[];for(let c of r)c.name===a.groupName?n.push(`<option selected value='${c.name}'>${c.name}</option>`):c.schedule==="null"?i.push(`<option disabled value='${c.name}'>${c.name}</option>`):n.push(`<option value='${c.name}'>${c.name}</option>`);t.send({table:n.concat(i).join("")})});T.get("/updateGroup/[0-9%A-Za-z-]+",async(e,t)=>{let a=await o.groups.select_schedule(decodeURI(e.url.slice(13)));t.send({table:a.schedule})});var lt=Te.createServer(T);lt.listen(3e3,"46.23.96.113");u.command("start",e=>{$.start.execute(e)});u.command("fetch",e=>{$.fetch.execute(e.chat.id,e)});u.command("send",e=>{$.send.execute(e)});u.command("schedule",e=>{$.schedule.execute(e)});u.command("theme",e=>{$.theme.execute(e)});u.command("status",e=>{$.status.execute(e)});u.command("settings",e=>{$.settings.execute(e)});u.command("profile",e=>{console.log("111"),$.profile.execute(e)});u.command("setname",e=>{$.setName.execute(e)});u.command("setgroup",e=>{$.setGroup.execute(e)});u.command("referral",e=>{$.referral.execute(e)});u.command("paid",e=>{$.paid.execute(e)});u.command("replacement",e=>{$.replacement.execute(e)});u.command("restart",e=>{$.restart.execute(e)});u.command("duty",e=>{$.duty.execute(e)});u.on("callback_query",async e=>{let t=e.callbackQuery?.data;t.startsWith("userPaid")&&await p.callback_query.userPaid(e,8),t.startsWith("paidStatus")&&await p.callback_query.paidStatus(e),t.startsWith("userStatus")&&await p.callback_query.userStatus(e),t.startsWith("vipStatus")&&await p.callback_query.vipStatus(e),t.startsWith("settings")&&(t.startsWith("settingsSchedule")&&await p.callback_query.settings.schedule(e),t.startsWith("settingsReplacement")&&await p.callback_query.settings.replacement(e),t.startsWith("settingsDuty")&&await p.callback_query.settings.duty(e)),t.startsWith("setGroup")&&await p.callback_query.setGroup(e)});M.CronJob.from({cronTime:"0 10 14 * * 1-5,7",onTick:async()=>{await $.fetch.execute(6018898378)},start:!0});M.CronJob.from({cronTime:"0 0 13 1 * *",onTick:async()=>{await p.payment.recount().catch(e=>{console.log(e)})},start:!0});M.CronJob.from({cronTime:"0 35 7 25-31 * *",onTick:async()=>{await p.payment.preAlert().catch(e=>{console.log(e)})},start:!0});0&&(module.exports={bot});
