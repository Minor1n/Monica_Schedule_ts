"use strict";var rt=Object.create;var R=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var nt=Object.getOwnPropertyNames;var it=Object.getPrototypeOf,lt=Object.prototype.hasOwnProperty;var S=(e,t)=>{for(var r in t)R(e,r,{get:t[r],enumerable:!0})},we=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of nt(t))!lt.call(e,s)&&s!==r&&R(e,s,{get:()=>t[s],enumerable:!(a=st(t,s))||a.enumerable});return e};var T=(e,t,r)=>(r=e!=null?rt(it(e)):{},we(t||!e||!e.__esModule?R(r,"default",{value:e,enumerable:!0}):r,e)),ot=e=>we(R({},"__esModule",{value:!0}),e);var Ot={};S(Ot,{bot:()=>m});module.exports=ot(Ot);var $e=T(require("dotenv"));$e.default.config();var{TOKEN:_e,PASSWORD:Te,SQLHOST:Se,SQLUSER:Ee,SQLDATABASE:Me,SQLPASSWORD:ke,HTMLSTART1:De,HTMLSTART2:Pe,HTMLEND:Ie,PUPPETEER:Re}=process.env;if(!_e||!Te||!Se||!Ee||!Me||!ke||!De||!Pe||!Ie||!Re)throw new Error("Missing environment variables");var ut=new Map().set(-1,"free").set(0,"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D, \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B \u043D\u0435 \u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D").set(1,"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D, \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B \u0447\u0430\u0441\u0442\u0438\u0447\u043D\u043E \u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D").set(2,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 1 \u043C\u0435\u0441\u044F\u0446").set(3,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 2 \u043C\u0435\u0441\u044F\u0446\u0430").set(4,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 3 \u043C\u0435\u0441\u044F\u0446\u0430").set(5,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 4 \u043C\u0435\u0441\u044F\u0446\u0430").set(6,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 5 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(7,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 6 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(8,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 7 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(9,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 8 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(10,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 9 \u043C\u0435\u0441\u044F\u0446\u0435\u0432"),d={TOKEN:_e,PASSWORD:Te,SQLHOST:Se,SQLUSER:Ee,SQLDATABASE:Me,SQLPASSWORD:ke,HTMLSTART1:De,HTMLSTART2:Pe,HTMLEND:Ie,PUPPETEER:eval(`(${Re})`),payment:ut};var at=require("telegraf"),B=require("cron");var q={};S(q,{regenerate:()=>dt,sender:()=>ct});var Le=T(require("mysql"));var mt={host:d.SQLHOST,user:d.SQLUSER,database:d.SQLDATABASE,password:d.SQLPASSWORD},y=Le.default.createPool(mt),i={users:{select:async e=>new Promise(async function(t,r){y.query(`SELECT * FROM users WHERE userId = '${e}'`,(a,s)=>{a&&r(a),t(s[0])})}),select_all_by_group:async e=>new Promise(async function(t,r){y.query(`SELECT * FROM users WHERE groupName = '${e}'`,(a,s)=>{a&&r(a),t(s)})}),select_all:async()=>new Promise(async function(e,t){y.query("SELECT * FROM users",(r,a)=>{r&&t(r),e(a)})}),select_refAgents_by_refKey:async e=>new Promise(async function(t,r){y.query(`SELECT * FROM users WHERE refKey = '${e}'`,(a,s)=>{a&&r(a),t(s[0])})}),insert:async(e,t,r,a,s)=>{y.query(`INSERT INTO users (userId,userName,payment,name,refKey) values('${e}','${t}','${r}','${a}','${s}')`)},update_payment:async function(e,t){y.query(`UPDATE users SET payment = '${t}' WHERE userId = '${e}'`)},update_theme:async function(e,t){y.query(`UPDATE users SET theme = '${t}' WHERE userId = '${e}'`)},update_duty:async function(e,t){y.query(`UPDATE users SET duty = '${t}' WHERE userId = '${e}'`)},update_dutyDate:async function(e,t){y.query(`UPDATE users SET dutyDate = '${t}' WHERE userId = '${e}'`)},update_scheduleDate:async function(e,t){y.query(`UPDATE users SET scheduleDate = '${t}' WHERE userId = '${e}'`)},update_name:async(e,t)=>{y.query(`UPDATE users SET name = '${t}' WHERE userId = '${e}'`)},update_refAgents:async(e,t)=>{y.query(`UPDATE users SET refAgents = '${t}' WHERE userId = '${e}'`)},update_group:async(e,t)=>{y.query(`UPDATE users SET groupName = '${t}' WHERE userId = '${e}'`)},update_refKeyStatus:async(e,t)=>{y.query(`UPDATE users SET refKeyStatus = '${t}' WHERE userId = '${e}'`)},update_paidWhenever:async(e,t)=>{y.query(`UPDATE users SET paidWhenever = '${t}' WHERE userId = '${e}'`)},update_lightMode:async function(e,t){y.query(`UPDATE users SET lightMode = '${t}' WHERE userId = '${e}'`)},settings:{update_schedule:async function(e,t){y.query(`UPDATE users SET settingsSchedule = '${t}' WHERE userId = '${e}'`)},update_replacement:async function(e,t){y.query(`UPDATE users SET settingsReplacement = '${t}' WHERE userId = '${e}'`)},update_duty:async function(e,t){y.query(`UPDATE users SET settingsDuty = '${t}' WHERE userId = '${e}'`)}}},settings:{select:async e=>new Promise(async function(t,r){y.query(`SELECT * FROM settings WHERE type = '${e}'`,(a,s)=>{a&&r(a),t(s[0])})}),update_value:async(e,t)=>{y.query(`UPDATE settings SET value = '${e}' WHERE type = '${t}'`)},update_number:async(e,t)=>{y.query(`UPDATE settings SET number = '${e}' WHERE type = '${t}'`)}},groups:{select_all:async()=>new Promise(async function(e,t){y.query("SELECT * FROM groups",(r,a)=>{r&&t(r),e(a)})}),select_schedule:async e=>new Promise(async function(t,r){y.query(`SELECT * FROM groups WHERE name = '${e}'`,(a,s)=>{a&&r(a),t(s[0])})}),update_schedule:async(e,t)=>{y.query(`UPDATE groups SET schedule = '${t}' WHERE name = '${e}'`)}},referral:{insert:async(e,t,r)=>{y.query(`INSERT INTO referrals (agentId,userId,refKey) VALUES('${e}','${t}','${r}')`)},select_by_user:async e=>new Promise(async function(t,r){y.query(`SELECT * FROM referrals WHERE userId = '${e}'`,(a,s)=>{a&&r(a),t(s[0])})}),select_by_agent:async e=>new Promise(async function(t,r){y.query(`SELECT * FROM referrals WHERE agentId = '${e}'`,(a,s)=>{a&&r(a),t(s)})}),update_status:async(e,t)=>{y.query(`UPDATE referrals SET status = '${t}' WHERE userId = '${e}'`)}},replacement:{select_by_index:async e=>new Promise(async function(t,r){y.query("SELECT * FROM replacements",(a,s)=>{a&&r(a),t(s[Number(s.length)-1-e])})}),insert:async(e,t,r)=>{y.query(`INSERT INTO replacements (link,date,html) VALUES('${e}','${t}','${r}')`)}},gradients:{select_all_gradients:async()=>new Promise(async function(e,t){y.query("SELECT * FROM gradients",(r,a)=>{r&&t(r),e(a.map(s=>s.css))})}),select_all_replGradients:async()=>new Promise(async function(e,t){y.query("SELECT * FROM replGradients",(r,a)=>{r&&t(r),e(a.map(s=>s.css))})})},duty:{select:async(e,t,r)=>new Promise(async function(a,s){y.query(`SELECT * FROM duty WHERE \`group\` = '${e}' AND date>${t} AND date<${r}`,(n,u)=>{n&&s(n),a(u)})}),insert:async(e,t,r,a)=>{y.query(`INSERT INTO duty (\`group\`,\`date\`,\`user\`,\`name\`) values('${e}','${t}','${r}','${a}')`)}}};var Ne=T(require("xlsx")),v=T(require("node-html-to-image")),Ae=require("telegraf");async function dt(e,t){return new Promise(async function(r){let a=await fetch(e).catch(n=>{console.log(n)}),s=[];if(!a?.ok)s="notfound";else{let n=new Date(`${t.slice(-4)}-${t.slice(3,5)}-${t.slice(0,2)}`).getTime(),u=[],c=await i.users.select_all();for(let o of c)u.indexOf(o.groupName)===-1&&o.groupName!=="null"&&u.push(o.groupName);for(let o of u){let l=await pt(a,o);s.push({group:o,html:l,date:n})}}r(s)})}async function ct(e){let t=await i.users.select_all();if(e==="notfound")await m.telegram.sendMessage(6018898378,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").catch(r=>{console.log(r)});else{let r=await i.gradients.select_all_gradients(),a=r[Math.floor(Math.random()*(r.length-1))];for(let s of e)if(typeof s!="string"&&s.html!==""){await i.groups.update_schedule(s.group,s.html);let n=await(0,v.default)({html:`${d.HTMLSTART1}${a}${d.HTMLSTART2}${s.html}${d.HTMLEND}`,puppeteerArgs:d.PUPPETEER});for(let u of t)if(u.payment!==0&&e!=="notfound"&&u.settingsSchedule==="on"&&u.groupName===s.group&&await f.payment.groupTG(u)){let c=`background-image: url(${u.theme});`,o=u.theme==="standard"?n:await(0,v.default)({html:`${d.HTMLSTART1}${c}${d.HTMLSTART2}${s.html}${d.HTMLEND}`,puppeteerArgs:d.PUPPETEER});await m.telegram.sendPhoto(u.userId,Ae.Input.fromBuffer(Buffer.from(o),"schedule.png")).then(async()=>{await f.payment.alert(u)}).catch(l=>{console.log(l)})}}}}async function pt(e,t){let r=Ne.default.read(Buffer.from(await e.clone().arrayBuffer())),a=r.SheetNames,s=r.Sheets[a[1]],n,u=[];for(let c in s)if(c.toString()[0]==="B"&&s[c].v===t){n=Number(c.slice(1))-3;for(let o=n+1;o<n+28;o++){let l=[];l.push(s[`A${o}`]?`<td><b>${s[`A${o}`].v}</b></td>`:"<td></td>"),l.push(s[`B${o}`]?`<td><b>${s[`B${o}`].v}</b></td>`:"<td></td>"),l.push(s[`C${o}`]?`<td><b>${s[`C${o}`].v}</b></td>`:"<td></td>"),l.push(s[`D${o}`]?`<td><b>${s[`D${o}`].v}</b></td>`:"<td></td>"),l.push(s[`E${o}`]?`<td><b>${s[`E${o}`].v}</b></td>`:"<td></td>"),l.push(s[`F${o}`]?`<td><b>${s[`F${o}`].v}</b></td>`:"<td></td>"),l.push(s[`G${o}`]?`<td><b>${s[`G${o}`].v}</b></td>`:"<td></td>"),u.push((o-n)%4===0?`<tr>${l.join(" ")}</tr><tr><td colspan="7" class="line"></td></tr>`:`<tr>${l.join(" ")}</tr>`)}}return u.join("")}var U={};S(U,{regenerate:()=>gt,sender:()=>bt});var Ce=T(require("pdf-parse")),He=T(require("word-extractor")),Q=T(require("node-html-to-image")),xe=require("telegraf");var ft=new He.default;async function gt(e,t){return new Promise(async function(r){let a=await fetch(e).catch(n=>{console.log(n)}),s={date:new Date(`${t.slice(-4)}-${t.slice(3,5)}-${t.slice(0,2)}`).getTime(),html:"null",typeFile:e.slice(-3),fileBuffer:a?.ok?Buffer.from(await a.clone().arrayBuffer()):Buffer.from([0]),link:e};if(a?.ok){let n=[],u=s.typeFile==="pdf"?(await(0,Ce.default)(s.fileBuffer)).text:(await ft.extract(s.fileBuffer)).getBody(),c=(await i.groups.select_all()).map(b=>b.name),o=u.replace(/\t/g," ").split(`
`).filter(b=>!b.startsWith("\u0413\u0440\u0443\u043F\u043F\u0430")&&!b.startsWith("\u041F\u0410\u0420\u0410")&&b.replace(" ","")!==""&&!b.startsWith("\u041F\u0420\u0415\u041F\u041E\u0414\u0410\u0412\u0410\u0422\u0415\u041B\u042C")&&!b.startsWith("\u0417\u0410\u041C\u0415\u041D\u0410")&&b.replace(" ","")!=="\u041F\u041E"&&!b.startsWith("\u0420\u0410\u0421\u041F\u0418\u0421\u0410\u041D\u0418\u042E")),l=0;for(let b in o)if(o[l])if(o[l].match(/ЗАМЕНЫ/g)===null){let h="",w="",$=1;if(c.some(g=>(h=g,String(o[l]).includes(g.replace("-"," ")))),c.some(g=>(h=g,String(o[l]).includes(g)))||c.some(g=>(h=g,String(o[l]).includes(g.replace("-"," "))))?(w=[o[l]],o[l+1]&&!c.some(g=>String(o[l+1]).includes(g))&&!c.some(g=>String(o[l+1]).includes(g.replace("-"," ")))&&o[l+1].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+1]}`),o[l+2]&&!c.some(g=>String(o[l+2]).includes(g))&&!c.some(g=>String(o[l+2]).includes(g.replace("-"," ")))&&o[l+2].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+2]}`),o[l+3]&&!c.some(g=>String(o[l+3]).includes(g))&&!c.some(g=>String(o[l+3]).includes(g.replace("-"," ")))&&o[l+3].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+3]}`),o[l+4]&&!c.some(g=>String(o[l+4]).includes(g))&&!c.some(g=>String(o[l+4]).includes(g.replace("-"," ")))&&o[l+4].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+4]}`),o[l+5]&&!c.some(g=>String(o[l+5]).includes(g))&&!c.some(g=>String(o[l+5]).includes(g.replace("-"," ")))&&o[l+5].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+5]}`),o[l+6]&&!c.some(g=>String(o[l+6]).includes(g))&&!c.some(g=>String(o[l+6]).includes(g.replace("-"," ")))&&o[l+6].match(/ЗАМЕНЫ/g)===null&&w.push(`${o[l+6]}`)))))),$=w.length,h&&(w=w.join(" ").slice(h.length+1))):h&&(w=o[l].slice(h.length+1)),typeof w=="string"){let g=w.replace(/ +/g," ").split(/\. (?=[А-Яа-я0-9(])|\) (?=[А-Яа-я0-9(])/g).reverse()[0],I=w.replace(/ +/g," ").match(/[0-9]п([,\-])[0-9]п|[0-9]([,\-])[0-9]п|[0-9]п|[0-9]/)?.[0];I&&(w=w.replace(/ +/g," ").replace(I,"").replace(g,"")),n.push({text:`${w}`,group:h,pair:I,auditorium:g}),l+=$}}else n.push({text:`${o[l]} ${o[l+1]}`,group:"null",pair:"null",auditorium:"null"}),l+=2;s.html=await yt(n)}r(s)})}async function bt(e){let t=await i.users.select_all(),r=await i.replacement.select_by_index(0);if(e.html!=="null"&&e.html!==r.html){await i.replacement.insert(e.link,e.date,e.html);let a=await i.gradients.select_all_replGradients(),s=a[Math.floor(Math.random()*(a.length-1))],n=await(0,Q.default)({html:`${d.HTMLSTART1}${s}${d.HTMLSTART2}${e.html}${d.HTMLEND}`,puppeteerArgs:d.PUPPETEER});for(let u of t){let c=`background-image: url(${u.theme});`,o=u.theme==="standard"?n:await(0,Q.default)({html:`${d.HTMLSTART1}${c}${d.HTMLSTART2}${e.html}${d.HTMLEND}`,puppeteerArgs:d.PUPPETEER});u.payment!==0&&u.settingsReplacement==="on"&&await f.payment.groupTG(u)&&await m.telegram.sendPhoto(u.userId,xe.Input.fromBuffer(Buffer.from(o),"replacement.png")).then(async()=>{await f.payment.alert(u)}).catch(l=>{console.log(l)})}}else await m.telegram.sendMessage(6018898378,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B")}async function yt(e){let t=[];for(let r in e)if(e[r].group==="null")t.push(`<tr><td colspan="8"><b>${e[r].text}</b></td></tr>`),t.push('<tr><td><b>\u0413\u0440\u0443\u043F\u043F\u0430</b></td><td><b>\u041F\u0430\u0440\u0430</b></td><td colspan="2"><b>\u041F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td><td><b><===></b></td><td colspan="2"><b>\u0417\u0430\u043C\u0435\u043D\u0430</b></td><td><b>\u0410\u0443\u0434\u0438\u0442\u043E\u0440\u0438\u044F</b></td></tr>'),t.push('<tr><td colspan="8" class="line"></td></tr>');else{let a=/[А-Я][а-я]+ [А-Я].[А-Я].|\([а-я]+\)|\([А-Яа-я0-9 .]+ +[А-Яа-я0-9 .]+\)|[А-Яа-я0-9]+/g,n=e[r].text.replace(/ +/g," ").match(a),u=[],c=0;for(let l in n)if(Number(l)===c)if(n[Number(l)+1]&&n[Number(l)+1].startsWith("(")){let b=[`${n[Number(l)]}`,`
${n[Number(l)+1]}`];n[Number(l)+2]&&n[Number(l)+2].startsWith("(")&&(b.push(`
${n[Number(l)+2]}`),n[Number(l)+3]&&n[Number(l)+3].startsWith("(")&&b.push(`
${n[Number(l)+3]}`)),c+=b.length,u.push(b.join(" "))}else u.push(n[Number(l)]),c+=1;let o=`<td colspan="5"><b>${u.join(" ")}</b></td>`;u.length===1?o=`<td colspan="2"><b>${u[0]}</b></td><td><b></b></td><td colspan="2"><b></b></td>`:u.length===3?o=`<td colspan="2"><b>${u[0]}</b></td><td><b>${u[1]}</b></td><td colspan="2"><b>${u[2]}</b></td>`:u.length===2?o=`<td colspan="2"><b>${u[0]}</b></td><td><b></b></td><td colspan="2"><b>${u[1]}</b></td>`:u.length===4&&(o=`<td><b>${u[0]}</b></td><td><b>${u[1]}</b></td><td></td><td><b>${u[2]}</b></td><td><b>${u[3]}</b></td>`),e[Number(r)+1]?.group==="null"?(t.push(`<tr><td><b>${e[r].group}</b></td><td><b>${e[r].pair}</b></td>${o}<td><b>${e[r].auditorium}</b></td></tr>`),t.push('<tr><td colspan="8" class="line"></td></tr>')):t.push(`<tr><td><b>${e[r].group}</b></td><td><b>${e[r].pair}</b></td>${o}<td><b>${e[r].auditorium}</b></td></tr>`)}return await i.settings.update_value(t.join(""),"replacement"),t.join("")}var G={};S(G,{alert:()=>Be,groupTG:()=>_t,paid:()=>$t,preAlert:()=>wt,recount:()=>ht,referral:()=>F});async function ht(){let e=await i.users.select_all();for(let t of e){let r=t.price-t.price/100*(t.refAgents*6);t.payment===1?(await F(t,"false"),await m.telegram.sendMessage(t.userId,`\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0437\u0430 \u043D\u0435\u0443\u043F\u043B\u0430\u0442\u0443(\u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0438\u043B\u0438 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(r*2)}\u0440</b>)
\u{1F517}<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>`,{parse_mode:"HTML"}).catch(a=>{console.log(a)})):t.payment===2?(await F(t,"false"),await m.telegram.sendMessage(t.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(r)}\u0440</b>
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u044C \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(r*2)}\u0440, ${Math.round(r*3)}\u0440, ${Math.round(r*4)}\u0440, ${Math.round(r*5)}\u0440, ${Math.round(r*6)}\u0440)
\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)
\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435
<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>

\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 3 \u043C\u0435\u0441\u044F\u0446\u0430`,{parse_mode:"HTML"}).catch(a=>{console.log(a)})):t.payment>2&&await m.telegram.sendMessage(t.userId,`\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043C\u0435\u043D\u0435\u043D \u043D\u0430 ${d.payment.get(t.payment-1)}`,{parse_mode:"HTML"}).catch(a=>{console.log(a)}),t.payment>0&&await i.users.update_payment(t.userId,t.payment-1)}}async function wt(){let t=["31.01","28.02","31.03","30.04","31.05","30.06","31.07","31.08","30.09","31.10","30.11","31.12"][new Date().getMonth()],r=await i.users.select_all();for(let a of r)a.payment===1&&(await m.telegram.sendMessage(a.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0434\u043E ${t}, \u0438\u043D\u0430\u0447\u0435 \u0431\u0443\u0434\u0435\u0442\u0435 \u043E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043E\u0442 \u0431\u043E\u0442\u0430`).catch(s=>{console.log(s)}),await Be(a))}async function Be(e){if(e.payment===1){let t=e.price-e.price/100*(e.refAgents*6);await m.telegram.sendMessage(e.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(t)}\u0440</b>
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u044C \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(t*2)}\u0440, ${Math.round(t*3)}\u0440, ${Math.round(t*4)}\u0440, ${Math.round(t*5)}\u0440, ${Math.round(t*6)}\u0440)
\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)
\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435
<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>

\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 3 \u043C\u0435\u0441\u044F\u0446\u0430`,{parse_mode:"HTML"}).catch(r=>{console.log(r)})}}async function $t(){return new Promise(async function(e){let t=await i.users.select_all();t.sort((n,u)=>n.name.localeCompare(u.name));let r=[[]],a=0,s=0;for(let n of t)a%5===0&&a!==0?(s+=1,r.push([]),r[s].push({text:n.name,callback_data:`userPaid${n.userId}`}),a+=1):(r[s].push({text:n.name,callback_data:`userPaid${n.userId}`}),a+=1);e(r)})}async function F(e,t){let r=await i.referral.select_by_user(e.userId),a=t==="true"?"false":"true";if(r&&r.status===a){let s=await i.users.select(r.agentId),n=t==="true"?s.refAgents+1:s.refAgents-1;await i.referral.update_status(e.userId,t),await i.users.update_refAgents(r.agentId,n)}}async function _t(e){if(e.userId<0){let t=await i.users.select_all(),r=0;for(let a of t)if(a.userId!==e.userId&&-1<a.payment&&a.payment<2){let s=await m.telegram.getChatMember(e.userId,a.userId);(s.status==="member"||s.status==="creator"||s.status==="administrator")&&(r+=1)}return r===Number(m.telegram.getChatMembersCount(e.userId))}else return!0}var X={};S(X,{paidStatus:()=>Z,setDutyDay:()=>V,setGroup:()=>z,settings:()=>M,userPaid:()=>K,userStatus:()=>O,vipStatus:()=>j});var _=require("telegraf");async function K(e,t){let a=(e.callbackQuery?.data).slice(t),s=await i.users.select(a);e.editMessageText(`\u0422\u0435\u043A\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441: ${d.payment.get(s.payment)}
\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u043D\u0430:`,{reply_markup:{inline_keyboard:[[_.Markup.button.callback("true",`userStatus_2___${a}`),_.Markup.button.callback("false",`userStatus_1___${a}`),_.Markup.button.callback("free",`userStatus_f___${a}`),_.Markup.button.callback("vip",`userStatus_vip_${a}`),_.Markup.button.callback("ban",`userStatus_0___${a}`),_.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(n=>{console.log(n)})}async function O(e){let t=e.callbackQuery?.data,r=t.slice(15),a=await i.users.select(r);if(t.slice(11).startsWith("vip"))e.editMessageText("\u0423\u0440\u043E\u0432\u0435\u043D\u044C VIP:",{reply_markup:{inline_keyboard:[[_.Markup.button.callback("2\u043C\u0435\u0441",`vipStatus_3_${r}`),_.Markup.button.callback("3\u043C\u0435\u0441",`vipStatus_4_${r}`),_.Markup.button.callback("4\u043C\u0435\u0441",`vipStatus_5_${r}`),_.Markup.button.callback("5\u043C\u0435\u0441",`vipStatus_6_${r}`),_.Markup.button.callback("6\u043C\u0435\u0441",`vipStatus_7_${r}`),_.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(s=>{console.log(s)});else if(t.slice(11).startsWith("0"))await i.users.update_payment(r,0),await f.payment.referral(a,"false"),await m.telegram.sendMessage(a.userId,"\u0412\u044B \u0431\u044B\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C").catch(s=>{console.log(s)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(s=>{console.log(s)});else if(t.slice(11).startsWith("undo")){let s=await f.payment.paid();e.editMessageText("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:s}}).catch(n=>{console.log(n)})}else{let s=t.slice(11).startsWith("f")?-1:Number(t.slice(11,12));await i.users.update_payment(r,s),s!==1&&(await f.payment.referral(a,"true"),await i.users.update_paidWhenever(a.userId,"true")),s===1&&await f.payment.referral(a,"false"),await m.telegram.sendMessage(a.userId,`\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0441\u0442\u0430\u0442\u0443\u0441: ${d.payment.get(s)}`).catch(n=>{console.log(n)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(n=>{console.log(n)})}}async function j(e){let t=e.callbackQuery?.data,r=t.slice(12),a=await i.users.select(r),s=Number(t.slice(10,11));await i.users.update_payment(r,s),await i.users.update_paidWhenever(r,"true"),await f.payment.referral(a,"true"),await m.telegram.sendMessage(a.userId,`\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0441\u0442\u0430\u0442\u0443\u0441: ${d.payment.get(s)}`).catch(n=>{console.log(n)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(n=>{console.log(n)})}async function z(e){let t=e.callbackQuery?.data,r=e.from?.id,a=t.slice(8);r&&await i.users.update_group(r,a),await e.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u0430 \u0433\u0440\u0443\u043F\u043F\u0430: ${a}`).catch(s=>{console.log(s)})}async function Z(e){let r=(e.callbackQuery?.data).slice(10);await m.telegram.sendMessage(r,"\u041E\u0448\u0438\u0431\u043A\u0430. \u0412\u044B \u043D\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443!").catch(a=>{console.log(a)}),m.telegram.deleteMessage(Number(e.callbackQuery?.from.id),Number(e.callbackQuery?.message?.message_id)).catch(a=>{console.log(a)})}async function V(e){let t=e.callbackQuery?.data,r=e.from?.id,a=Number(t.slice(10)),s=new Map().set(1,"\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A").set(2,"\u0412\u0442\u043E\u0440\u043D\u0438\u043A").set(3,"\u0421\u0440\u0435\u0434\u0430").set(4,"\u0427\u0435\u0442\u0432\u0435\u0440\u0433").set(5,"\u041F\u044F\u0442\u043D\u0438\u0446\u0430").set(6,"\u0421\u0443\u0431\u0431\u043E\u0442\u0430");r&&await i.users.update_scheduleDate(r,a),await e.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D \u0434\u0435\u043D\u044C: ${s.get(a)}`).catch(n=>{console.log(n)})}var M={keyboard:async e=>[[_.Markup.button.callback(`\u0414\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430: ${e.settingsDuty}`,`settingsDuty${e.userId}`),_.Markup.button.callback(`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${e.settingsSchedule}`,`settingsSchedule${e.userId}`),_.Markup.button.callback(`\u0417\u0430\u043C\u0435\u043D\u044B: ${e.settingsReplacement}`,`settingsReplacement${e.userId}`)]],schedule:async e=>{let t=e.callbackQuery?.data,r=await i.users.select(t.slice(16));await i.users.settings.update_schedule(r.userId,r.settingsSchedule==="on"?"off":"on"),r.settingsSchedule=r.settingsSchedule==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await M.keyboard(r)}}).catch(a=>{console.log(a)})},replacement:async e=>{let t=e.callbackQuery?.data,r=await i.users.select(t.slice(19));await i.users.settings.update_replacement(r.userId,r.settingsReplacement==="on"?"off":"on"),r.settingsReplacement=r.settingsReplacement==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await f.callback_query.settings.keyboard(r)}}).catch(a=>{console.log(a)})},duty:async e=>{let t=e.callbackQuery?.data,r=await i.users.select(t.slice(12));await i.users.settings.update_duty(r.userId,r.settingsDuty==="on"?"off":"on"),r.settingsDuty=r.settingsDuty==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await f.callback_query.settings.keyboard(r)}}).catch(a=>{console.log(a)})}};var Y={};S(Y,{duty:()=>J});async function J(e){if(e.chat?.id){let t=await i.users.select(e.chat.id),r=new Date().getTime(),a=new Date().getDay();if(a!==0&&t.payment!==0&&t.dutyDate+432e5<=r){await i.duty.insert(t.groupName,r,t.userId,t.name);let s=await i.users.select_all_by_group(t.groupName);await i.users.update_duty(t.userId,t.duty+1),await i.users.update_dutyDate(t.userId,r);for(let n of s)(n.role==="admin"||n.scheduleDate===a)&&n.groupName===t.groupName&&console.log(n.scheduleDate);await e.reply("\u0423\u0441\u043F\u0435\u0448\u043D\u043E")}else await m.telegram.sendMessage(e.chat.id,"\u0421\u0435\u0433\u043E\u0434\u043D\u044F \u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435, \u0432\u044B \u0443\u0436\u0435 \u043E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B\u0438 \u0438\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B").catch(s=>{console.log(s)})}}var te={};S(te,{generateHTML:()=>ve,sender:()=>Tt});var ee=T(require("node-html-to-image"));var We=require("telegraf");async function Tt(){let e=await i.users.select_all(),t=await i.gradients.select_all_gradients(),r=t[Math.floor(Math.random()*(t.length-1))],a=[],s=new Map;for(let n of e)a.indexOf(n.groupName)===-1&&n.groupName!=="null"&&a.push(n.groupName);for(let n of a){let u=await ve(n,0),c=await(0,ee.default)({html:`${d.HTMLSTART1}${r}${d.HTMLSTART2}${u}${d.HTMLEND}`,puppeteerArgs:d.PUPPETEER});s.set(n,{html:u,standard:c})}for(let n of e)if(n.payment!==0&&n.settingsDuty==="on"&&await f.payment.groupTG(n)&&n.userId===6018898378){let u=`background-image: url(${n.theme});`,c=n.theme==="standard"?s.get(n.groupName).standard:await(0,ee.default)({html:`${d.HTMLSTART1}${u}${d.HTMLSTART2}${s.get(n.groupName).html}${d.HTMLEND}`,puppeteerArgs:d.PUPPETEER});await m.telegram.sendPhoto(n.userId,We.Input.fromBuffer(Buffer.from(c),"duty.png")).then(async()=>{await f.payment.alert(n)}).catch(o=>{console.log(o)})}}async function ve(e,t){let r=await i.users.select_all_by_group(e),a=[[],[],[],[],[],[]],s=[[],[],[],[],[],[]],n=[[],[],[],[],[],[]],u=[],c=[],o=[],l=r.sort((p,W)=>W.duty-p.duty);for(let p of r)p.scheduleDate!==-1&&a[p.scheduleDate-1].push(p.name);for(let p of l)p.scheduleDate!==-1&&n[p.scheduleDate-1].push(`${p.name}-${p.duty}`);let b=new Date(new Date().getTime()-6048e5*t),h=b.getDate()-b.getDay(),w=h+6,$=new Date(b.setDate(h)),g=new Date(b.setDate(w)),I=await i.duty.select(e,$.getTime(),g.getTime());for(let p of I){let W=new Date(p.date).getDay();s[W-1].push(p.name)}for(let p=0;p<5;p++)u.push(`<tr><td><b>${a[0]&&a[0][p]?a[0][p]:""}</b></td><td><b>${a[1]&&a[1][p]?a[1][p]:""}</b></td><td><b>${a[3]&&a[2][p]?a[2][p]:""}</b></td><td><b>${a[3]&&a[3][p]?a[3][p]:""}</b></td><td><b>${a[4]&&a[4][p]?a[4][p]:""}</b></td><td><b>${a[5]&&a[5][p]?a[5][p]:""}</b></td></tr>`),c.push(`<tr><td><b>${s[0]&&s[0][p]?s[0][p]:""}</b></td><td><b>${s[1]&&s[1][p]?s[1][p]:""}</b></td><td><b>${s[2]&&s[2][p]?s[2][p]:""}</b></td><td><b>${s[3]&&s[3][p]?s[3][p]:""}</b></td><td><b>${s[4]&&s[4][p]?s[4][p]:""}</b></td><td><b>${s[5]&&s[5][p]?s[5][p]:""}</b></td></tr>`),o.push(`<tr><td><b>${n[0]&&n[0][p]?n[0][p]:""}</b></td><td><b>${n[1]&&n[1][p]?n[1][p]:""}</b></td><td><b>${n[2]&&n[2][p]?n[2][p]:""}</b></td><td><b>${n[3]&&n[3][p]?n[3][p]:""}</b></td><td><b>${n[4]&&n[4][p]?n[4][p]:""}</b></td><td><b>${n[5]&&n[5][p]?n[5][p]:""}</b></td></tr>`);return`
<tr><td colspan="6"><b>\u0414\u0435\u0436\u0443\u0440\u043D\u044B\u0435 \u043F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td></tr>
<tr><td><b>\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A</b></td><td><b>\u0412\u0442\u043E\u0440\u043D\u0438\u043A</b></td><td><b>\u0421\u0440\u0435\u0434\u0430</b></td><td><b>\u0427\u0435\u0442\u0432\u0435\u0440\u0433</b></td><td><b>\u041F\u044F\u0442\u043D\u0438\u0446\u0430</b></td><td><b>\u0421\u0443\u0431\u0431\u043E\u0442\u0430</b></td></tr>
<tr><td colspan="6" class="line"></td></tr>
${u.join("")}
<tr><td colspan="6" class="line"></td></tr>
<tr><td colspan="6"><b>\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B\u0438</b></td></tr>
<tr>
<td><b>${new Date($.getTime()+864e5*1).getDate()}.${`0${new Date($.getTime()+864e5*1).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date($.getTime()+864e5*2).getDate()}.${`0${new Date($.getTime()+864e5*2).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date($.getTime()+864e5*3).getDate()}.${`0${new Date($.getTime()+864e5*3).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date($.getTime()+864e5*4).getDate()}.${`0${new Date($.getTime()+864e5*4).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date($.getTime()+864e5*5).getDate()}.${`0${new Date($.getTime()+864e5*5).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date($.getTime()+864e5*6).getDate()}.${`0${new Date($.getTime()+864e5*6).getMonth()+1}`.slice(-2)}</b></td>
</tr>
<tr><td colspan="6" class="line"></td></tr>
${c.join("")}
<tr><td colspan="6" class="line"></td></tr>
<tr><td colspan="6"><b>\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0434\u0435\u0436\u0443\u0440\u0441\u0442\u0432</b></td></tr>
<tr><td colspan="6" class="line"></td></tr>
${o.join("")}
`}var f={schedule:q,replacement:U,payment:G,callback_query:X,hears:Y,duty:te},qe=()=>{m.hears("\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B",async e=>{await J(e)}),m.on("callback_query",async e=>{let t=e.callbackQuery?.data;t.startsWith("userPaid")?await K(e,8):t.startsWith("paidStatus")?await Z(e):t.startsWith("userStatus")?await O(e):t.startsWith("vipStatus")?await j(e):t.startsWith("settings")?t.startsWith("settingsSchedule")?await M.schedule(e):t.startsWith("settingsReplacement")?await M.replacement(e):t.startsWith("settingsDuty")&&await M.duty(e):t.startsWith("setGroup")?await z(e):t.startsWith("setDutyDay")&&await V(e)})};async function ae(e){e.chat?.id&&(await i.users.select(e.chat?.id)||(await i.users.insert(e.chat.id,e.from?.username,"true",e.from?.username,await St(e.chat.id)),await m.telegram.sendMessage(6018898378,`${e.chat.id} ${e.from?.username}, \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u043B\u0441\u044F \u043A \u0431\u043E\u0442\u0443`)),await e.reply(`\u0412\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0431\u043E\u0442\u0430!
\u0414\u043B\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0439 \u0440\u0430\u0431\u043E\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 (/setname \u0432\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F) \u0438 (/setgroup).
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0432\u0432\u0435\u0441\u0442\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447 \u043A\u043E\u043C\u0430\u043D\u0434\u043E\u0439 (/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447), \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u0435 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 \u043C\u0435\u0441\u044F\u0446 \u0431\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`))}async function St(e){return e<0?"null":e.toString().split("").map(Number).map(t=>(t||10)+64).map(t=>String.fromCharCode(Number(t))).join("")}async function re(e){let{text:t}=e;if(t=t?.slice(6),e.chat?.id===6018898378&&t&&!t.startsWith("monica_schedule_bot")){let r=await i.users.select_all();for(let a of r)a.payment!==0&&(await m.telegram.sendMessage(a.userId,t).catch(s=>{console.log(s)}),await f.payment.alert(a))}else await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function se(e){await e.reply("\u041D\u0435 \u0443\u0434\u0430\u043B\u044F\u0439\u0442\u0435 \u044D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435!",{reply_markup:{resize_keyboard:!0,keyboard:[["\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B"]]}})}async function ne(e,t){if(e===6018898378){let r=[],a=(await i.settings.select("scheduleLink")).value,s=(await i.settings.select("replacementLink")).value,n=await(await fetch("http://rgkript.ru/raspisanie-zanyatiy/")).text(),u=new RegExp('<a href="http:\\/\\/rgkript.ru\\/wp-content\\/uploads\\/\\/'+new Date().getFullYear()+'[0-9/.\\-A-Za-z_]+"',"g"),c=Array.from(new Set(n.match(u))).map(l=>l.slice(9,-1)),o=n.match(/<strong>[А-Яа-я0-9. ]+/g);if(o)for(let l of o)l.match(/[0-9]+.[0-9]+.[0-9]+/g)&&r.push(l[0]);c[0]!==a?(await i.settings.update_value(c[0],"scheduleLink"),await m.telegram.sendMessage(e,`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${r[0]} ${c[0].slice(36)}`).then(l=>{setTimeout(()=>{m.telegram.deleteMessage(l.chat.id,l.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(l=>{console.log(l)}),await f.schedule.regenerate(c[0],r[0]).then(async l=>{await f.schedule.sender(l)})):await m.telegram.sendMessage(e,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").then(l=>{setTimeout(()=>{m.telegram.deleteMessage(l.chat.id,l.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(l=>{console.log(l)}),c[1]!==s?(await i.settings.update_value(c[1],"replacementLink"),await m.telegram.sendMessage(e,`\u0417\u0430\u043C\u0435\u043D\u044B: ${r[1]} ${c[1].slice(36)}`).then(l=>{setTimeout(()=>{m.telegram.deleteMessage(l.chat.id,l.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(l=>{console.log(l)}),await f.replacement.regenerate(c[1],r[1]).then(async l=>{await f.replacement.sender(l)})):await m.telegram.sendMessage(e,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B").then(l=>{setTimeout(()=>{m.telegram.deleteMessage(l.chat.id,l.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(l=>{console.log(l)})}else await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function ie(e){if(e.chat?.id){let t=await i.users.select(e.chat.id);t?t.userId>0?(await m.telegram.sendMessage(6018898378,`${t.name}(${t.userId}) \u043E\u043F\u043E\u0432\u0435\u0441\u0442\u0438\u043B \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435, \u0441\u0442\u0430\u0442\u0443\u0441: ${t.payment}`,{reply_markup:{inline_keyboard:[[{text:"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`paidStatus${t.userId}`},{text:"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`userPaid${t.userId}`}]]}}),await e.reply("\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0443 \u043E\u043F\u043B\u0430\u0442\u044B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D, \u043E\u0436\u0438\u0434\u0430\u0439\u0442\u0435")):await e.reply("\u041E\u0448\u0438\u0431\u043A\u0430. \u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B"):await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function le(e){if(console.log(e.chat?.id),e.chat?.id){console.log(1);let t=await i.users.select(e.chat.id);if(t){let r=t.groupName,a=t.userId,s=t.name,n=t.refKey,u=0;if(a===1177837026||a===6018898378){let o=await i.referral.select_by_agent(t.userId);for(let l of o){let b=await i.users.select(l.userId);l.status==="true"&&b.paidWhenever==="true"&&(u+=1)}await i.settings.update_number(36/100*u*39.5,"agentCost")}let c=a===1177837026||a===6018898378?38*u:6*t.refAgents;await e.reply(`\u0413\u0440\u0443\u043F\u043F\u0430: <b>${r}</b>
Id: \u{1F517}<code>${a}</code>
\u0424\u0430\u043C\u0438\u043B\u0438\u044F: <b>${s}</b>
\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B: <b>${d.payment.get(t.payment)}</b>
\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438: <b>${Math.floor(t.price-t.price*(c/100))}</b>
\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447: \u{1F517}<code>${n}</code>
\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432: <b>${c}%</b>
\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C: @a_korop`,{parse_mode:"HTML"})}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function oe(e){if(e.chat?.id){let t=await i.users.select(e.chat.id),{text:r}=e;if(t)if(t.refKeyStatus==="false"){let a=r?.slice(10);if(a){let s=await i.users.select_refAgents_by_refKey(a);s?t.userId!==s.userId?(await i.users.update_refKeyStatus(t.userId,"true"),await i.users.update_payment(t.userId,3),await i.users.update_refAgents(s.userId,s.refAgents+1),await i.referral.insert(s.userId,t.userId,a),await e.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447!
\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 2 \u043C\u0435\u0441\u044F\u0446\u0430 (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 2-\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`)):await e.reply("\u0412\u044B \u043D\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u0441\u0432\u043E\u0439 \u0436\u0435 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447"):await e.reply(`\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u0430\u0433\u0435\u043D\u0442 \u0434\u043B\u044F \u043A\u043B\u044E\u0447\u0430: ${a}`)}else await e.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447(/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447)")}else await e.reply("\u0412\u044B \u0443\u0436\u0435 \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447, \u043B\u0438\u0431\u043E \u043E\u043F\u043B\u0430\u0447\u0438\u0432\u0430\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0440\u0430\u043D\u0435\u0435");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var Qe=require("telegraf"),Ue=T(require("node-html-to-image"));async function ue(e){if(e.chat?.id){let t=await i.users.select(e.chat?.id);if(t)if(t.payment!==0)if(await f.payment.groupTG(t)){let r=(await i.replacement.select_by_index(0)).html,a=await i.gradients.select_all_replGradients(),s=t.theme==="standard"?a[Math.floor(Math.random()*(a.length-1))]:`background-image: url(${t.theme});`,n=await(0,Ue.default)({html:`${d.HTMLSTART1}${s}${d.HTMLSTART2}${r}${d.HTMLEND}`,puppeteerArgs:d.PUPPETEER});await e.replyWithPhoto(Qe.Input.fromBuffer(Buffer.from(n),"schedule.png")),await f.payment.alert(t)}else await e.reply("\u041D\u0435 \u0432\u0441\u0435 \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443");else await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function me(e){e.chat?.id===6018898378?(await e.reply("\u0411\u043E\u0442 \u0432\u044B\u043A\u043B\u044E\u0447\u0435\u043D!"),setTimeout(()=>{process.exit(0)},1e3*60)):await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}var Fe=require("telegraf");var Ge=T(require("node-html-to-image"));async function de(e){if(e.chat?.id){let t=await i.users.select(e.chat.id);if(t)if(t.payment!==0)if(t.groupName!=="null"){let r=(await i.groups.select_schedule(t.groupName)).schedule;if(r!=="null")if(await f.payment.groupTG(t)){let a=await i.gradients.select_all_gradients(),s=t.theme==="standard"?a[Math.floor(Math.random()*(a.length-1))]:`background-image: url(${t.theme});`,n=await(0,Ge.default)({html:`${d.HTMLSTART1}${s}${d.HTMLSTART2}${r}${d.HTMLEND}`,puppeteerArgs:d.PUPPETEER});await e.replyWithPhoto(Fe.Input.fromBuffer(Buffer.from(n),"schedule.png")),await f.payment.alert(t)}else await e.reply("\u041D\u0435 \u0432\u0441\u0435 \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443");else await e.reply("\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E")}else await e.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443 /setgroup");else await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function ce(e){if(e.chat?.id)if(await i.users.select(e.chat.id)){let r=await i.groups.select_all(),a=[[]],s=0,n=0;for(let u of r)s%5===0&&s!==0?(n+=1,a.push([]),a[n].push({text:u.name,callback_data:`setGroup${u.name}`}),s+=1):(a[n].push({text:u.name,callback_data:`setGroup${u.name}`}),s+=1);await e.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443:",{reply_markup:{inline_keyboard:a}})}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}async function pe(e){if(e.chat?.id){let t=await i.users.select(e.chat.id),{text:r}=e;if(t){let a=r?.slice(9);a?(await i.users.update_name(t.userId,a),await e.reply(`\u0412\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F - ${a}`)):await e.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0444\u0430\u043C\u0438\u043B\u0438\u044E(/setname \u0432\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F)")}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function fe(e){if(e.chat?.id){let t=await i.users.select(e.chat?.id);t?await e.reply("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await f.callback_query.settings.keyboard(t)}}):await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function ge(e){if(e.chat?.id===6018898378){let t=await f.payment.paid();await e.reply("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:t}})}else await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function be(e){if(e.chat?.id){let t=await i.users.select(e.chat?.id),{text:r}=e,a=r?.slice(7);t.payment!==0?t&&a&&!a.startsWith("monica_schedule_bot")&&a.match(/\.(jpeg|jpg|png)$/)!=null?(await i.users.update_theme(t.userId,a),await e.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0442\u0435\u043C\u0430: ${a}`)):await e.reply("\u041E\u0448\u0438\u0431\u043A\u0430, \u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0432\u044B \u043D\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0432 \u0431\u043E\u0442\u0435, \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443, \u043A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B \u0438\u043B\u0438 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0435 \u0432\u0435\u0434\u0435\u0442 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443"):await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C")}}async function ye(e){if(e.chat?.id)if(await i.users.select(e.chat.id)){let r=[{name:"\u041F\u043D\u0434",value:1},{name:"\u0412\u0442\u0440",value:2},{name:"\u0421\u0440\u0434",value:3},{name:"\u0427\u0442\u0432",value:4},{name:"\u041F\u0442\u043D",value:5},{name:"\u0421\u0431\u0442",value:6}],a=[[]];for(let s of r)a[0].push({text:s.name,callback_data:`setDutyDay${s.value}`});await e.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u043D\u044C:",{reply_markup:{inline_keyboard:a}})}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}var Ke={start:ae,send:re,duty:se,fetch:ne,paid:ie,profile:le,referral:oe,replacement:ue,restart:me,schedule:de,setGroup:ce,setName:pe,settings:fe,status:ge,theme:be,setDutyDay:ye},Oe=()=>{m.command("start",async e=>{await ae(e)}),m.command("fetch",async e=>{await ne(e.chat.id,e)}),m.command("send",async e=>{await re(e)}),m.command("schedule",async e=>{await de(e)}),m.command("theme",async e=>{await be(e)}),m.command("status",async e=>{await ge(e)}),m.command("settings",async e=>{await fe(e)}),m.command("profile",async e=>{await le(e)}),m.command("setname",async e=>{await pe(e)}),m.command("setgroup",async e=>{await ce(e)}),m.command("referral",async e=>{await oe(e)}),m.command("paid",async e=>{await ie(e)}),m.command("replacement",async e=>{await ue(e)}),m.command("restart",async e=>{await me(e)}),m.command("duty",async e=>{await se(e)}),m.command("setdutydate",async e=>{await ye(e)})};var Xe=T(require("express")),Je=T(require("cors")),Ye=T(require("path")),et=T(require("http"));var L={};S(L,{default:()=>Et});async function Et(e,t){let r=await i.users.select(e);return{table:await f.duty.generateHTML(r.groupName,t)}}var N={};S(N,{default:()=>Mt});async function Mt(e){let t=await i.replacement.select_by_index(e);return{table:t?t.html:"null"}}var k={};S(k,{default:()=>kt,select:()=>Dt,update:()=>Pt});async function kt(e){let t=await i.users.select(e),r=await i.groups.select_schedule(t.groupName);return{table:r.schedule!=="null"?r.schedule:"<tr><td><b>\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E!</b></td></tr>"}}async function Dt(e){let t=await i.users.select(e),r=await i.groups.select_all(),a=[],s=[];for(let n of r)n.name===t.groupName?a.push(`<option selected value='${n.name}'>${n.name}</option>`):n.schedule==="null"?s.push(`<option disabled value='${n.name}'>${n.name}</option>`):a.push(`<option value='${n.name}'>${n.name}</option>`);return{table:a.concat(s).join("")}}async function Pt(e){let t=await i.groups.select_schedule(e);return{table:t.schedule!=="null"?t.schedule:"<tr><td><b>\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E!</b></td></tr>"}}var A={};S(A,{default:()=>Rt});async function Rt(e){let t=await i.users.select(e);return{table:await Lt(t)}}async function Lt(e){let t=e.groupName,r=e.userId,a=e.name,s=e.refKey,n=0;if(r===1177837026||r===6018898378){let h=await i.referral.select_by_agent(e.userId);for(let w of h){let $=await i.users.select(w.userId);w.status==="true"&&$.paidWhenever==="true"&&(n+=1)}await i.settings.update_number(36/100*n*39.5,"agentCost")}let u=r===1177837026||r===6018898378?38*n:6*e.refAgents,c=new Map().set(1,"\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A").set(2,"\u0412\u0442\u043E\u0440\u043D\u0438\u043A").set(3,"\u0421\u0440\u0435\u0434\u0430").set(4,"\u0427\u0435\u0442\u0432\u0435\u0440\u0433").set(5,"\u041F\u044F\u0442\u043D\u0438\u0446\u0430").set(6,"\u0421\u0443\u0431\u0431\u043E\u0442\u0430").set(-1,"\u041D\u0435 \u0437\u0430\u0434\u0430\u043D\u043E"),o=await i.groups.select_all(),l=[];for(let h of o)h.name===e.groupName?l.push(`<option selected value='${h.name}'>${h.name}</option>`):l.push(`<option value='${h.name}'>${h.name}</option>`);let b=[];for(let h=1;h<7;h++)h===e.scheduleDate?b.push(`<option selected value='${h}'>${c.get(h)}</option>`):b.push(`<option value='${h}'>${c.get(h)}</option>`);return`
<tr><td colspan="2"><b class="profileB">\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F</b></td><td><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0438\u0442\u044C</b></td></tr>
<tr><td><b class="profileB">\u0413\u0440\u0443\u043F\u043F\u0430:</b></td><td><b class="profileB">${t}</b></td><td><b class="profileB"><form name="myForm"><select class="selectP" name="selectGroup" id="selectGroup">${l.join("")}</select></form>\u25BC</b></td></tr>
<tr><td><b class="profileB">\u0418\u043C\u044F:</b></td><td><b class="profileB">${a}</b></td><td><b class="profileB">|</b><form name="myForm1"><input class="inputP" type="text" id="name" name="name" required/></form></td></tr>
<tr><td><b class="profileB">\u0414\u0435\u043D\u044C \u0434\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430:</b></td><td><b class="profileB">${c.get(e.scheduleDate)}</b></td><td><b class="profileB"><form name="myForm2"><select class="selectP" name="selectDutyDay" id="selectDutyDay">${b.join("")}</select></form>\u25BC</b></td></tr>
<tr><td><b class="profileB">\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C id:</b></td><td><b class="profileB">${r}</b></td></tr>
<tr><td><b class="profileB">\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B:</b></td><td><b class="profileB">${d.payment.get(e.payment)}</b></td></tr>
<tr><td><b class="profileB">\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438:</b></td><td><b class="profileB">${Math.floor(e.price-e.price*(u/100))}\u0440</b></td></tr>
<tr><td><b class="profileB">\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447:</b></td><td><b class="profileB">${s}</b></td></tr>
<tr><td><b class="profileB">\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432:</b></td><td><b class="profileB">${u}%</b></td></tr>
<tr><td><b class="profileB">\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C:</b></td><td><b class="profileB">@a_korop</b></td></tr>
<tr><td colspan="2"></td><td><button onclick="update()"><b class="profileB">\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C</b></button></td></tr>
`}var D={};S(D,{dutyDay:()=>At,group:()=>Nt,name:()=>Ct});async function Nt(e,t){let r=await i.users.select(e);await i.users.update_group(r.userId,decodeURI(t))}async function At(e,t){let r=await i.users.select(e);await i.users.update_scheduleDate(r.userId,t)}async function Ct(e,t){let r=await i.users.select(e);await i.users.update_name(r.userId,decodeURI(t))}var E={};S(E,{default:()=>xt,duty:()=>vt,replacement:()=>Wt,schedule:()=>Bt});async function xt(e){let t=await i.users.select(e);return{table:await C(t)}}async function Bt(e){let t=await i.users.select(e),r=t.settingsSchedule==="on"?"off":"on";return await i.users.settings.update_schedule(t.userId,r),t.settingsSchedule=r,{table:await C(t)}}async function Wt(e){let t=await i.users.select(e),r=t.settingsReplacement==="on"?"off":"on";return await i.users.settings.update_replacement(t.userId,r),t.settingsReplacement=r,{table:await C(t)}}async function vt(e){let t=await i.users.select(e),r=t.settingsDuty==="on"?"off":"on";return await i.users.settings.update_duty(t.userId,r),t.settingsDuty=r,{table:await C(t)}}async function C(e){return`
<tr><td colspan="2"><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439</b></td></tr>
<tr><td><b class="profileB">\u041F\u043E\u044F\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044F:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsSchedule()"><b class="profileB">${e.settingsSchedule}</b></button></td></tr>
<tr><td><b class="profileB">\u041F\u043E\u044F\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u044B\u0445 \u0437\u0430\u043C\u0435\u043D:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsReplacement()"><b class="profileB">${e.settingsReplacement}</b></button></td></tr>
<tr><td><b class="profileB">\u0420\u0430\u0441\u0441\u044B\u043B\u043A\u0430 \u0442\u0430\u0431\u043B\u0438\u0446\u044B \u0434\u0435\u0436\u0443\u0440\u043D\u044B\u0445 \u0437\u0430 \u043D\u0435\u0434\u0435\u043B\u044E:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsDuty()"><b class="profileB">${e.settingsDuty}</b></button></td></tr>
`}var P={};S(P,{bg:()=>Qt,default:()=>qt,lightMode:()=>Ut});async function qt(e){let t=await i.users.select(e);return{table:await he(t)}}async function Qt(e,t){let r=await i.users.select(e);try{t=t.match(/\.(jpeg|jpg|png)$/)!=null?t:"standard"}catch{t="standard"}return await i.users.update_theme(r.userId,t),{table:await he(r)}}async function Ut(e){let t=await i.users.select(e);return await i.users.update_lightMode(t.userId,t.lightMode===0?1:0),t.lightMode=t.lightMode===0?1:0,{table:await he(t)}}async function he(e){return`
<tr><td colspan="4"><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0442\u0435\u043C\u044B</b></td></tr>
<tr><td><b class="profileB">\u0424\u043E\u043D:</b></td><td><form name="myForm"><input class="inputP" type="url" id="theme" name="theme" required/></form></td><td><button onclick="updateSettingsTheme()"><b class="profileB">\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C</b></button></td><td><button onclick="updateSettingsThemeStandard()"><b class="profileB">\u041F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E</b></button></td></tr>
<tr><td colspan="2"><b class="profileB">\u0422\u0435\u043C\u043D\u0430\u044F \u0442\u0435\u043C\u0430:</b></td><td colspan="2"><button style="width: 100%;" onclick="updateSettingsLightMode()"><b class="profileB">${e.lightMode===0?"off":"on"}</b></button></td></tr>
    `}var H=require("fs"),x=T(require("path"));async function je(e){return{body:(0,H.readFileSync)(x.default.join(e+"/html/profile.html"),"utf-8")}}async function ze(e){return{body:(0,H.readFileSync)(x.default.join(e+"/html/settings.html"),"utf-8")}}async function Ze(e,t){let r=await i.users.select(t);return r&&r.payment!==0?{body:(0,H.readFileSync)(x.default.join(e+"/html/home.html"),"utf-8")}:{body:'<table><tr><td><b class="profileB">\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0438\u043B\u0438 \u0435\u0449\u0435 \u043D\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043A \u0431\u043E\u0442\u0443!</b></td></tr></table>'}}async function Ve(e){let t=await i.users.select(e),r=t.theme,a=t.lightMode===0?await i.gradients.select_all_gradients():await i.gradients.select_all_replGradients(),s=a[Math.floor(Math.random()*(a.length-1))];return{gradient:r==="standard"?s.slice(11,-1):`url(${r})`}}var tt=e=>{let t=(0,Xe.default)();t.use((0,Je.default)()),t.get("/",(a,s)=>{s.sendFile(Ye.default.join(e+"/html/index.html"))}),t.get("/home/[0-9]+",async(a,s)=>{s.send(await Ze(e,Number(a.url.slice(6))))}),t.get("/home/scheduleTable/[0-9]+",async(a,s)=>{s.send(await k.default(Number(a.url.slice(20))))}),t.get("/home/scheduleTable/selectGroup/[0-9]+",async(a,s)=>{s.send(await k.select(Number(a.url.slice(32))))}),t.get("/home/scheduleTable/updateGroup/[0-9%A-Za-z-]+",async(a,s)=>{s.send(await k.update(decodeURI(a.url.slice(32))))}),t.get("/home/replacementTable/[0-9]+",async(a,s)=>{s.send(await N.default(Number(a.url.slice(23))))}),t.get("/home/dutyTable/[0-9]+/[0-9]+",async(a,s)=>{let n=a.url.match(/[0-9]+/g);n&&s.send(await L.default(Number(n[0]),Number(n[1])))}),t.get("/profile",async(a,s)=>{s.send(await je(e))}),t.get("/profile/[0-9]+",async(a,s)=>{s.send(await A.default(Number(a.url.slice(9))))}),t.get("/profile/editGroup/[0-9]+/[0-9%A-Za-z-]+",async(a,s)=>{let n=a.url.slice(19).match(/[0-9%A-Za-z\-]+/g);n&&await D.group(Number(n[0]),n[1]).then(()=>s.send())}),t.get("/profile/editDutyDay/[0-9]+/[0-9]+",async(a,s)=>{let n=a.url.slice(21).match(/[0-9]+/g);n&&await D.dutyDay(Number(n[0]),Number(n[1])).then(()=>s.send())}),t.get("/profile/editName/[0-9]+/[0-9%A-Za-z-]+",async(a,s)=>{let n=a.url.slice(18).match(/[0-9%A-Za-z\-]+/g);n&&await D.name(Number(n[0]),n[1]).then(()=>s.send())}),t.get("/settings",async(a,s)=>{s.send(await ze(e))}),t.get("/settings/notification/[0-9]+",async(a,s)=>{s.send(await E.default(Number(a.url.slice(23))))}),t.get("/settings/notification/schedule/[0-9]+",async(a,s)=>{s.send(await E.schedule(Number(a.url.slice(32))))}),t.get("/settings/notification/replacement/[0-9]+",async(a,s)=>{s.send(await E.replacement(Number(a.url.slice(35))))}),t.get("/settings/notification/duty/[0-9]+",async(a,s)=>{s.send(await E.duty(Number(a.url.slice(28))))}),t.get("/settings/theme/[0-9]+",async(a,s)=>{s.send(await P.default(Number(a.url.slice(16))))}),t.post("/settings/theme/bg",async(a,s)=>{s.send(await P.bg(Number(a.query.user),String(a.query.url)))}),t.post("/settings/theme/lightMode",async(a,s)=>{s.send(await P.lightMode(Number(a.query.user)))}),t.get("/randomGradient/[0-9]+",async(a,s)=>{s.send(await Ve(Number(a.url.slice(16))))}),et.default.createServer(t).listen(3e3,"localhost")};var m=new at.Telegraf(d.TOKEN);m.launch();m.telegram.sendMessage(6018898378,"\u0411\u043E\u0442 \u0437\u0430\u043F\u0443\u0449\u0435\u043D!").then(e=>setTimeout(()=>{m.telegram.deleteMessage(e.chat.id,e.message_id).catch(t=>console.log(t))},30*1e3)).catch(e=>{console.log(e)});tt(__dirname);Oe();qe();B.CronJob.from({cronTime:"0 10 14 * * 1-5,7",onTick:async()=>{await Ke.fetch(6018898378)},start:!0});B.CronJob.from({cronTime:"0 0 13 1 * *",onTick:async()=>{await f.payment.recount().catch(e=>{console.log(e)})},start:!0});B.CronJob.from({cronTime:"0 35 7 25-31 * *",onTick:async()=>{await f.payment.preAlert().catch(e=>{console.log(e)})},start:!0});0&&(module.exports={bot});
