"use strict";var mt=Object.create;var L=Object.defineProperty;var dt=Object.getOwnPropertyDescriptor;var pt=Object.getOwnPropertyNames;var ct=Object.getPrototypeOf,ft=Object.prototype.hasOwnProperty;var k=(t,e)=>{for(var r in e)L(t,r,{get:e[r],enumerable:!0})},ue=(t,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of pt(e))!ft.call(t,s)&&s!==r&&L(t,s,{get:()=>e[s],enumerable:!(a=dt(e,s))||a.enumerable});return t};var M=(t,e,r)=>(r=t!=null?mt(ct(t)):{},ue(e||!t||!t.__esModule?L(r,"default",{value:t,enumerable:!0}):r,t)),gt=t=>ue(L({},"__esModule",{value:!0}),t);var or={};k(or,{bot:()=>m,connection:()=>f,gradients:()=>T});module.exports=gt(or);var Y=class{constructor(){}async load(e,r){if(r)this.type=e,this._value=r.value,this._number=r.number;else{let a=await me.settings(e);this.type=a.type,this._value=a.value,this._number=a.number}return this}get value(){return this._value}get number(){return this._number}set value(e){this._value=e,f.query(`UPDATE settings SET value = '${e}' WHERE type = '${this.type}'`)}set number(e){this._number=e,f.query(`UPDATE settings SET number = '${e}' WHERE type = '${this.type}'`)}},B=class{constructor(){}async load(){let e=await me.all();return this.all=await Promise.all(e.map(async r=>new Y().load(r.type,r))),this}getSettings(e){return this.all.find(r=>r.type===e)}},me={settings:async t=>new Promise(async function(e){f.query(`SELECT * FROM settings WHERE type = '${t}'`,(r,a)=>{if(r)throw new Error("SQL ERROR in Settings");e(a[0])})}),all:async()=>new Promise(async function(t){f.query("SELECT * FROM settings",async(e,r)=>{if(e)throw new Error("SQL ERROR in Settings");t(r)})})};var C=class{constructor(e,r,a,s,n,i){this._bots=e,this._groupName=r,this._id=a,this._name=s,this._role=i,this._userName=n}get bots(){return this._bots}get groupName(){return this._groupName}get id(){return this._id}get name(){return this._name}get role(){return this._role}get userName(){return this._userName}set groupName(e){this._groupName=e,f.query(`UPDATE users SET groupName = '${e}' WHERE userId = '${this.id}'`)}set name(e){this._name=e,f.query(`UPDATE users SET name = '${e}' WHERE userId = '${this._id}'`)}set userName(e){this._userName=e}};var H=class{constructor(e,r,a,s){this.id=e,this._count=r,this._day=a,this._lastDate=s}get count(){return this._count}get day(){return this._day}get lastDate(){return this._lastDate}set count(e){this._count=e,f.query(`UPDATE users SET dutyCount = '${e}' WHERE userId = '${this.id}'`)}set day(e){this._day=e,f.query(`UPDATE users SET dutyDay = '${e}' WHERE userId = '${this.id}'`)}set lastDate(e){this._lastDate=e,f.query(`UPDATE users SET dutyLastDate = '${e}' WHERE userId = '${this.id}'`)}};var W=class{constructor(e,r,a,s,n){this.id=e,this._paid=r,this._price=a,this._status=s,this.referral=n}get paid(){return this._paid}get price(){return this._price}get status(){return this._status}set paid(e){this._paid=e,f.query(`UPDATE users SET paidWhenever = '${e}' WHERE userId = '${this.id}'`)}set status(e){this._status=e,f.query(`UPDATE users SET payment = '${e}' WHERE userId = '${this.id}'`)}};var A=class{constructor(e,r,a,s,n,i){this.id=e,this._duty=r,this._lightMode=a,this._replacement=s,this._schedule=n,this._theme=i}get theme(){return this._theme}get schedule(){return this._schedule}get replacement(){return this._replacement}get lightMode(){return this._lightMode}get duty(){return this._duty}set theme(e){let r=e.match(/\.(jpeg|jpg|png)$/)!=null?e:this._theme,a=e==="standard"?"standard":r;this._theme=a,f.query(`UPDATE users SET theme = '${a}' WHERE userId = '${this.id}'`)}set schedule(e){this._schedule=e,f.query(`UPDATE users SET settingsSchedule = '${e}' WHERE userId = '${this.id}'`)}set replacement(e){this._replacement=e,f.query(`UPDATE users SET settingsReplacement = '${e}' WHERE userId = '${this.id}'`)}set lightMode(e){this._lightMode=e,f.query(`UPDATE users SET lightMode = '${e}' WHERE userId = '${this.id}'`)}set duty(e){this._duty=e,f.query(`UPDATE users SET settingsDuty = '${e}' WHERE userId = '${this.id}'`)}switchSchedule(){let e=this._schedule==="on"?"off":"on";this._schedule=e,f.query(`UPDATE users SET settingsSchedule = '${e}' WHERE userId = '${this.id}'`)}switchReplacement(){let e=this._replacement==="on"?"off":"on";this._replacement=e,f.query(`UPDATE users SET settingsReplacement = '${e}' WHERE userId = '${this.id}'`)}switchLightMode(){let e=this._lightMode===0?1:0;this._lightMode=e,f.query(`UPDATE users SET lightMode = '${e}' WHERE userId = '${this.id}'`)}switchDuty(){let e=this._duty==="on"?"off":"on";this._duty=e,f.query(`UPDATE users SET settingsDuty = '${e}' WHERE userId = '${this.id}'`)}};var G=class{constructor(e,r){this.id=e,this._key=r}async load(){let e=await de.agents(this.id),r=await de.user(this.id);this._agents=e;let a=0;for(let s of e){let n=await new u().load(s.userId);n.payment.status>1&&n.payment.paid==="true"&&(a+=1)}return this._agentsApprove=a,this._user=r,this}get agentsApprove(){return this._agentsApprove}get agents(){return this._agents}get user(){return this._user}get key(){return this._key}insertReferral(e){this._agents.push({agentId:this.id,userId:e,refKey:this._key}),f.query(`INSERT INTO referrals (agentId,userId,refKey) VALUES('${this.id}','${e}','${this._key}')`)}},de={agents:async t=>new Promise(async function(e){f.query(`SELECT * FROM referrals WHERE agentId = '${t}'`,(r,a)=>{if(r)throw new Error("SQL ERROR in UserReferral");e(a)})}),user:async t=>new Promise(async function(e){f.query(`SELECT * FROM referrals WHERE userId = '${t}'`,(r,a)=>{if(r)throw new Error("SQL ERROR in UserReferral");e(a[0])})})};var u=class{constructor(){}async load(e,r){if(r?.res){let s=await a(r.res);return this.settings=s.settings,this.info=s.info,this.duty=s.duty,this.payment=s.payment,this}else if(r?.refKey){let s=await ee.refKey(r.refKey),n=await a(s);return this.settings=n.settings,this.info=n.info,this.duty=n.duty,this.payment=n.payment,this}else{let s=await ee.userId(e),n=await a(s);return this.settings=n.settings,this.info=n.info,this.duty=n.duty,this.payment=n.payment,this}async function a(s){let n=await new G(e,s.refKey).load();return{duty:new H(e,s.dutyCount,s.dutyDay,s.dutyLastDate),info:new C(s.groupBots,s.groupName,e,s.name,s.userName,s.role),payment:new W(e,s.paidWhenever,s.price,s.payment,n),settings:new A(e,s.settingsDuty,s.lightMode,s.settingsReplacement,s.settingsSchedule,s.theme)}}}},S=class{constructor(){}async createUser(e,r,a,s,n){f.query(`INSERT INTO users (userId,userName,payment,name,refKey) values('${e}','${r}','${a}','${s}','${n}')`,async(i,y)=>{if(i)throw new Error("SQL ERROR in Users");this.all.push(await new u().load(e,{res:y[0]}))})}getUser(e){return this.all.find(r=>r.info.id===e)}async load(){let e=await ee.all();return this.all=await Promise.all(e.map(async r=>await new u().load(r.userId,r))),this}},ee={refKey:async t=>new Promise(async function(e){f.query(`SELECT * FROM users WHERE refKey = '${t}'`,async(r,a)=>{if(r)throw new Error("SQL ERROR in Users");if(a[0])e(a[0]);else throw new Error("USER not found")})}),userId:async t=>new Promise(async function(e){f.query(`SELECT * FROM users WHERE userId = '${t}'`,async(r,a)=>{if(r)throw new Error("SQL ERROR in USER");if(a[0])e(a[0]);else throw new Error("USER not found")})}),all:async()=>new Promise(async function(t){f.query("SELECT * FROM users",async(e,r)=>{if(e)throw new Error("SQL ERROR in Users");t(r)})})};var F=class{constructor(e){this.css=e.css,this.type=e.type}},O=class{constructor(){this._light=[];this._dark=[]}get light(){return this._light[Math.floor(Math.random()*(this._light.length-1))].css}get dark(){return this._dark[Math.floor(Math.random()*(this._dark.length-1))].css}async load(){let e=await yt.gradients();for(let r of e)r.type==="light"?this._light.push(new F(r)):this._dark.push(new F(r));return this}},yt={gradients:async()=>new Promise(async function(t){f.query("SELECT * FROM gradients",async(e,r)=>{if(e)throw new Error("SQL ERROR in Gradients");t(r)})})};var U=class{constructor(){}async load(e,r){let a=r?{name:e,schedule:r}:await Q.groups(e);this.name=a.name,this._schedule=a.schedule;let s=await Q.users(e),n=await Q.duty(e);return this._users=await Promise.all(s.map(async i=>new u().load(i.userId,i))),this._duties=n,this}get schedule(){return this._schedule}get users(){return this._users}get duties(){return this._duties}getUser(e){return this._users.find(r=>r.info.id===e)}getDuty(e,r){return this._duties.filter(a=>a.date>e&&a.date<r)}set schedule(e){this._schedule=e,f.query(`UPDATE groups SET schedule = '${e}' WHERE name = '${this.name}'`)}insertDuty(e,r,a){this._duties.push({group:this.name,date:e,user:r,name:a}),f.query(`INSERT INTO duty (\`group\`,\`date\`,\`user\`,\`name\`) values('${this.name}','${e}','${r}','${a}')`)}},R=class{constructor(){}getGroup(e){return this.all.find(r=>r.name===e)}async load(){let e=await Q.all();return this.all=await Promise.all(e.map(async r=>new U().load(r.name,r.schedule))),this}},Q={groups:async t=>new Promise(async function(e){f.query(`SELECT * FROM groups WHERE name = '${t}'`,async(r,a)=>{if(r)throw new Error("SQL ERROR in Group");e(a[0])})}),users:async t=>new Promise(async function(e){f.query(`SELECT * FROM users WHERE groupName = '${t}'`,async(r,a)=>{if(r)throw new Error("SQL ERROR in Group Users");e(a)})}),duty:async t=>new Promise(async function(e){f.query(`SELECT * FROM duty WHERE \`group\` = '${t}'`,async(r,a)=>{if(r)throw new Error("SQL ERROR in Group Duty");e(a)})}),all:async()=>new Promise(async function(t){f.query("SELECT * FROM groups",async(e,r)=>{if(e)throw new Error("SQL ERROR in Groups");t(r)})})};var Te=M(require("node-html-to-image"));var pe=M(require("dotenv"));pe.default.config();var{TOKEN:ce,PASSWORD:fe,SQLHOST:ge,SQLUSER:ye,SQLDATABASE:he,SQLPASSWORD:be,HTMLSTART1:we,HTMLSTART2:$e,HTMLEND:Se}=process.env;if(!ce||!fe||!ge||!ye||!he||!be||!we||!$e||!Se)throw new Error("Missing environment variables");var _e=new Map().set(-1,"free").set(0,"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D, \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B \u043D\u0435 \u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D").set(1,"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D, \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B \u0447\u0430\u0441\u0442\u0438\u0447\u043D\u043E \u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D").set(2,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 1 \u043C\u0435\u0441\u044F\u0446").set(3,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 2 \u043C\u0435\u0441\u044F\u0446\u0430").set(4,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 3 \u043C\u0435\u0441\u044F\u0446\u0430").set(5,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 4 \u043C\u0435\u0441\u044F\u0446\u0430").set(6,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 5 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(7,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 6 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(8,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 7 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(9,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 8 \u043C\u0435\u0441\u044F\u0446\u0435\u0432").set(10,"\u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 9 \u043C\u0435\u0441\u044F\u0446\u0435\u0432"),ht={args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--headless","--no-zygote","--disable-gpu"],headless:!0,ignoreHTTPSErrors:!0},Ee={refBonus:(t,e)=>t===1177837026||t===6018898378?40*e:e>10?100:10*e,cost:(t,e,r)=>e-e/100*Ee.refBonus(t,r),standard:(t,e)=>[`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(t)}\u0440</b>`,`\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u044C \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(t+e)}\u0440, ${Math.round(t+e*2)}\u0440, ${Math.round(t+e*3)}\u0440, ${Math.round(t+e*4)}\u0440, ${Math.round(t+e*5)}\u0440)`,"\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)","\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435",'<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>',"","\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u041E\u043F\u043B\u0430\u0447\u0435\u043D \u043D\u0430 3 \u043C\u0435\u0441\u044F\u0446\u0430"].join(`
`),ban:t=>[`\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0437\u0430 \u043D\u0435\u0443\u043F\u043B\u0430\u0442\u0443(\u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0438\u043B\u0438 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(t*2)}\u0440</b>)`,'\u{1F517}<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>'].join(`
`),changeStatus:t=>`\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043C\u0435\u043D\u0435\u043D \u043D\u0430 ${_e.get(t)}`},bt="http://rgkript.ru/raspisanie-zanyatiy/",h={TOKEN:ce,PASSWORD:fe,SQLHOST:ge,SQLUSER:ye,SQLDATABASE:he,SQLPASSWORD:be,HTMLSTART1:we,HTMLSTART2:$e,HTMLEND:Se,puppeteer:ht,payment:_e,paymentMessages:Ee,fetchUrl:bt};var E=class{constructor(e,r){this.gradient=e,this.html=r}async getImage(){let e=await(0,Te.default)({html:`${h.HTMLSTART1}${this.gradient}${h.HTMLSTART2}${this.html}${h.HTMLEND}`,puppeteerArgs:h.puppeteer});return this._image=e,e}};var K=class{constructor(e){this.html=e.html,this.date=e.date,this.link=e.link}},P=class{constructor(){}async load(){let e=await wt.replacements();return this.replacements=e.map(r=>new K(r)).reverse(),this}insertReplacement(e,r,a){this.replacements.push(new K({link:e,date:r,html:a})),f.query(`INSERT INTO replacements (link,date,html) VALUES('${e}','${r}','${a}')`)}getReplacement(e){return this.replacements[e]}},wt={replacements:async()=>new Promise(async function(t){f.query("SELECT * FROM replacements",(e,r)=>{if(e)throw new Error("SQL ERROR in Replacements");t(r)})})};var Ue=require("telegraf");var Re=M(require("mysql"));var $t={host:h.SQLHOST,user:h.SQLUSER,database:h.SQLDATABASE,password:h.SQLPASSWORD},j=class{constructor(){this.bot=new Ue.Telegraf(h.TOKEN),this.connection=Re.default.createPool($t),this.bot.launch(),this.bot.telegram.sendMessage(6018898378,"\u0411\u043E\u0442 \u0437\u0430\u043F\u0443\u0449\u0435\u043D!").then(e=>setTimeout(()=>{this.bot.telegram.deleteMessage(e.chat.id,e.message_id).catch(r=>console.log(r))},30*1e3)).catch(e=>{console.log(e)})}async addGradients(){return this.gradients=await new O().load(),this.gradients}};var te={};k(te,{regenerate:()=>St,sender:()=>_t});var ke=M(require("xlsx")),Me=require("telegraf");async function St(t,e){return new Promise(async function(r){let a=await fetch(t).catch(n=>{console.log(n)}),s=[];if(!a?.ok)s="notfound";else{let n=new Date(`${e.slice(-4)}-${e.slice(3,5)}-${e.slice(0,2)}`).getTime(),i=[],y=await new S().load();for(let o of y.all)i.indexOf(o.info.groupName)===-1&&o.info.groupName!=="null"&&i.push(o.info.groupName);for(let o of i){let l=await Et(a,o);s.push({group:o,html:l,date:n})}}r(s)})}async function _t(t){let e=await new R().load();if(t==="notfound")await m.telegram.sendMessage(6018898378,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").catch(r=>{console.log(r)});else for(let r of t)if(typeof r!="string"&&r.html!==""){let a=e.getGroup(r.group);if(a){a.schedule=r.html;let s=T.light,n=await new E(s,r.html).getImage();for(let i of a.users)if(i.payment.status!==0&&i.settings.schedule==="on"&&await c.payment.groupTG(i)){let y=`background-image: url(${i.settings.theme});`,o=i.settings.theme==="standard"?n:await new E(y,r.html).getImage();await m.telegram.sendPhoto(i.info.id,Me.Input.fromBuffer(Buffer.from(o),"schedule.png")).then(async()=>{await c.payment.alert(i)}).catch(l=>{console.log(l)})}}}}async function Et(t,e){let r=ke.default.read(Buffer.from(await t.clone().arrayBuffer())),a=r.SheetNames,s=r.Sheets[a[1]],n,i=[];for(let y in s)if(y.toString()[0]==="B"&&s[y].v===e){n=Number(y.slice(1))-3;for(let o=n+1;o<n+28;o++){let l=[];l.push(s[`A${o}`]?`<td><b>${s[`A${o}`].v}</b></td>`:"<td></td>"),l.push(s[`B${o}`]?`<td><b>${s[`B${o}`].v}</b></td>`:"<td></td>"),l.push(s[`C${o}`]?`<td><b>${s[`C${o}`].v}</b></td>`:"<td></td>"),l.push(s[`D${o}`]?`<td><b>${s[`D${o}`].v}</b></td>`:"<td></td>"),l.push(s[`E${o}`]?`<td><b>${s[`E${o}`].v}</b></td>`:"<td></td>"),l.push(s[`F${o}`]?`<td><b>${s[`F${o}`].v}</b></td>`:"<td></td>"),l.push(s[`G${o}`]?`<td><b>${s[`G${o}`].v}</b></td>`:"<td></td>"),i.push((o-n)%4===0?`<tr>${l.join(" ")}</tr><tr><td colspan="7" class="line"></td></tr>`:`<tr>${l.join(" ")}</tr>`)}}return i.join("")}var re={};k(re,{regenerate:()=>Ut,sender:()=>Rt});var De=M(require("pdf-parse")),Pe=M(require("word-extractor")),Ie=require("telegraf");var Tt=new Pe.default;async function Ut(t,e){return new Promise(async function(r){let a=await fetch(t).catch(n=>{console.log(n)}),s={date:new Date(`${e.slice(-4)}-${e.slice(3,5)}-${e.slice(0,2)}`).getTime(),html:"null",typeFile:t.slice(-3),fileBuffer:a?.ok?Buffer.from(await a.clone().arrayBuffer()):Buffer.from([0]),link:t};if(a?.ok){let n=[],i=s.typeFile==="pdf"?(await(0,De.default)(s.fileBuffer)).text:(await Tt.extract(s.fileBuffer)).getBody(),y=(await new R().load()).all.map(g=>g.name),o=i.replace(/\t/g," ").split(`
`).filter(g=>!g.startsWith("\u0413\u0440\u0443\u043F\u043F\u0430")&&!g.startsWith("\u041F\u0410\u0420\u0410")&&g.replace(" ","")!==""&&!g.startsWith("\u041F\u0420\u0415\u041F\u041E\u0414\u0410\u0412\u0410\u0422\u0415\u041B\u042C")&&!g.startsWith("\u0417\u0410\u041C\u0415\u041D\u0410")&&g.replace(" ","")!=="\u041F\u041E"&&!g.startsWith("\u0420\u0410\u0421\u041F\u0418\u0421\u0410\u041D\u0418\u042E")),l=0;for(let g in o)if(o[l])if(o[l].match(/ЗАМЕНЫ/g)===null){let b="",w="",v=1;if(y.some(p=>(b=p,String(o[l]).includes(p.replace("-"," ")))),y.some(p=>(b=p,String(o[l]).includes(p)))||y.some(p=>(b=p,String(o[l]).includes(p.replace("-"," "))))?(w=[o[l]],o[l+1]&&!y.some(p=>String(o[l+1]).includes(p))&&!y.some(p=>String(o[l+1]).includes(p.replace("-"," ")))&&o[l+1].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+1]}`),o[l+2]&&!y.some(p=>String(o[l+2]).includes(p))&&!y.some(p=>String(o[l+2]).includes(p.replace("-"," ")))&&o[l+2].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+2]}`),o[l+3]&&!y.some(p=>String(o[l+3]).includes(p))&&!y.some(p=>String(o[l+3]).includes(p.replace("-"," ")))&&o[l+3].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+3]}`),o[l+4]&&!y.some(p=>String(o[l+4]).includes(p))&&!y.some(p=>String(o[l+4]).includes(p.replace("-"," ")))&&o[l+4].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+4]}`),o[l+5]&&!y.some(p=>String(o[l+5]).includes(p))&&!y.some(p=>String(o[l+5]).includes(p.replace("-"," ")))&&o[l+5].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[l+5]}`),o[l+6]&&!y.some(p=>String(o[l+6]).includes(p))&&!y.some(p=>String(o[l+6]).includes(p.replace("-"," ")))&&o[l+6].match(/ЗАМЕНЫ/g)===null&&w.push(`${o[l+6]}`)))))),v=w.length,b&&(w=w.join(" ").slice(b.length+1))):b&&(w=o[l].slice(b.length+1)),typeof w=="string"){let p=w.replace(/ +/g," ").split(/\. (?=[А-Яа-я0-9(])|\) (?=[А-Яа-я0-9(])/g).reverse()[0],q=w.replace(/ +/g," ").match(/[0-9]п([,\-])[0-9]п|[0-9]([,\-])[0-9]п|[0-9]п|[0-9]/)?.[0];q&&(w=w.replace(/ +/g," ").replace(q,"").replace(p,"")),n.push({text:`${w}`,group:b,pair:q,auditorium:p}),l+=v}}else n.push({text:`${o[l]} ${o[l+1]}`,group:"null",pair:"null",auditorium:"null"}),l+=2;s.html=await kt(n)}r(s)})}async function Rt(t){let e=await new S().load(),r=await new P().load(),a=r.getReplacement(0);if(t.html!=="null"&&t.html!==a.html){r.insertReplacement(t.link,t.date,t.html);let s=T.dark,n=await new E(s,t.html).getImage();for(let i of e.all){let y=`background-image: url(${i.settings.theme});`,o=i.settings.theme==="standard"?n:await new E(y,t.html).getImage();i.payment.status!==0&&i.settings.replacement==="on"&&await c.payment.groupTG(i)&&await m.telegram.sendPhoto(i.userId,Ie.Input.fromBuffer(Buffer.from(o),"replacement.png")).then(async()=>{await c.payment.alert(i)}).catch(l=>{console.log(l)})}}else await m.telegram.sendMessage(6018898378,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B")}async function kt(t){let e=[];for(let r in t)if(t[r].group==="null")e.push(`<tr><td colspan="8"><b>${t[r].text}</b></td></tr>`),e.push('<tr><td><b>\u0413\u0440\u0443\u043F\u043F\u0430</b></td><td><b>\u041F\u0430\u0440\u0430</b></td><td colspan="2"><b>\u041F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td><td><b><===></b></td><td colspan="2"><b>\u0417\u0430\u043C\u0435\u043D\u0430</b></td><td><b>\u0410\u0443\u0434\u0438\u0442\u043E\u0440\u0438\u044F</b></td></tr>'),e.push('<tr><td colspan="8" class="line"></td></tr>');else{let a=/[А-Я][а-я]+ [А-Я].[А-Я].|\([а-я]+\)|\([А-Яа-я0-9 .]+ +[А-Яа-я0-9 .]+\)|[А-Яа-я0-9]+/g,n=t[r].text.replace(/ +/g," ").match(a),i=[],y=0;for(let l in n)if(Number(l)===y)if(n[Number(l)+1]&&n[Number(l)+1].startsWith("(")){let g=[`${n[Number(l)]}`,`
${n[Number(l)+1]}`];n[Number(l)+2]&&n[Number(l)+2].startsWith("(")&&(g.push(`
${n[Number(l)+2]}`),n[Number(l)+3]&&n[Number(l)+3].startsWith("(")&&g.push(`
${n[Number(l)+3]}`)),y+=g.length,i.push(g.join(" "))}else i.push(n[Number(l)]),y+=1;let o=`<td colspan="5"><b>${i.join(" ")}</b></td>`;i.length===1?o=`<td colspan="2"><b>${i[0]}</b></td><td><b></b></td><td colspan="2"><b></b></td>`:i.length===3?o=`<td colspan="2"><b>${i[0]}</b></td><td><b>${i[1]}</b></td><td colspan="2"><b>${i[2]}</b></td>`:i.length===2?o=`<td colspan="2"><b>${i[0]}</b></td><td><b></b></td><td colspan="2"><b>${i[1]}</b></td>`:i.length===4&&(o=`<td><b>${i[0]}</b></td><td><b>${i[1]}</b></td><td></td><td><b>${i[2]}</b></td><td><b>${i[3]}</b></td>`),t[Number(r)+1]?.group==="null"?(e.push(`<tr><td><b>${t[r].group}</b></td><td><b>${t[r].pair}</b></td>${o}<td><b>${t[r].auditorium}</b></td></tr>`),e.push('<tr><td colspan="8" class="line"></td></tr>')):e.push(`<tr><td><b>${t[r].group}</b></td><td><b>${t[r].pair}</b></td>${o}<td><b>${t[r].auditorium}</b></td></tr>`)}return e.join("")}var se={};k(se,{alert:()=>xe,groupTG:()=>It,paid:()=>Pt,preAlert:()=>Dt,recount:()=>Mt});async function Mt(){let t=await new S().load();for(let e of t.all){let r=h.paymentMessages.cost(e.info.id,e.payment.price,e.payment.referral.agentsApprove);r>0&&(e.payment.status===1?await m.telegram.sendMessage(e.info.id,h.paymentMessages.ban(e.payment.price),{parse_mode:"HTML"}).catch(a=>{console.log(a)}):e.payment.status===2?await m.telegram.sendMessage(e.info.id,h.paymentMessages.standard(r,e.payment.price),{parse_mode:"HTML"}).catch(a=>{console.log(a)}):e.payment.status>2&&await m.telegram.sendMessage(e.info.id,h.paymentMessages.changeStatus(e.payment.status-1),{parse_mode:"HTML"}).catch(a=>{console.log(a)}),e.payment.status>0&&(e.payment.status+=-1))}}async function Dt(){let e=["31.01","28.02","31.03","30.04","31.05","30.06","31.07","31.08","30.09","31.10","30.11","31.12"][new Date().getMonth()],r=await new S().load();for(let a of r.all)a.payment.status===1&&(await m.telegram.sendMessage(a.info.id,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0434\u043E ${e}, \u0438\u043D\u0430\u0447\u0435 \u0431\u0443\u0434\u0435\u0442\u0435 \u043E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043E\u0442 \u0431\u043E\u0442\u0430`).catch(s=>{console.log(s)}),await xe(a))}async function xe(t){if(t.payment.status===1){let e=h.paymentMessages.cost(t.info.id,t.payment.price,t.payment.referral.agentsApprove);await m.telegram.sendMessage(t.info.id,h.paymentMessages.standard(e,t.payment.price),{parse_mode:"HTML"}).catch(r=>{console.log(r)})}}async function Pt(){return new Promise(async function(t){let e=await new S().load();e.all.sort((n,i)=>n.info.name.localeCompare(i.info.name));let r=[[]],a=0,s=0;for(let n of e.all)a%5===0&&a!==0?(s+=1,r.push([]),r[s].push({text:n.info.name,callback_data:`userPaid${n.info.id}`}),a+=1):(r[s].push({text:n.info.name,callback_data:`userPaid${n.info.id}`}),a+=1);t(r)})}async function It(t){if(t.info.id<0){let e=await new S().load(),r=t.info.bots;for(let a of e.all)if(a.info.id!==t.info.id&&(a.payment.status===-1||a.payment.status>2)){let s=await m.telegram.getChatMember(t.info.id,a.info.id);(s.status==="member"||s.status==="creator"||s.status==="administrator")&&(r+=1)}return r===Number(m.telegram.getChatMembersCount(t.info.id))}else return!0}var ae={};k(ae,{paidStatus:()=>Lt,setDutyDay:()=>Bt,setGroup:()=>vt,settings:()=>Ne,userPaid:()=>xt,userStatus:()=>Nt,vipStatus:()=>qt});var _=require("telegraf");async function xt(t,e){t.editMessageText(`\u0422\u0435\u043A\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441: ${h.payment.get(e.payment.status)}
\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u043D\u0430:`,{reply_markup:{inline_keyboard:[[_.Markup.button.callback("true",`userStatus_2___${e.info.id}`),_.Markup.button.callback("false",`userStatus_1___${e.info.id}`),_.Markup.button.callback("free",`userStatus_f___${e.info.id}`),_.Markup.button.callback("vip",`userStatus_vip_${e.info.id}`),_.Markup.button.callback("ban",`userStatus_0___${e.info.id}`),_.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(r=>{console.log(r)})}async function Nt(t){let e=t.callbackQuery?.data.slice(11),r=Number(e.slice(4)),a=r===0?void 0:await new u().load(r);if(e.startsWith("vip"))t.editMessageText("\u0423\u0440\u043E\u0432\u0435\u043D\u044C VIP:",{reply_markup:{inline_keyboard:[[_.Markup.button.callback("2\u043C\u0435\u0441",`vipStatus_3_${r}`),_.Markup.button.callback("3\u043C\u0435\u0441",`vipStatus_4_${r}`),_.Markup.button.callback("4\u043C\u0435\u0441",`vipStatus_5_${r}`),_.Markup.button.callback("5\u043C\u0435\u0441",`vipStatus_6_${r}`),_.Markup.button.callback("6\u043C\u0435\u0441",`vipStatus_7_${r}`),_.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(s=>{console.log(s)});else if(e.startsWith("undo")){let s=await c.payment.paid();t.editMessageText("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:s}}).catch(n=>{console.log(n)})}else{if(!a)return;let s=e.startsWith("f")?-1:Number(e.slice(0,1));a.payment.status=s,a.payment.paid="true",await c.callback_query.userPaid(t,a),s===0?await m.telegram.sendMessage(a.info.id,"\u0412\u044B \u0431\u044B\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C").catch(n=>{console.log(n)}):await m.telegram.sendMessage(a.info.id,h.paymentMessages.changeStatus(s)).catch(n=>{console.log(n)})}}async function qt(t){let e=t.callbackQuery?.data,r=Number(e.slice(12)),a=await new u().load(r),s=Number(e.slice(10,11));a.payment.status=s,a.payment.paid="true",await c.callback_query.userPaid(t,a),await m.telegram.sendMessage(a.info.id,h.paymentMessages.changeStatus(s)).catch(n=>{console.log(n)})}async function vt(t){let e=t.callbackQuery?.data,r=t.from?.id,a=String(e.slice(8));if(r){let s=await new u().load(r);s.info.groupName=a,await t.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u0430 \u0433\u0440\u0443\u043F\u043F\u0430: ${a}`).catch(n=>{console.log(n)})}}async function Lt(t){let e=t.callbackQuery?.data,r=Number(e.slice(10));await m.telegram.sendMessage(r,"\u041E\u0448\u0438\u0431\u043A\u0430. \u0412\u044B \u043D\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443!").catch(a=>{console.log(a)}),m.telegram.deleteMessage(Number(t.callbackQuery?.from.id),Number(t.callbackQuery?.message?.message_id)).catch(a=>{console.log(a)})}async function Bt(t){let e=t.callbackQuery?.data,r=t.from?.id,a=Number(e.slice(10)),s=new Map().set(1,"\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A").set(2,"\u0412\u0442\u043E\u0440\u043D\u0438\u043A").set(3,"\u0421\u0440\u0435\u0434\u0430").set(4,"\u0427\u0435\u0442\u0432\u0435\u0440\u0433").set(5,"\u041F\u044F\u0442\u043D\u0438\u0446\u0430").set(6,"\u0421\u0443\u0431\u0431\u043E\u0442\u0430");if(r){let n=await new u().load(r);n.duty.day=a,await t.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D \u0434\u0435\u043D\u044C: ${s.get(a)}`).catch(i=>{console.log(i)})}}var Ne={keyboard:async t=>[[_.Markup.button.callback(`\u0414\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430: ${t.settings.duty}`,`settingsDuty${t.info.id}`),_.Markup.button.callback(`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${t.settings.schedule}`,`settingsSchedule${t.info.id}`),_.Markup.button.callback(`\u0417\u0430\u043C\u0435\u043D\u044B: ${t.settings.replacement}`,`settingsReplacement${t.info.id}`)]],schedule:async t=>{let e=t.callbackQuery?.data,r=await new u().load(Number(e.slice(16)));r.settings.switchSchedule(),await t.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await Ne.keyboard(r)}}).catch(a=>{console.log(a)})},replacement:async t=>{let e=t.callbackQuery?.data,r=await new u().load(Number(e.slice(19)));r.settings.switchReplacement(),await t.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await c.callback_query.settings.keyboard(r)}}).catch(a=>{console.log(a)})},duty:async t=>{let e=t.callbackQuery?.data,r=await new u().load(Number(e.slice(12)));r.settings.switchDuty(),await t.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await c.callback_query.settings.keyboard(r)}}).catch(a=>{console.log(a)})}};var ne={};k(ne,{duty:()=>Ct});async function Ct(t){if(t.chat?.id){let e=await new u().load(t.chat.id),r=new Date().getTime(),a=new Date().getDay();if(a!==0&&e.payment.status!==0&&e.duty.lastDate+432e5<=r){let s=await new U().load(e.info.groupName);s.insertDuty(r,e.info.id,e.info.name);let n=s.users;e.duty.count+=1,e.duty.lastDate=r;for(let i of n)(i.info.role==="admin"||i.duty.day===a)&&i.info.groupName===e.info.groupName&&console.log(i.duty.day);await t.reply("\u0423\u0441\u043F\u0435\u0448\u043D\u043E")}else await m.telegram.sendMessage(t.chat.id,"\u0421\u0435\u0433\u043E\u0434\u043D\u044F \u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435, \u0432\u044B \u0443\u0436\u0435 \u043E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B\u0438 \u0438\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B").catch(s=>{console.log(s)})}}var ie={};k(ie,{generateHTML:()=>ve,sender:()=>Ht});var qe=require("telegraf");async function Ht(){let t=await new S().load(),e=T.light,r=[],a=new Map;for(let s of t.all)r.indexOf(s.info.groupName)===-1&&s.info.groupName!=="null"&&r.push(s.info.groupName);for(let s of r){let n=await ve(s,0),i=await new E(e,n).getImage();a.set(s,{html:n,standard:i})}for(let s of t.all)if(s.payment.status!==0&&s.settings.duty==="on"&&await c.payment.groupTG(s)&&s.info.id===6018898378){let n=`background-image: url(${s.settings.theme});`,i=s.settings.theme==="standard"?a.get(s.info.groupName).standard:await new E(n,a.get(s.info.groupName).html).getImage();await m.telegram.sendPhoto(s.userId,qe.Input.fromBuffer(Buffer.from(i),"duty.png")).then(async()=>{await c.payment.alert(s)}).catch(y=>{console.log(y)})}}async function ve(t,e){let r=await new U().load(t),a=r.users,s=[[],[],[],[],[],[]],n=[[],[],[],[],[],[]],i=[[],[],[],[],[],[]],y=[],o=[],l=[],g=a.sort((d,J)=>J.duty.count-d.duty.count);for(let d of a)d.duty.day!==-1&&s[d.duty.day-1].push(d.info.name);for(let d of g)d.duty.day!==-1&&i[d.duty.day-1].push(`${d.info.name}-${d.duty.count}`);let b=new Date(new Date().getTime()-6048e5*e),w=b.getDate()-b.getDay(),v=w+6,p=new Date(b.setDate(w)),q=new Date(b.setDate(v)),ut=r.getDuty(p.getTime(),q.getTime());for(let d of ut){let J=new Date(d.date).getDay();n[J-1].push(d.name)}for(let d=0;d<5;d++)y.push(`<tr><td><b>${s[0]&&s[0][d]?s[0][d]:""}</b></td><td><b>${s[1]&&s[1][d]?s[1][d]:""}</b></td><td><b>${s[3]&&s[2][d]?s[2][d]:""}</b></td><td><b>${s[3]&&s[3][d]?s[3][d]:""}</b></td><td><b>${s[4]&&s[4][d]?s[4][d]:""}</b></td><td><b>${s[5]&&s[5][d]?s[5][d]:""}</b></td></tr>`),o.push(`<tr><td><b>${n[0]&&n[0][d]?n[0][d]:""}</b></td><td><b>${n[1]&&n[1][d]?n[1][d]:""}</b></td><td><b>${n[2]&&n[2][d]?n[2][d]:""}</b></td><td><b>${n[3]&&n[3][d]?n[3][d]:""}</b></td><td><b>${n[4]&&n[4][d]?n[4][d]:""}</b></td><td><b>${n[5]&&n[5][d]?n[5][d]:""}</b></td></tr>`),l.push(`<tr><td><b>${i[0]&&i[0][d]?i[0][d]:""}</b></td><td><b>${i[1]&&i[1][d]?i[1][d]:""}</b></td><td><b>${i[2]&&i[2][d]?i[2][d]:""}</b></td><td><b>${i[3]&&i[3][d]?i[3][d]:""}</b></td><td><b>${i[4]&&i[4][d]?i[4][d]:""}</b></td><td><b>${i[5]&&i[5][d]?i[5][d]:""}</b></td></tr>`);return`
<tr><td colspan="6"><b>\u0414\u0435\u0436\u0443\u0440\u043D\u044B\u0435 \u043F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td></tr>
<tr><td><b>\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A</b></td><td><b>\u0412\u0442\u043E\u0440\u043D\u0438\u043A</b></td><td><b>\u0421\u0440\u0435\u0434\u0430</b></td><td><b>\u0427\u0435\u0442\u0432\u0435\u0440\u0433</b></td><td><b>\u041F\u044F\u0442\u043D\u0438\u0446\u0430</b></td><td><b>\u0421\u0443\u0431\u0431\u043E\u0442\u0430</b></td></tr>
<tr><td colspan="6" class="line"></td></tr>
${y.join("")}
<tr><td colspan="6" class="line"></td></tr>
<tr><td colspan="6"><b>\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B\u0438</b></td></tr>
<tr>
<td><b>${new Date(p.getTime()+864e5).getDate()}.${`0${new Date(p.getTime()+864e5).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*2).getDate()}.${`0${new Date(p.getTime()+864e5*2).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*3).getDate()}.${`0${new Date(p.getTime()+864e5*3).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*4).getDate()}.${`0${new Date(p.getTime()+864e5*4).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*5).getDate()}.${`0${new Date(p.getTime()+864e5*5).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(p.getTime()+864e5*6).getDate()}.${`0${new Date(p.getTime()+864e5*6).getMonth()+1}`.slice(-2)}</b></td>
</tr>
<tr><td colspan="6" class="line"></td></tr>
${o.join("")}
<tr><td colspan="6" class="line"></td></tr>
<tr><td colspan="6"><b>\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0434\u0435\u0436\u0443\u0440\u0441\u0442\u0432</b></td></tr>
<tr><td colspan="6" class="line"></td></tr>
${l.join("")}
`}var c={schedule:te,replacement:re,payment:se,callback_query:ae,hears:ne,duty:ie};var Le=()=>{m.hears("\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B",async t=>{await c.hears.duty(t)}),m.on("callback_query",async t=>{let e=t.callbackQuery?.data;if(e.startsWith("userPaid")){let r=await new u().load(Number(e.slice(8)));await c.callback_query.userPaid(t,r)}else e.startsWith("paidStatus")?await c.callback_query.paidStatus(t):e.startsWith("userStatus")?await c.callback_query.userStatus(t):e.startsWith("vipStatus")?await c.callback_query.vipStatus(t):e.startsWith("settings")?e.startsWith("settingsSchedule")?await c.callback_query.settings.schedule(t):e.startsWith("settingsReplacement")?await c.callback_query.settings.replacement(t):e.startsWith("settingsDuty")&&await c.callback_query.settings.duty(t):e.startsWith("setGroup")?await c.callback_query.setGroup(t):e.startsWith("setDutyDay")&&await c.callback_query.setDutyDay(t)})};async function Be(t){if(t.chat?.id&&t.from?.username){let e=await new S().load();e.getUser(t.chat.id)||(await e.createUser(t.chat.id,t.from.username,2,t.from.username,await Wt(t.chat.id)),await m.telegram.sendMessage(6018898378,`${t.chat.id} ${t.from.username}, \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u043B\u0441\u044F \u043A \u0431\u043E\u0442\u0443`)),await t.reply(`\u0412\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0431\u043E\u0442\u0430!
\u0414\u043B\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0439 \u0440\u0430\u0431\u043E\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 (/setname \u0432\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F) \u0438 (/setgroup).
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0432\u0432\u0435\u0441\u0442\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447 \u043A\u043E\u043C\u0430\u043D\u0434\u043E\u0439 (/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447), \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u0435 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 \u043C\u0435\u0441\u044F\u0446 \u0431\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`)}}async function Wt(t){return t<0?"null":t.toString().split("").map(Number).map(e=>(e||10)+64).map(e=>String.fromCharCode(Number(e))).join("")}async function Ce(t){let{text:e}=t;if(e=e?.slice(6),t.chat?.id===6018898378&&e&&!e.startsWith("monica_schedule_bot")){let r=await new S().load();for(let a of r.all)a.payment.status!==0&&(await m.telegram.sendMessage(a.info.id,e).catch(s=>{console.log(s)}),await c.payment.alert(a))}else await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function He(t){await t.reply("\u041D\u0435 \u0443\u0434\u0430\u043B\u044F\u0439\u0442\u0435 \u044D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435!",{reply_markup:{resize_keyboard:!0,keyboard:[["\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B"]]}})}async function We(t,e){if(t===6018898378){let r=await new B().load(),a=[],s=r.getSettings("scheduleLink"),n=r.getSettings("replacementLink"),i=await(await fetch(h.fetchUrl)).text(),y=new RegExp('<a href="http:\\/\\/rgkript.ru\\/wp-content\\/uploads\\/\\/'+new Date().getFullYear()+'[0-9/.\\-A-Za-z_]+"',"g"),o=Array.from(new Set(i.match(y))).map(g=>g.slice(9,-1)),l=i.match(/<strong>[А-Яа-я0-9. ]+/g);if(l)for(let g of l)g.match(/[0-9]+.[0-9]+.[0-9]+/g)&&a.push(g[0]);s&&o[0]!==s?.value?(s.value=o[0],await m.telegram.sendMessage(t,`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${a[0]} ${o[0].slice(36)}`).then(g=>{setTimeout(()=>{m.telegram.deleteMessage(g.chat.id,g.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(g=>{console.log(g)}),await c.schedule.regenerate(o[0],a[0]).then(async g=>{await c.schedule.sender(g)})):await m.telegram.sendMessage(t,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").then(g=>{setTimeout(()=>{m.telegram.deleteMessage(g.chat.id,g.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(g=>{console.log(g)}),n&&o[1]!==n?.value?(n.value=o[1],await m.telegram.sendMessage(t,`\u0417\u0430\u043C\u0435\u043D\u044B: ${a[1]} ${o[1].slice(36)}`).then(g=>{setTimeout(()=>{m.telegram.deleteMessage(g.chat.id,g.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(g=>{console.log(g)}),await c.replacement.regenerate(o[1],a[1]).then(async g=>{await c.replacement.sender(g)})):await m.telegram.sendMessage(t,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B").then(g=>{setTimeout(()=>{m.telegram.deleteMessage(g.chat.id,g.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(g=>{console.log(g)})}else{if(!e)return;await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}}async function Ae(t){if(t.chat?.id){let e=await new u().load(t.chat.id);e?e.info.id>0?(await m.telegram.sendMessage(6018898378,`${e.info.name}(${e.info.id}) \u043E\u043F\u043E\u0432\u0435\u0441\u0442\u0438\u043B \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435, \u0441\u0442\u0430\u0442\u0443\u0441: ${h.payment.get(e.payment.status)}`,{reply_markup:{inline_keyboard:[[{text:"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`paidStatus${e.info.id}`},{text:"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`userPaid${e.info.id}`}]]}}),await t.reply("\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0443 \u043E\u043F\u043B\u0430\u0442\u044B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D, \u043E\u0436\u0438\u0434\u0430\u0439\u0442\u0435")):await t.reply("\u041E\u0448\u0438\u0431\u043A\u0430. \u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B"):await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Ge(t){if(t.chat?.id){let e=await new u().load(t.chat.id);if(e){let r=e.info.groupName,a=e.info.id,s=e.info.name,n=e.payment.referral.key,i=h.paymentMessages.refBonus(e.info.id,e.payment.referral.agentsApprove);await t.reply(`\u0413\u0440\u0443\u043F\u043F\u0430: <b>${r}</b>
Id: \u{1F517}<code>${a}</code>
\u0424\u0430\u043C\u0438\u043B\u0438\u044F: <b>${s}</b>
\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B: <b>${h.payment.get(e.payment.status)}</b>
\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438: <b>${Math.floor(e.payment.price-e.payment.price*(i/100))}</b>
\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447: \u{1F517}<code>${n}</code>
\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432: <b>${i}%</b>
\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C: @a_korop`,{parse_mode:"HTML"})}else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Fe(t){if(t.chat?.id){let e=await new u().load(t.chat.id),{text:r}=t;if(e)if(e.payment.paid==="false"&&e.payment.referral.user){let a=r?.slice(10);if(a){let s=await new u().load(0,{refKey:a});s?e.info.id!==s.info.id?(e.payment.status+=1,s.payment.referral.insertReferral(e.info.id),await t.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447!
\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043C\u0435\u043D\u0435\u043D \u043D\u0430 ${h.payment.get(e.payment.status)}`)):await t.reply("\u0412\u044B \u043D\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u0441\u0432\u043E\u0439 \u0436\u0435 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447"):await t.reply(`\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u0430\u0433\u0435\u043D\u0442 \u0434\u043B\u044F \u043A\u043B\u044E\u0447\u0430: ${a}`)}else await t.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447(/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447)")}else await t.reply("\u0412\u044B \u0443\u0436\u0435 \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447, \u043B\u0438\u0431\u043E \u043E\u043F\u043B\u0430\u0447\u0438\u0432\u0430\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0440\u0430\u043D\u0435\u0435");else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var Oe=require("telegraf");async function Qe(t){if(t.chat?.id){let e=await new u().load(t.chat.id);if(e)if(e.payment.status!==0)if(await c.payment.groupTG(e)){let r=(await new P().load()).getReplacement(0).html;if(!r)return;let a=e.settings.theme==="standard"?T.dark:`background-image: url(${e.settings.theme});`,s=await new E(a,r).getImage();await t.replyWithPhoto(Oe.Input.fromBuffer(Buffer.from(s),"schedule.png")),await c.payment.alert(e)}else await t.reply("\u041D\u0435 \u0432\u0441\u0435 \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443");else await t.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Ke(t){t.chat?.id===6018898378?(await t.reply("\u0411\u043E\u0442 \u0432\u044B\u043A\u043B\u044E\u0447\u0435\u043D!"),setTimeout(()=>{process.exit(0)},1e3*60)):await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}var je=require("telegraf");async function ze(t){if(t.chat?.id){let e=await new u().load(t.chat.id);if(e)if(e.payment.status!==0)if(e.info.groupName!=="null"){let a=(await new U().load(e.info.groupName)).schedule;if(a!=="null")if(await c.payment.groupTG(e)){let s=e.settings.theme==="standard"?T.light:`background-image: url(${e.settings.theme});`,n=await new E(s,a).getImage();await t.replyWithPhoto(je.Input.fromBuffer(Buffer.from(n),"schedule.png")),await c.payment.alert(e)}else await t.reply("\u041D\u0435 \u0432\u0441\u0435 \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443");else await t.reply("\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E")}else await t.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443 /setgroup");else await t.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Ze(t){if(t.chat?.id)if(await new u().load(t.chat.id)){let r=await new R().load(),a=[[]],s=0,n=0;for(let i of r.all)s%5===0&&s!==0?(n+=1,a.push([]),a[n].push({text:i.name,callback_data:`setGroup${i.name}`}),s+=1):(a[n].push({text:i.name,callback_data:`setGroup${i.name}`}),s+=1);await t.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443:",{reply_markup:{inline_keyboard:a}})}else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}async function Ve(t){if(t.chat?.id){let e=await new u().load(t.chat.id),{text:r}=t;if(e){let a=r?.slice(9);a?(e.info.name=a,await t.reply(`\u0412\u0430\u0448\u0435 \u0438\u043C\u044F - ${a}`)):await t.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0438\u043C\u044F(/setname \u0432\u0430\u0448\u0435 \u0438\u043C\u044F)")}else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Xe(t){if(t.chat?.id){let e=await new u().load(t.chat.id);e?await t.reply("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await c.callback_query.settings.keyboard(e)}}):await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Je(t){if(t.chat?.id===6018898378){let e=await c.payment.paid();await t.reply("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:e}})}else await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function Ye(t){if(t.chat?.id){let e=await new u().load(t.chat.id),{text:r}=t,a=r?.slice(7);e.payment.status!==0?e&&a&&!a.startsWith("monica_schedule_bot")?(e.settings.theme=a,await t.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0442\u0435\u043C\u0430: ${e.settings.theme}`)):await t.reply("\u041E\u0448\u0438\u0431\u043A\u0430, \u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0432\u044B \u043D\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0432 \u0431\u043E\u0442\u0435, \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443, \u043A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B \u0438\u043B\u0438 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0435 \u0432\u0435\u0434\u0435\u0442 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443"):await t.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C")}}async function et(t){if(t.chat?.id)if(await new u().load(t.chat.id)){let r=[{name:"\u041F\u043D\u0434",value:1},{name:"\u0412\u0442\u0440",value:2},{name:"\u0421\u0440\u0434",value:3},{name:"\u0427\u0442\u0432",value:4},{name:"\u041F\u0442\u043D",value:5},{name:"\u0421\u0431\u0442",value:6}],a=[[]];for(let s of r)a[0].push({text:s.name,callback_data:`setDutyDay${s.value}`});await t.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u043D\u044C:",{reply_markup:{inline_keyboard:a}})}else await t.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}var $={start:Be,send:Ce,duty:He,fetch:We,paid:Ae,profile:Ge,referral:Fe,replacement:Qe,restart:Ke,schedule:ze,setGroup:Ze,setName:Ve,settings:Xe,status:Je,theme:Ye,setDutyDay:et};var tt=()=>{m.command("start",async t=>{await $.start(t)}),m.command("fetch",async t=>{await $.fetch(t.chat.id,t)}),m.command("send",async t=>{await $.send(t)}),m.command("schedule",async t=>{await $.schedule(t)}),m.command("theme",async t=>{await $.theme(t)}),m.command("status",async t=>{await $.status(t)}),m.command("settings",async t=>{await $.settings(t)}),m.command("profile",async t=>{await $.profile(t)}),m.command("setname",async t=>{await $.setName(t)}),m.command("setgroup",async t=>{await $.setGroup(t)}),m.command("referral",async t=>{await $.referral(t)}),m.command("paid",async t=>{await $.paid(t)}),m.command("replacement",async t=>{await $.replacement(t)}),m.command("restart",async t=>{await $.restart(t)}),m.command("duty",async t=>{await $.duty(t)}),m.command("setdutydate",async t=>{await $.setDutyDay(t)})};var z=require("cron");var rt=()=>{z.CronJob.from({cronTime:"0 10 14 * * 1-5,7",onTick:async()=>{await $.fetch(6018898378)},start:!0}),z.CronJob.from({cronTime:"0 0 13 1 * *",onTick:async()=>{await c.payment.recount().catch(t=>{console.log(t)})},start:!0}),z.CronJob.from({cronTime:"0 35 7 25-31 * *",onTick:async()=>{await c.payment.preAlert().catch(t=>{console.log(t)})},start:!0})};var at=M(require("express")),nt=M(require("cors")),it=M(require("path")),ot=M(require("http"));var I={};k(I,{dutyTable:()=>At,replacementTable:()=>Gt,scheduleTable:()=>Ft,select:()=>Ot,update:()=>Qt});var At=async(t,e)=>{let r=await new u().load(t);return{table:await c.duty.generateHTML(r.info.groupName,e)}};var Gt=async t=>{let e=(await new P().load()).getReplacement(t);return{table:e?.html?e.html:"null"}};var Ft=async t=>{let e=await new u().load(t),r=await new U().load(e.info.groupName);return{table:r.schedule!=="null"?r.schedule:"<tr><td><b>\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E!</b></td></tr>"}};async function Ot(t){let e=await new u().load(t),r=await new R().load(),a=[],s=[];for(let n of r.all)n.name===e.info.groupName?a.push(`<option selected value='${n.name}'>${n.name}</option>`):n.schedule==="null"?s.push(`<option disabled value='${n.name}'>${n.name}</option>`):a.push(`<option value='${n.name}'>${n.name}</option>`);return{table:a.concat(s).join("")}}async function Qt(t){let e=await new U().load(t);return{table:e.schedule!=="null"?e.schedule:"<tr><td><b>\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E!</b></td></tr>"}}var x={};k(x,{dutyDay:()=>Zt,group:()=>zt,name:()=>Vt,table:()=>Kt});var Kt=async t=>{let e=await new u().load(t);return{table:await jt(e)}};async function jt(t){let e=h.paymentMessages.refBonus(t.info.id,t.payment.referral.agentsApprove),r=new Map().set(1,"\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A").set(2,"\u0412\u0442\u043E\u0440\u043D\u0438\u043A").set(3,"\u0421\u0440\u0435\u0434\u0430").set(4,"\u0427\u0435\u0442\u0432\u0435\u0440\u0433").set(5,"\u041F\u044F\u0442\u043D\u0438\u0446\u0430").set(6,"\u0421\u0443\u0431\u0431\u043E\u0442\u0430").set(-1,"\u041D\u0435 \u0437\u0430\u0434\u0430\u043D\u043E"),a=await new R().load(),s=[];for(let i of a.all)i.name===t.info.groupName?s.push(`<option selected value='${i.name}'>${i.name}</option>`):s.push(`<option value='${i.name}'>${i.name}</option>`);let n=[];for(let i=1;i<7;i++)i===t.duty.day?n.push(`<option selected value='${i}'>${r.get(i)}</option>`):n.push(`<option value='${i}'>${r.get(i)}</option>`);return`
<tr><td colspan="2"><b class="profileB">\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F</b></td><td><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0438\u0442\u044C</b></td></tr>
<tr><td><b class="profileB">\u0413\u0440\u0443\u043F\u043F\u0430:</b></td><td><b class="profileB">${t.info.groupName}</b></td><td><b class="profileB"><form name="myForm"><select class="selectP" name="selectGroup" id="selectGroup">${s.join("")}</select></form>\u25BC</b></td></tr>
<tr><td><b class="profileB">\u0418\u043C\u044F:</b></td><td><b class="profileB">${t.info.name}</b></td><td><b class="profileB">|</b><form name="myForm1"><input class="inputP" type="text" id="name" name="name" required/></form></td></tr>
<tr><td><b class="profileB">\u0414\u0435\u043D\u044C \u0434\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430:</b></td><td><b class="profileB">${r.get(t.duty.day)}</b></td><td><b class="profileB"><form name="myForm2"><select class="selectP" name="selectDutyDay" id="selectDutyDay">${n.join("")}</select></form>\u25BC</b></td></tr>
<tr><td><b class="profileB">\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C id:</b></td><td><b class="profileB">${t.info.id}</b></td></tr>
<tr><td><b class="profileB">\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B:</b></td><td><b class="profileB">${h.payment.get(t.payment.status)}</b></td></tr>
<tr><td><b class="profileB">\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438:</b></td><td><b class="profileB">${Math.floor(t.payment.price-t.payment.price*(e/100))}\u0440</b></td></tr>
<tr><td><b class="profileB">\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447:</b></td><td><b class="profileB">${t.payment.referral.key}</b></td></tr>
<tr><td><b class="profileB">\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432:</b></td><td><b class="profileB">${e}%</b></td></tr>
<tr><td><b class="profileB">\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C:</b></td><td><b class="profileB">@a_korop</b></td></tr>
<tr><td colspan="2"></td><td><button onclick="update()"><b class="profileB">\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C</b></button></td></tr>
`}async function zt(t,e){let r=await new u().load(t);r.info.groupName=decodeURI(e)}async function Zt(t,e){let r=await new u().load(t);r.duty.day=e}async function Vt(t,e){let r=await new u().load(t);r.info.name=decodeURI(e)}var D={};k(D,{bg:()=>rr,duty:()=>er,lightMode:()=>sr,notification:()=>Xt,replacement:()=>Yt,schedule:()=>Jt,theme:()=>tr});var Xt=async t=>{let e=await new u().load(t);return{table:await Z(e)}};async function Jt(t){let e=await new u().load(t);return e.settings.switchSchedule(),{table:await Z(e)}}async function Yt(t){let e=await new u().load(t);return e.settings.switchReplacement(),{table:await Z(e)}}async function er(t){let e=await new u().load(t);return e.settings.switchDuty(),{table:await Z(e)}}async function Z(t){return`
<tr><td colspan="2"><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439</b></td></tr>
<tr><td><b class="profileB">\u041F\u043E\u044F\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044F:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsSchedule()"><b class="profileB">${t.settings.schedule}</b></button></td></tr>
<tr><td><b class="profileB">\u041F\u043E\u044F\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u044B\u0445 \u0437\u0430\u043C\u0435\u043D:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsReplacement()"><b class="profileB">${t.settings.replacement}</b></button></td></tr>
<tr><td><b class="profileB">\u0420\u0430\u0441\u0441\u044B\u043B\u043A\u0430 \u0442\u0430\u0431\u043B\u0438\u0446\u044B \u0434\u0435\u0436\u0443\u0440\u043D\u044B\u0445 \u0437\u0430 \u043D\u0435\u0434\u0435\u043B\u044E:</b></td><td style="min-width: 10vw"><button style="width: 100%;" onclick="updateSettingsDuty()"><b class="profileB">${t.settings.duty}</b></button></td></tr>
`}var tr=async t=>{let e=await new u().load(t);return{table:await oe(e)}};async function rr(t,e){let r=await new u().load(t);return r.settings.theme=e,{table:await oe(r)}}async function sr(t){let e=await new u().load(t);return e.settings.switchLightMode(),{table:await oe(e)}}async function oe(t){return`
<tr><td colspan="4"><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0442\u0435\u043C\u044B</b></td></tr>
<tr><td><b class="profileB">\u0424\u043E\u043D:</b></td><td><form name="myForm"><input class="inputP" type="url" id="theme" name="theme" required/></form></td><td><button onclick="updateSettingsTheme()"><b class="profileB">\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C</b></button></td><td><button onclick="updateSettingsThemeStandard()"><b class="profileB">\u041F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E</b></button></td></tr>
<tr><td colspan="2"><b class="profileB">\u0422\u0435\u043C\u043D\u0430\u044F \u0442\u0435\u043C\u0430:</b></td><td colspan="2"><button style="width: 100%;" onclick="updateSettingsLightMode()"><b class="profileB">${t.settings.lightMode===0?"off":"on"}</b></button></td></tr>
    `}var N={};k(N,{home:()=>ir,profile:()=>ar,settings:()=>nr});var V=require("fs"),X=M(require("path"));async function ar(t){return{body:(0,V.readFileSync)(X.default.join(t+"/html/profile.html"),"utf-8")}}async function nr(t){return{body:(0,V.readFileSync)(X.default.join(t+"/html/settings.html"),"utf-8")}}async function ir(t,e){let r=await new u().load(e);return r&&r.payment.status!==0?{body:(0,V.readFileSync)(X.default.join(t+"/html/home.html"),"utf-8")}:{body:'<table><tr><td><b class="profileB">\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0438\u043B\u0438 \u0435\u0449\u0435 \u043D\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043A \u0431\u043E\u0442\u0443!</b></td></tr></table>'}}var st=async t=>{let e=await new u().load(t),r=e.settings.theme,a=e.settings.lightMode===0?T.light:T.dark;return{gradient:r==="standard"?a.slice(11,-1):`url(${r})`}};var lt=t=>{let e=(0,at.default)();e.use((0,nt.default)()),e.get("/",(a,s)=>{s.sendFile(it.default.join(t+"/html/index.html"))}),e.get("/home/[0-9]+",async(a,s)=>{s.send(await N.home(t,Number(a.url.slice(6))))}),e.get("/home/scheduleTable/[0-9]+",async(a,s)=>{s.send(await I.scheduleTable(Number(a.url.slice(20))))}),e.get("/home/scheduleTable/selectGroup/[0-9]+",async(a,s)=>{s.send(await I.select(Number(a.url.slice(32))))}),e.get("/home/scheduleTable/updateGroup/[0-9%A-Za-z-]+",async(a,s)=>{s.send(await I.update(decodeURI(a.url.slice(32))))}),e.get("/home/replacementTable/[0-9]+",async(a,s)=>{s.send(await I.replacementTable(Number(a.url.slice(23))))}),e.get("/home/dutyTable/[0-9]+/[0-9]+",async(a,s)=>{let n=a.url.match(/[0-9]+/g);n&&s.send(await I.dutyTable(Number(n[0]),Number(n[1])))}),e.get("/profile",async(a,s)=>{s.send(await N.profile(t))}),e.get("/profile/[0-9]+",async(a,s)=>{s.send(await x.table(Number(a.url.slice(9))))}),e.get("/profile/editGroup/[0-9]+/[0-9%A-Za-z-]+",async(a,s)=>{let n=a.url.slice(19).match(/[0-9%A-Za-z\-]+/g);n&&await x.group(Number(n[0]),n[1]).then(()=>s.send())}),e.get("/profile/editDutyDay/[0-9]+/[0-9]+",async(a,s)=>{let n=a.url.slice(21).match(/[0-9]+/g);n&&await x.dutyDay(Number(n[0]),Number(n[1])).then(()=>s.send())}),e.get("/profile/editName/[0-9]+/[0-9%A-Za-z-]+",async(a,s)=>{let n=a.url.slice(18).match(/[0-9%A-Za-z\-]+/g);n&&await x.name(Number(n[0]),n[1]).then(()=>s.send())}),e.get("/settings",async(a,s)=>{s.send(await N.settings(t))}),e.get("/settings/notification/[0-9]+",async(a,s)=>{s.send(await D.notification(Number(a.url.slice(23))))}),e.get("/settings/notification/schedule/[0-9]+",async(a,s)=>{s.send(await D.schedule(Number(a.url.slice(32))))}),e.get("/settings/notification/replacement/[0-9]+",async(a,s)=>{s.send(await D.replacement(Number(a.url.slice(35))))}),e.get("/settings/notification/duty/[0-9]+",async(a,s)=>{s.send(await D.duty(Number(a.url.slice(28))))}),e.get("/settings/theme/[0-9]+",async(a,s)=>{s.send(await D.theme(Number(a.url.slice(16))))}),e.post("/settings/theme/bg",async(a,s)=>{s.send(await D.bg(Number(a.query.user),String(a.query.url)))}),e.post("/settings/theme/lightMode",async(a,s)=>{s.send(await D.lightMode(Number(a.query.user)))}),e.get("/randomGradient/[0-9]+",async(a,s)=>{s.send(await st(Number(a.url.slice(16))))}),ot.default.createServer(e).listen(3e3,"localhost")};var le=new j,{bot:m,connection:f}=le,{gradients:T}=le;le.addGradients().then(t=>{T=t});lt(__dirname);tt();Le();rt();0&&(module.exports={bot,connection,gradients});
