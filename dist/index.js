"use strict";var ve=Object.create;var I=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var We=Object.getOwnPropertyNames;var Ue=Object.getPrototypeOf,qe=Object.prototype.hasOwnProperty;var k=(e,t)=>{for(var a in t)I(e,a,{get:t[a],enumerable:!0})},F=(e,t,a,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of We(t))!qe.call(e,s)&&s!==a&&I(e,s,{get:()=>t[s],enumerable:!(r=Be(t,s))||r.enumerable});return e};var S=(e,t,a)=>(a=e!=null?ve(Ue(e)):{},F(t||!e||!e.__esModule?I(a,"default",{value:e,enumerable:!0}):a,e)),Qe=e=>F(I({},"__esModule",{value:!0}),e);var ct={};k(ct,{bot:()=>d});module.exports=Qe(ct);var G=S(require("dotenv"));G.default.config();var{TOKEN:K,PASSWORD:O,SQLHOST:j,SQLUSER:V,SQLDATABASE:z,SQLPASSWORD:Z,HTMLSTART1:X,HTMLSTART2:J,HTMLEND:Y,PUPPETEER:ee}=process.env;if(!K||!O||!j||!V||!z||!Z||!X||!J||!Y||!ee)throw new Error("Missing environment variables");var f={TOKEN:K,PASSWORD:O,SQLHOST:j,SQLUSER:V,SQLDATABASE:z,SQLPASSWORD:Z,HTMLSTART1:X,HTMLSTART2:J,HTMLEND:Y,PUPPETEER:eval(`(${ee})`)};var Le=require("telegraf"),P=require("cron"),M=S(require("path")),Ae=S(require("express")),He=S(require("cors")),Ce=S(require("http"));var te=S(require("mysql"));var xe={host:f.SQLHOST,user:f.SQLUSER,database:f.SQLDATABASE,password:f.SQLPASSWORD},y=te.default.createPool(xe),n={users:{select:async e=>new Promise(async function(t,a){y.query(`SELECT * FROM users WHERE userId = '${e}'`,(r,s)=>{r&&a(r),t(s[0])})}),select_all_by_group:async e=>new Promise(async function(t,a){y.query(`SELECT * FROM users WHERE groupName = '${e}'`,(r,s)=>{r&&a(r),t(s)})}),select_all:async()=>new Promise(async function(e,t){y.query("SELECT * FROM users",(a,r)=>{a&&t(a),e(r)})}),select_refAgents_by_refKey:async e=>new Promise(async function(t,a){y.query(`SELECT * FROM users WHERE refKey = '${e}'`,(r,s)=>{r&&a(r),t(s[0])})}),insert:async(e,t,a,r,s)=>{y.query(`INSERT INTO users (userId,userName,payment,name,refKey) values('${e}','${t}','${a}','${r}','${s}')`)},update_payment:async function(e,t){y.query(`UPDATE users SET payment = '${t}' WHERE userId = '${e}'`)},update_theme:async function(e,t){y.query(`UPDATE users SET theme = '${t}' WHERE userId = '${e}'`)},update_duty:async function(e,t){y.query(`UPDATE users SET duty = '${t}' WHERE userId = '${e}'`)},update_dutyDate:async function(e,t){y.query(`UPDATE users SET dutyDate = '${t}' WHERE userId = '${e}'`)},update_scheduleDate:async function(e,t){y.query(`UPDATE users SET scheduleDate = '${t}' WHERE userId = '${e}'`)},update_name:async(e,t)=>{y.query(`UPDATE users SET name = '${t}' WHERE userId = '${e}'`)},update_refAgents:async(e,t)=>{y.query(`UPDATE users SET refAgents = '${t}' WHERE userId = '${e}'`)},update_group:async(e,t)=>{y.query(`UPDATE users SET groupName = '${t}' WHERE userId = '${e}'`)},update_refKeyStatus:async(e,t)=>{y.query(`UPDATE users SET refKeyStatus = '${t}' WHERE userId = '${e}'`)},update_paidWhenever:async(e,t)=>{y.query(`UPDATE users SET paidWhenever = '${t}' WHERE userId = '${e}'`)},settings:{update_schedule:async function(e,t){y.query(`UPDATE users SET settingsSchedule = '${t}' WHERE userId = '${e}'`)},update_replacement:async function(e,t){y.query(`UPDATE users SET settingsReplacement = '${t}' WHERE userId = '${e}'`)},update_duty:async function(e,t){y.query(`UPDATE users SET settingsDuty = '${t}' WHERE userId = '${e}'`)}}},settings:{select:async e=>new Promise(async function(t,a){y.query(`SELECT * FROM settings WHERE type = '${e}'`,(r,s)=>{r&&a(r),t(s[0])})}),update_value:async(e,t)=>{y.query(`UPDATE settings SET value = '${e}' WHERE type = '${t}'`)},update_number:async(e,t)=>{y.query(`UPDATE settings SET number = '${e}' WHERE type = '${t}'`)}},groups:{select_all:async()=>new Promise(async function(e,t){y.query("SELECT * FROM groups",(a,r)=>{a&&t(a),e(r)})}),select_schedule:async e=>new Promise(async function(t,a){y.query(`SELECT * FROM groups WHERE name = '${e}'`,(r,s)=>{r&&a(r),t(s[0])})}),update_schedule:async(e,t)=>{y.query(`UPDATE groups SET schedule = '${t}' WHERE name = '${e}'`)}},referral:{insert:async(e,t,a)=>{y.query(`INSERT INTO referrals (agentId,userId,refKey) VALUES('${e}','${t}','${a}')`)},select_by_user:async e=>new Promise(async function(t,a){y.query(`SELECT * FROM referrals WHERE userId = '${e}'`,(r,s)=>{r&&a(r),t(s[0])})}),select_by_agent:async e=>new Promise(async function(t,a){y.query(`SELECT * FROM referrals WHERE agentId = '${e}'`,(r,s)=>{r&&a(r),t(s)})}),update_status:async(e,t)=>{y.query(`UPDATE referrals SET status = '${t}' WHERE userId = '${e}'`)}},replacement:{select_by_index:async e=>new Promise(async function(t,a){y.query("SELECT * FROM replacements",(r,s)=>{r&&a(r),t(s[Number(s.length)-1-e])})}),insert:async(e,t,a)=>{y.query(`INSERT INTO replacements (link,date,html) VALUES('${e}','${t}','${a}')`)}},gradients:{select_all_gradients:async()=>new Promise(async function(e,t){y.query("SELECT * FROM gradients",(a,r)=>{a&&t(a),e(r.map(s=>s.css))})}),select_all_replGradients:async()=>new Promise(async function(e,t){y.query("SELECT * FROM replGradients",(a,r)=>{a&&t(a),e(r.map(s=>s.css))})})},duty:{select:async(e,t,a)=>new Promise(async function(r,s){y.query(`SELECT * FROM duty WHERE \`group\` = '${e}' AND date>${t} AND date<${a}`,(l,u)=>{l&&s(l),r(u)})}),insert:async(e,t,a,r)=>{y.query(`INSERT INTO duty (\`group\`,\`date\`,\`user\`,\`name\`) values('${e}','${t}','${a}','${r}')`)}}};var A={};k(A,{regenerate:()=>Fe,sender:()=>Ge});var ae=S(require("xlsx")),L=S(require("node-html-to-image")),re=require("telegraf");async function Fe(e,t){return new Promise(async function(a){let r=await fetch(e).catch(l=>{console.log(l)}),s=[];if(!r?.ok)s="notfound";else{let l=new Date(`${t.slice(-4)}-${t.slice(3,5)}-${t.slice(0,2)}`).getTime(),u=[],c=await n.users.select_all();for(let o of c)u.indexOf(o.groupName)===-1&&o.groupName!=="null"&&u.push(o.groupName);for(let o of u){let i=await Ke(r,o);s.push({group:o,html:i,date:l})}}a(s)})}async function Ge(e){let t=await n.users.select_all();if(e==="notfound")await d.telegram.sendMessage(6018898378,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").catch(a=>{console.log(a)});else{let a=await n.gradients.select_all_gradients(),r=a[Math.floor(Math.random()*(a.length-1))];for(let s of e)if(typeof s!="string"&&s.html!==""){await n.groups.update_schedule(s.group,s.html);let l=await(0,L.default)({html:`${f.HTMLSTART1}${r}${f.HTMLSTART2}${s.html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});for(let u of t)if(u.payment!=="ban"&&e!=="notfound"&&u.settingsSchedule==="on"&&u.groupName===s.group){let c=`background-image: url(${u.theme});`,o=u.theme==="standard"?l:await(0,L.default)({html:`${f.HTMLSTART1}${c}${f.HTMLSTART2}${s.html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});await d.telegram.sendPhoto(u.userId,re.Input.fromBuffer(Buffer.from(o),"schedule.png")).then(async()=>{await p.payment.alert(u)}).catch(i=>{console.log(i)})}}}}async function Ke(e,t){let a=ae.default.read(Buffer.from(await e.clone().arrayBuffer())),r=a.SheetNames,s=a.Sheets[r[1]],l,u=[];for(let c in s)if(c.toString()[0]==="B"&&s[c].v===t){l=Number(c.slice(1))-3;for(let o=l+1;o<l+28;o++){let i=[];i.push(s[`A${o}`]?`<td><b>${s[`A${o}`].v}</b></td>`:"<td></td>"),i.push(s[`B${o}`]?`<td><b>${s[`B${o}`].v}</b></td>`:"<td></td>"),i.push(s[`C${o}`]?`<td><b>${s[`C${o}`].v}</b></td>`:"<td></td>"),i.push(s[`D${o}`]?`<td><b>${s[`D${o}`].v}</b></td>`:"<td></td>"),i.push(s[`E${o}`]?`<td><b>${s[`E${o}`].v}</b></td>`:"<td></td>"),i.push(s[`F${o}`]?`<td><b>${s[`F${o}`].v}</b></td>`:"<td></td>"),i.push(s[`G${o}`]?`<td><b>${s[`G${o}`].v}</b></td>`:"<td></td>"),u.push((o-l)%4===0?`<tr>${i.join(" ")}</tr><tr><td colspan="7" class="line"></td></tr>`:`<tr>${i.join(" ")}</tr>`)}}return u.join("")}var C={};k(C,{regenerate:()=>je,sender:()=>Ve});var se=S(require("pdf-parse")),ne=S(require("word-extractor")),H=S(require("node-html-to-image")),le=require("telegraf");var Oe=new ne.default;async function je(e,t){return new Promise(async function(a){let r=await fetch(e).catch(l=>{console.log(l)}),s={date:new Date(`${t.slice(-4)}-${t.slice(3,5)}-${t.slice(0,2)}`).getTime(),html:"null",typeFile:e.slice(-3),fileBuffer:r?.ok?Buffer.from(await r.clone().arrayBuffer()):Buffer.from([0]),link:e};if(r?.ok){let l=[],u=s.typeFile==="pdf"?(await(0,se.default)(s.fileBuffer)).text:(await Oe.extract(s.fileBuffer)).getBody(),c=(await n.groups.select_all()).map(b=>b.name),o=u.replace(/\t/g," ").split(`
`).filter(b=>!b.startsWith("\u0413\u0440\u0443\u043F\u043F\u0430")&&!b.startsWith("\u041F\u0410\u0420\u0410")&&b.replace(" ","")!==""&&!b.startsWith("\u041F\u0420\u0415\u041F\u041E\u0414\u0410\u0412\u0410\u0422\u0415\u041B\u042C")&&!b.startsWith("\u0417\u0410\u041C\u0415\u041D\u0410")&&b.replace(" ","")!=="\u041F\u041E"&&!b.startsWith("\u0420\u0410\u0421\u041F\u0418\u0421\u0410\u041D\u0418\u042E")),i=0;for(let b in o)if(o[i])if(o[i].match(/ЗАМЕНЫ/g)===null){let h="",w="",_=1;if(c.some(g=>(h=g,String(o[i]).includes(g.replace("-"," ")))),c.some(g=>(h=g,String(o[i]).includes(g)))||c.some(g=>(h=g,String(o[i]).includes(g.replace("-"," "))))?(w=[o[i]],o[i+1]&&!c.some(g=>String(o[i+1]).includes(g))&&!c.some(g=>String(o[i+1]).includes(g.replace("-"," ")))&&o[i+1].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[i+1]}`),o[i+2]&&!c.some(g=>String(o[i+2]).includes(g))&&!c.some(g=>String(o[i+2]).includes(g.replace("-"," ")))&&o[i+2].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[i+2]}`),o[i+3]&&!c.some(g=>String(o[i+3]).includes(g))&&!c.some(g=>String(o[i+3]).includes(g.replace("-"," ")))&&o[i+3].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[i+3]}`),o[i+4]&&!c.some(g=>String(o[i+4]).includes(g))&&!c.some(g=>String(o[i+4]).includes(g.replace("-"," ")))&&o[i+4].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[i+4]}`),o[i+5]&&!c.some(g=>String(o[i+5]).includes(g))&&!c.some(g=>String(o[i+5]).includes(g.replace("-"," ")))&&o[i+5].match(/ЗАМЕНЫ/g)===null&&(w.push(`${o[i+5]}`),o[i+6]&&!c.some(g=>String(o[i+6]).includes(g))&&!c.some(g=>String(o[i+6]).includes(g.replace("-"," ")))&&o[i+6].match(/ЗАМЕНЫ/g)===null&&w.push(`${o[i+6]}`)))))),_=w.length,h&&(w=w.join(" ").slice(h.length+1))):h&&(w=o[i].slice(h.length+1)),typeof w=="string"){let g=w.replace(/ +/g," ").split(/\. (?=[А-Яа-я0-9(])|\) (?=[А-Яа-я0-9(])/g).reverse()[0],D=w.replace(/ +/g," ").match(/[0-9]п([,\-])[0-9]п|[0-9]([,\-])[0-9]п|[0-9]п|[0-9]/)?.[0];D&&(w=w.replace(/ +/g," ").replace(D,"").replace(g,"")),l.push({text:`${w}`,group:h,pair:D,auditorium:g}),i+=_}}else l.push({text:`${o[i]} ${o[i+1]}`,group:"null",pair:"null",auditorium:"null"}),i+=2;s.html=await ze(l)}a(s)})}async function Ve(e){let t=await n.users.select_all(),a=await n.replacement.select_by_index(0);if(e.html!=="null"&&e.html!==a.html){await n.replacement.insert(e.link,e.date,e.html);let r=await n.gradients.select_all_replGradients(),s=r[Math.floor(Math.random()*(r.length-1))],l=await(0,H.default)({html:`${f.HTMLSTART1}${s}${f.HTMLSTART2}${e.html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});for(let u of t){let c=`background-image: url(${u.theme});`,o=u.theme==="standard"?l:await(0,H.default)({html:`${f.HTMLSTART1}${c}${f.HTMLSTART2}${e.html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});u.payment!=="ban"&&u.settingsReplacement==="on"&&await d.telegram.sendPhoto(u.userId,le.Input.fromBuffer(Buffer.from(o),"replacement.png")).then(async()=>{await p.payment.alert(u)}).catch(i=>{console.log(i)})}}else await d.telegram.sendMessage(6018898378,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B")}async function ze(e){let t=[];for(let a in e)if(e[a].group==="null")t.push(`<tr><td colspan="8"><b>${e[a].text}</b></td></tr>`),t.push('<tr><td><b>\u0413\u0440\u0443\u043F\u043F\u0430</b></td><td><b>\u041F\u0430\u0440\u0430</b></td><td colspan="2"><b>\u041F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td><td><b><===></b></td><td colspan="2"><b>\u0417\u0430\u043C\u0435\u043D\u0430</b></td><td><b>\u0410\u0443\u0434\u0438\u0442\u043E\u0440\u0438\u044F</b></td></tr>'),t.push('<tr><td colspan="8" class="line"></td></tr>');else{let r=/[А-Я][а-я]+ [А-Я].[А-Я].|\([а-я]+\)|\([А-Яа-я0-9 .]+ +[А-Яа-я0-9 .]+\)|[А-Яа-я0-9]+/g,l=e[a].text.replace(/ +/g," ").match(r),u=[],c=0;for(let i in l)if(Number(i)===c)if(l[Number(i)+1]&&l[Number(i)+1].startsWith("(")){let b=[`${l[Number(i)]}`,`
${l[Number(i)+1]}`];l[Number(i)+2]&&l[Number(i)+2].startsWith("(")&&(b.push(`
${l[Number(i)+2]}`),l[Number(i)+3]&&l[Number(i)+3].startsWith("(")&&b.push(`
${l[Number(i)+3]}`)),c+=b.length,u.push(b.join(" "))}else u.push(l[Number(i)]),c+=1;let o=`<td colspan="5"><b>${u.join(" ")}</b></td>`;u.length===1?o=`<td colspan="2"><b>${u[0]}</b></td><td><b></b></td><td colspan="2"><b></b></td>`:u.length===3?o=`<td colspan="2"><b>${u[0]}</b></td><td><b>${u[1]}</b></td><td colspan="2"><b>${u[2]}</b></td>`:u.length===2?o=`<td colspan="2"><b>${u[0]}</b></td><td><b></b></td><td colspan="2"><b>${u[1]}</b></td>`:u.length===4&&(o=`<td><b>${u[0]}</b></td><td><b>${u[1]}</b></td><td></td><td><b>${u[2]}</b></td><td><b>${u[3]}</b></td>`),e[Number(a)+1]?.group==="null"?(t.push(`<tr><td><b>${e[a].group}</b></td><td><b>${e[a].pair}</b></td>${o}<td><b>${e[a].auditorium}</b></td></tr>`),t.push('<tr><td colspan="8" class="line"></td></tr>')):t.push(`<tr><td><b>${e[a].group}</b></td><td><b>${e[a].pair}</b></td>${o}<td><b>${e[a].auditorium}</b></td></tr>`)}return await n.settings.update_value(t.join(""),"replacement"),t.join("")}var B={};k(B,{alert:()=>ie,paid:()=>Je,preAlert:()=>Xe,recount:()=>Ze,referral:()=>v});async function Ze(){let e=await n.users.select_all();for(let t of e){let a=t.price-t.price/100*(t.refAgents*6);if(t.payment==="true"&&(await n.users.update_payment(t.userId,"false"),await v(t,"false"),await d.telegram.sendMessage(t.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(a)}\u0440</b>
\u0414\u043B\u044F \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u0430 VIP \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(a*2)}\u0440, ${Math.round(a*3)}\u0440, ${Math.round(a*4)}\u0440, ${Math.round(a*5)}\u0440, ${Math.round(a*6)}\u0440)
\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)
\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435
<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>

\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 VIP2-3`,{parse_mode:"HTML"}).catch(r=>{console.log(r)})),t.payment==="false"&&(await n.users.update_payment(t.userId,"ban"),await v(t,"false"),await d.telegram.sendMessage(t.userId,`\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0437\u0430 \u043D\u0435\u0443\u043F\u043B\u0430\u0442\u0443(\u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0438\u043B\u0438 \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(a*2)}\u0440</b>)
\u{1F517}<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>`,{parse_mode:"HTML"}).catch(r=>{console.log(r)})),t.payment.startsWith("vip")){let r=t.payment.slice(3)!=="0"?`vip${Number(t.payment.slice(3))-1}`:"true";await n.users.update_payment(t.userId,r),await d.telegram.sendMessage(t.userId,`\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043C\u0435\u043D\u0435\u043D \u043D\u0430 ${r==="true"?"\u043E\u043F\u043B\u0430\u0447\u0435\u043D":r}`,{parse_mode:"HTML"}).catch(s=>{console.log(s)})}}}async function Xe(){let t=["31.01","28.02","31.03","30.04","31.05","30.06","31.07","31.08","30.09","31.10","30.11","31.12"][new Date().getMonth()],a=await n.users.select_all();for(let r of a)r.payment==="false"&&(await d.telegram.sendMessage(r.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0434\u043E ${t}, \u0438\u043D\u0430\u0447\u0435 \u0431\u0443\u0434\u0435\u0442\u0435 \u043E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u044B \u043E\u0442 \u0431\u043E\u0442\u0430`).catch(s=>{console.log(s)}),await ie(r))}async function ie(e){if(e.payment==="false"){let t=e.price-e.price/100*(e.refAgents*6);await d.telegram.sendMessage(e.userId,`\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 <b>${Math.round(t)}\u0440</b>
\u0414\u043B\u044F \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u0430 VIP \u043E\u043F\u043B\u0430\u0442\u0438\u0442\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u043D\u0430 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0435\u0441\u044F\u0446\u0435\u0432(${Math.round(t*2)}\u0440, ${Math.round(t*3)}\u0440, ${Math.round(t*4)}\u0440, ${Math.round(t*5)}\u0440, ${Math.round(t*6)}\u0440)
\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435, \u0432 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432\u0430\u0448 id (id \u043C\u043E\u0436\u043D\u043E \u0443\u0437\u043D\u0430\u0442\u044C \u0432\u0432\u0435\u0434\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u0443 /profile)
\u041F\u043E\u0441\u043B\u0435 \u043E\u043F\u043B\u0430\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 /paid \u0434\u043B\u044F \u043E\u043F\u043E\u0432\u0435\u0449\u0435\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435
<a href="https://www.tinkoff.ru/rm/korop.aleksandr4/KHtiD43274">\u0441\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u043E\u043F\u043B\u0430\u0442\u044B</a>

\u041F\u0440\u0438 \u043E\u043F\u043B\u0430\u0442\u0435 \u0437\u0430 \u0438\u044E\u043D\u044C \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 VIP2-3`,{parse_mode:"HTML"}).catch(a=>{console.log(a)})}}async function Je(){return new Promise(async function(e){let t=await n.users.select_all();t.sort((l,u)=>l.name.localeCompare(u.name));let a=[[]],r=0,s=0;for(let l of t)r%5===0&&r!==0?(s+=1,a.push([]),a[s].push({text:l.name,callback_data:`userPaid${l.userId}`}),r+=1):(a[s].push({text:l.name,callback_data:`userPaid${l.userId}`}),r+=1);e(a)})}async function v(e,t){let a=await n.referral.select_by_user(e.userId),r=t==="true"?"false":"true";if(a&&a.status===r){let s=await n.users.select(a.agentId),l=t==="true"?s.refAgents+1:s.refAgents-1;await n.referral.update_status(e.userId,t),await n.users.update_refAgents(a.agentId,l)}}var W={};k(W,{paidStatus:()=>rt,setDutyDay:()=>st,setGroup:()=>at,settings:()=>oe,userPaid:()=>Ye,userStatus:()=>et,vipStatus:()=>tt});var E=require("telegraf");async function Ye(e,t){let r=(e.callbackQuery?.data).slice(t),s=await n.users.select(r);e.editMessageText(`\u0422\u0435\u043A\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441: ${s.payment}
\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u043D\u0430:`,{reply_markup:{inline_keyboard:[[E.Markup.button.callback("true",`userStatus_true__${r}`),E.Markup.button.callback("false",`userStatus_false_${r}`),E.Markup.button.callback("free",`userStatus_free__${r}`),E.Markup.button.callback("vip",`userStatus_vip___${r}`),E.Markup.button.callback("ban",`userStatus_ban___${r}`),E.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(l=>{console.log(l)})}async function et(e){let t=e.callbackQuery?.data,a=t.slice(17),r=await n.users.select(a);if(t.slice(11).startsWith("vip"))e.editMessageText("\u0423\u0440\u043E\u0432\u0435\u043D\u044C VIP:",{reply_markup:{inline_keyboard:[[E.Markup.button.callback("VIP0",`vipStatus_0_${a}`),E.Markup.button.callback("VIP1",`vipStatus_1_${a}`),E.Markup.button.callback("VIP2",`vipStatus_2_${a}`),E.Markup.button.callback("VIP3",`vipStatus_3_${a}`),E.Markup.button.callback("VIP4",`vipStatus_4_${a}`),E.Markup.button.callback("\u21A9\uFE0F","userStatus_undo")]]}}).catch(s=>{console.log(s)});else if(t.slice(11).startsWith("ban"))await n.users.update_payment(a,"ban"),await p.payment.referral(r,"false"),await d.telegram.sendMessage(r.userId,"\u0412\u044B \u0431\u044B\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C").catch(s=>{console.log(s)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(s=>{console.log(s)});else if(t.slice(11).startsWith("undo")){let s=await p.payment.paid();e.editMessageText("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:s}}).catch(l=>{console.log(l)})}else{let s=t.slice(11).startsWith("false")?"false":t.slice(11,15);await n.users.update_payment(a,s),s!=="false"&&(await p.payment.referral(r,"true"),await n.users.update_paidWhenever(r.userId,"true")),s==="false"&&await p.payment.referral(r,"false"),await d.telegram.sendMessage(r.userId,`\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0441\u0442\u0430\u0442\u0443\u0441: ${s==="true"||s==="free"?"\u043E\u043F\u043B\u0430\u0447\u0435\u043D":"\u043D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D"}`).catch(l=>{console.log(l)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(l=>{console.log(l)})}}async function tt(e){let t=e.callbackQuery?.data,a=t.slice(12),r=await n.users.select(a),s=`vip${t.slice(10,11)}`;await n.users.update_payment(a,s),await n.users.update_paidWhenever(a,"true"),await p.payment.referral(r,"true"),await d.telegram.sendMessage(r.userId,`\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0441\u0442\u0430\u0442\u0443\u0441: ${s}`).catch(l=>{console.log(l)}),await e.telegram.answerCbQuery(String(e.callbackQuery?.id),"\u0423\u0441\u043F\u0435\u0448\u043D\u043E",{show_alert:!0}).catch(l=>{console.log(l)})}async function at(e){let t=e.callbackQuery?.data,a=e.from?.id,r=t.slice(8);a&&await n.users.update_group(a,r),await e.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u0430 \u0433\u0440\u0443\u043F\u043F\u0430: ${r}`).catch(s=>{console.log(s)})}async function rt(e){let a=(e.callbackQuery?.data).slice(10);await d.telegram.sendMessage(a,"\u041E\u0448\u0438\u0431\u043A\u0430. \u0412\u044B \u043D\u0435 \u043E\u043F\u043B\u0430\u0442\u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443!").catch(r=>{console.log(r)}),d.telegram.deleteMessage(Number(e.callbackQuery?.from.id),Number(e.callbackQuery?.message?.message_id)).catch(r=>{console.log(r)})}async function st(e){let t=e.callbackQuery?.data,a=e.from?.id,r=Number(t.slice(10)),s=new Map().set(1,"\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A").set(2,"\u0412\u0442\u043E\u0440\u043D\u0438\u043A").set(3,"\u0421\u0440\u0435\u0434\u0430").set(4,"\u0427\u0435\u0442\u0432\u0435\u0440\u0433").set(5,"\u041F\u044F\u0442\u043D\u0438\u0446\u0430").set(6,"\u0421\u0443\u0431\u0431\u043E\u0442\u0430");a&&await n.users.update_scheduleDate(a,r),await e.editMessageText(`\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D \u0434\u0435\u043D\u044C: ${s.get(r)}`).catch(l=>{console.log(l)})}var oe={keyboard:async e=>[[E.Markup.button.callback(`\u0414\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430: ${e.settingsDuty}`,`settingsDuty${e.userId}`),E.Markup.button.callback(`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${e.settingsSchedule}`,`settingsSchedule${e.userId}`),E.Markup.button.callback(`\u0417\u0430\u043C\u0435\u043D\u044B: ${e.settingsReplacement}`,`settingsReplacement${e.userId}`)]],schedule:async e=>{let t=e.callbackQuery?.data,a=await n.users.select(t.slice(16));await n.users.settings.update_schedule(a.userId,a.settingsSchedule==="on"?"off":"on"),a.settingsSchedule=a.settingsSchedule==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await oe.keyboard(a)}}).catch(r=>{console.log(r)})},replacement:async e=>{let t=e.callbackQuery?.data,a=await n.users.select(t.slice(19));await n.users.settings.update_replacement(a.userId,a.settingsReplacement==="on"?"off":"on"),a.settingsReplacement=a.settingsReplacement==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await p.callback_query.settings.keyboard(a)}}).catch(r=>{console.log(r)})},duty:async e=>{let t=e.callbackQuery?.data,a=await n.users.select(t.slice(12));await n.users.settings.update_duty(a.userId,a.settingsDuty==="on"?"off":"on"),a.settingsDuty=a.settingsDuty==="on"?"off":"on",await e.editMessageText("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await p.callback_query.settings.keyboard(a)}}).catch(r=>{console.log(r)})}};var U={};k(U,{duty:()=>nt});async function nt(e){if(e.chat?.id){let t=await n.users.select(e.chat.id),a=new Date().getTime(),r=new Date().getDay();if(r!==0&&t.payment!=="ban"&&t.dutyDate+432e5<=a){await n.duty.insert(t.groupName,a,t.userId,t.name);let s=await n.users.select_all_by_group(t.groupName);await n.users.update_duty(t.userId,t.duty+1),await n.users.update_dutyDate(t.userId,a);for(let l of s)(l.role==="admin"||l.scheduleDate===r)&&l.groupName===t.groupName&&console.log(l.scheduleDate);await e.reply("\u0423\u0441\u043F\u0435\u0448\u043D\u043E")}else await d.telegram.sendMessage(e.chat.id,"\u0421\u0435\u0433\u043E\u0434\u043D\u044F \u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435, \u0432\u044B \u0443\u0436\u0435 \u043E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B\u0438 \u0438\u043B\u0438 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B").catch(s=>{console.log(s)})}}var Q={};k(Q,{generateHTML:()=>de,sender:()=>lt});var q=S(require("node-html-to-image"));var ue=require("telegraf");async function lt(){let e=await n.users.select_all(),t=await n.gradients.select_all_gradients(),a=t[Math.floor(Math.random()*(t.length-1))],r=[],s=new Map;for(let l of e)r.indexOf(l.groupName)===-1&&l.groupName!=="null"&&r.push(l.groupName);for(let l of r){let u=await de(l,0),c=await(0,q.default)({html:`${f.HTMLSTART1}${a}${f.HTMLSTART2}${u}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});s.set(l,{html:u,standard:c})}for(let l of e)if(l.payment!=="ban"&&l.settingsDuty==="on"&&l.userId===6018898378){let u=`background-image: url(${l.theme});`,c=l.theme==="standard"?s.get(l.groupName).standard:await(0,q.default)({html:`${f.HTMLSTART1}${u}${f.HTMLSTART2}${s.get(l.groupName).html}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});await d.telegram.sendPhoto(l.userId,ue.Input.fromBuffer(Buffer.from(c),"duty.png")).then(async()=>{await p.payment.alert(l)}).catch(o=>{console.log(o)})}}async function de(e,t){let a=await n.users.select_all_by_group(e),r=[[],[],[],[],[]],s=[[],[],[],[],[]],l=[[],[],[],[],[]],u=[],c=[],o=[],i=a.sort((m,N)=>N.duty-m.duty);for(let m of a)m.scheduleDate!==-1&&r[m.scheduleDate-1].push(m.name);for(let m of i)m.scheduleDate!==-1&&l[m.scheduleDate-1].push(`${m.name}-${m.duty}`);let b=new Date(new Date().getTime()-6048e5*t),h=b.getDate()-b.getDay(),w=h+6,_=new Date(b.setDate(h)),g=new Date(b.setDate(w)),D=await n.duty.select(e,_.getTime(),g.getTime());for(let m of D){let N=new Date(m.date).getDay();s[N-1].push(m.name)}for(let m=0;m<5;m++)u.push(`<tr><td><b>${r[0]&&r[0][m]?r[0][m]:""}</b></td><td><b>${r[1]&&r[1][m]?r[1][m]:""}</b></td><td><b>${r[3]&&r[2][m]?r[2][m]:""}</b></td><td><b>${r[3]&&r[3][m]?r[3][m]:""}</b></td><td><b>${r[4]&&r[4][m]?r[4][m]:""}</b></td><td><b>${r[5]&&r[5][m]?r[5][m]:""}</b></td></tr>`),c.push(`<tr><td><b>${s[0]&&s[0][m]?s[0][m]:""}</b></td><td><b>${s[1]&&s[1][m]?s[1][m]:""}</b></td><td><b>${s[2]&&s[2][m]?s[2][m]:""}</b></td><td><b>${s[3]&&s[3][m]?s[3][m]:""}</b></td><td><b>${s[4]&&s[4][m]?s[4][m]:""}</b></td><td><b>${s[5]&&s[5][m]?s[5][m]:""}</b></td></tr>`),o.push(`<tr><td><b>${l[0]&&l[0][m]?l[0][m]:""}</b></td><td><b>${l[1]&&l[1][m]?l[1][m]:""}</b></td><td><b>${l[2]&&l[2][m]?l[2][m]:""}</b></td><td><b>${l[3]&&l[3][m]?l[3][m]:""}</b></td><td><b>${l[4]&&l[4][m]?l[4][m]:""}</b></td><td><b>${l[5]&&l[5][m]?l[5][m]:""}</b></td></tr>`);return`
<tr><td colspan="6"><b>\u0414\u0435\u0436\u0443\u0440\u043D\u044B\u0435 \u043F\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044E</b></td></tr>
<tr><td><b>\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A</b></td><td><b>\u0412\u0442\u043E\u0440\u043D\u0438\u043A</b></td><td><b>\u0421\u0440\u0435\u0434\u0430</b></td><td><b>\u0427\u0435\u0442\u0432\u0435\u0440\u0433</b></td><td><b>\u041F\u044F\u0442\u043D\u0438\u0446\u0430</b></td><td><b>\u0421\u0443\u0431\u0431\u043E\u0442\u0430</b></td></tr>
<tr><td colspan="6" class="line"></td></tr>
${u.join("")}
<tr><td colspan="6" class="line"></td></tr>
<tr><td colspan="6"><b>\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B\u0438</b></td></tr>
<tr>
<td><b>${new Date(_.getTime()+864e5*1).getDate()}.${`0${new Date(_.getTime()+864e5*1).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(_.getTime()+864e5*2).getDate()}.${`0${new Date(_.getTime()+864e5*2).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(_.getTime()+864e5*3).getDate()}.${`0${new Date(_.getTime()+864e5*3).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(_.getTime()+864e5*4).getDate()}.${`0${new Date(_.getTime()+864e5*4).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(_.getTime()+864e5*5).getDate()}.${`0${new Date(_.getTime()+864e5*5).getMonth()+1}`.slice(-2)}</b></td>
<td><b>${new Date(_.getTime()+864e5*6).getDate()}.${`0${new Date(_.getTime()+864e5*6).getMonth()+1}`.slice(-2)}</b></td>
</tr>
<tr><td colspan="6" class="line"></td></tr>
${c.join("")}
<tr><td colspan="6" class="line"></td></tr>
<tr><td colspan="6"><b>\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0434\u0435\u0436\u0443\u0440\u0441\u0442\u0432</b></td></tr>
<tr><td colspan="6" class="line"></td></tr>
${o.join("")}
`}async function ce(e){let t=e.groupName,a=e.userId,r=e.name,s=e.refKey,l=0;if(a===1177837026||a===6018898378){let h=await n.referral.select_by_agent(e.userId);for(let w of h){let _=await n.users.select(w.userId);w.status==="true"&&_.paidWhenever==="true"&&(l+=1)}await n.settings.update_number(36/100*l*39.5,"agentCost")}let u=a===1177837026||a===6018898378?38*l:6*e.refAgents,c=new Map().set(1,"\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A").set(2,"\u0412\u0442\u043E\u0440\u043D\u0438\u043A").set(3,"\u0421\u0440\u0435\u0434\u0430").set(4,"\u0427\u0435\u0442\u0432\u0435\u0440\u0433").set(5,"\u041F\u044F\u0442\u043D\u0438\u0446\u0430").set(6,"\u0421\u0443\u0431\u0431\u043E\u0442\u0430").set(-1,"\u041D\u0435 \u0437\u0430\u0434\u0430\u043D\u043E"),o=await n.groups.select_all(),i=[];for(let h of o)h.name===e.groupName?i.push(`<option selected value='${h.name}'>${h.name}</option>`):i.push(`<option value='${h.name}'>${h.name}</option>`);let b=[];for(let h=1;h<7;h++)h===e.scheduleDate?b.push(`<option selected value='${h}'>${c.get(h)}</option>`):b.push(`<option value='${h}'>${c.get(h)}</option>`);return`
<tr><td colspan="2"><b class="profileB">\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F</b></td><td><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0438\u0442\u044C</b></td></tr>
<tr><td><b class="profileB">\u0413\u0440\u0443\u043F\u043F\u0430:</b></td><td><b class="profileB">${t}</b></td><td><b class="profileB"><form name="myForm"><select class="selectP" name="selectGroup" id="selectGroup">${i.join("")}</select></form>\u25BC</b></td></tr>
<tr><td><b class="profileB">\u0418\u043C\u044F:</b></td><td><b class="profileB">${r}</b></td><td><b class="profileB">|</b><form name="myForm1"><input class="inputP" type="text" id="name" name="name" required/></form></td></tr>
<tr><td><b class="profileB">\u0414\u0435\u043D\u044C \u0434\u0435\u0436\u0443\u0440\u0441\u0442\u0432\u0430:</b></td><td><b class="profileB">${c.get(e.scheduleDate)}</b></td><td><b class="profileB"><form name="myForm2"><select class="selectP" name="selectDutyDay" id="selectDutyDay">${b.join("")}</select></form>\u25BC</b></td></tr>
<tr><td><b class="profileB">\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C id:</b></td><td><b class="profileB">${a}</b></td></tr>
<tr><td><b class="profileB">\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B:</b></td><td><b class="profileB">${e.payment==="true"?"\u041E\u043F\u043B\u0430\u0447\u0435\u043D":e.payment==="false"?"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D":e.payment}</b></td></tr>
<tr><td><b class="profileB">\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438:</b></td><td><b class="profileB">${Math.floor(e.price-e.price*(u/100))}\u0440</b></td></tr>
<tr><td><b class="profileB">\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447:</b></td><td><b class="profileB">${s}</b></td></tr>
<tr><td><b class="profileB">\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432:</b></td><td><b class="profileB">${u}%</b></td></tr>
<tr><td><b class="profileB">\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C:</b></td><td><b class="profileB">@a_korop</b></td></tr>
<tr><td colspan="2"></td><td><button onclick="update()"><b class="profileB">\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C</b></button></td></tr>
`}var x={};k(x,{notification:()=>it,theme:()=>ot});async function it(e){return`
<tr><td colspan="2"><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439</b></td></tr>
<tr><td><b class="profileB">\u041F\u043E\u044F\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u0440\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u044F:</b></td><td style="min-width: 10vw"><button onclick="updateSettingsSchedule()"><b class="profileB">${e.settingsSchedule}</b></button></td></tr>
<tr><td><b class="profileB">\u041F\u043E\u044F\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u044B\u0445 \u0437\u0430\u043C\u0435\u043D:</b></td><td style="min-width: 10vw"><button onclick="updateSettingsReplacement()"><b class="profileB">${e.settingsReplacement}</b></button></td></tr>
<tr><td><b class="profileB">\u0420\u0430\u0441\u0441\u044B\u043B\u043A\u0430 \u0442\u0430\u0431\u043B\u0438\u0446\u044B \u0434\u0435\u0436\u0443\u0440\u043D\u044B\u0445 \u0437\u0430 \u043D\u0435\u0434\u0435\u043B\u044E:</b></td><td style="min-width: 10vw"><button onclick="updateSettingsDuty()"><b class="profileB">${e.settingsDuty}</b></button></td></tr>
`}async function ot(e){return`
<tr><td colspan="3"><b class="profileB">\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0442\u0435\u043C\u044B</b></td></tr>
<tr><td><b class="profileB">BG image:</b></td><td style="min-width: 10vw"><form name="myForm"><input class="inputP" type="url" id="theme" name="theme" required/></form></td><td><button onclick="updateSettingsTheme()"><b class="profileB">\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C</b></button></td></tr>
    `}var p={schedule:A,replacement:C,payment:B,callback_query:W,hears:U,duty:Q,profile:ce,settings:x};async function me(e){e.chat?.id&&(await n.users.select(e.chat?.id)||(await n.users.insert(e.chat.id,e.from?.username,"true",e.from?.username,await ut(e.chat.id)),await d.telegram.sendMessage(6018898378,`${e.chat.id} ${e.from?.username}, \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0438\u043B\u0441\u044F \u043A \u0431\u043E\u0442\u0443`)),await e.reply(`\u0412\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0431\u043E\u0442\u0430!
\u0414\u043B\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0439 \u0440\u0430\u0431\u043E\u0442\u044B \u043F\u0440\u043E\u043F\u0438\u0448\u0438\u0442\u0435 (/setname \u0432\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F) \u0438 (/setgroup).
\u0412\u044B \u0442\u0430\u043A\u0436\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0432\u0432\u0435\u0441\u0442\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447 \u043A\u043E\u043C\u0430\u043D\u0434\u043E\u0439 (/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447), \u0432\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u0435 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 \u043C\u0435\u0441\u044F\u0446 \u0431\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`))}async function ut(e){return e<0?"null":e.toString().split("").map(Number).map(t=>(t||10)+64).map(t=>String.fromCharCode(Number(t))).join("")}async function pe(e){let{text:t}=e;if(t=t?.slice(6),e.chat?.id===6018898378&&t&&!t.startsWith("monica_schedule_bot")){let a=await n.users.select_all();for(let r of a)r.payment!=="ban"&&(await d.telegram.sendMessage(r.userId,t).catch(s=>{console.log(s)}),await p.payment.alert(r))}else await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function fe(e){await e.reply("\u041D\u0435 \u0443\u0434\u0430\u043B\u044F\u0439\u0442\u0435 \u044D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435!",{reply_markup:{resize_keyboard:!0,keyboard:[["\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B"]]}})}async function ge(e,t){if(e===6018898378){let a=[],r=(await n.settings.select("scheduleLink")).value,s=(await n.settings.select("replacementLink")).value,l=await(await fetch("http://rgkript.ru/raspisanie-zanyatiy/")).text(),u=new RegExp('<a href="http:\\/\\/rgkript.ru\\/wp-content\\/uploads\\/\\/'+new Date().getFullYear()+'[0-9/.\\-A-Za-z_]+"',"g"),c=Array.from(new Set(l.match(u))).map(i=>i.slice(9,-1)),o=l.match(/<strong>[А-Яа-я0-9. ]+/g);if(o)for(let i of o)i.match(/[0-9]+.[0-9]+.[0-9]+/g)&&a.push(i[0]);c[0]!==r?(await n.settings.update_value(c[0],"scheduleLink"),await d.telegram.sendMessage(e,`\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435: ${a[0]} ${c[0].slice(36)}`).then(i=>{setTimeout(()=>{d.telegram.deleteMessage(i.chat.id,i.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(i=>{console.log(i)}),await p.schedule.regenerate(c[0],a[0]).then(async i=>{await p.schedule.sender(i)})):await d.telegram.sendMessage(e,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E").then(i=>{setTimeout(()=>{d.telegram.deleteMessage(i.chat.id,i.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(i=>{console.log(i)}),c[1]!==s?(await n.settings.update_value(c[1],"replacementLink"),await d.telegram.sendMessage(e,`\u0417\u0430\u043C\u0435\u043D\u044B: ${a[1]} ${c[1].slice(36)}`).then(i=>{setTimeout(()=>{d.telegram.deleteMessage(i.chat.id,i.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(i=>{console.log(i)}),await p.replacement.regenerate(c[1],a[1]).then(async i=>{await p.replacement.sender(i)})):await d.telegram.sendMessage(e,"\u0417\u0430\u043C\u0435\u043D\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B").then(i=>{setTimeout(()=>{d.telegram.deleteMessage(i.chat.id,i.message_id).catch(b=>{console.log(b)})},1e3*30)}).catch(i=>{console.log(i)})}else await t.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function be(e){if(e.chat?.id){let t=await n.users.select(e.chat.id);t?t.userId>0?(await d.telegram.sendMessage(6018898378,`${t.name}(${t.userId}) \u043E\u043F\u043E\u0432\u0435\u0441\u0442\u0438\u043B \u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u0435, \u0441\u0442\u0430\u0442\u0443\u0441: ${t.payment}`,{reply_markup:{inline_keyboard:[[{text:"\u041D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`paidStatus${t.userId}`},{text:"\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E",callback_data:`userPaid${t.userId}`}]]}}),await e.reply("\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0443 \u043E\u043F\u043B\u0430\u0442\u044B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D, \u043E\u0436\u0438\u0434\u0430\u0439\u0442\u0435")):await e.reply("\u041E\u0448\u0438\u0431\u043A\u0430. \u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B"):await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function ye(e){if(console.log(e.chat?.id),e.chat?.id){console.log(1);let t=await n.users.select(e.chat.id);if(t){let a=t.groupName,r=t.userId,s=t.name,l=t.refKey,u=0;if(r===1177837026||r===6018898378){let o=await n.referral.select_by_agent(t.userId);for(let i of o){let b=await n.users.select(i.userId);i.status==="true"&&b.paidWhenever==="true"&&(u+=1)}await n.settings.update_number(36/100*u*39.5,"agentCost")}let c=r===1177837026||r===6018898378?38*u:6*t.refAgents;await e.reply(`\u0413\u0440\u0443\u043F\u043F\u0430: <b>${a}</b>
Id: \u{1F517}<code>${r}</code>
\u0424\u0430\u043C\u0438\u043B\u0438\u044F: <b>${s}</b>
\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u043F\u043B\u0430\u0442\u044B: <b>${t.payment==="true"?"\u043E\u043F\u043B\u0430\u0447\u0435\u043D":t.payment==="false"?"\u043D\u0435 \u043E\u043F\u043B\u0430\u0447\u0435\u043D":t.payment}</b>
\u0421\u0443\u043C\u043C\u0430 \u043E\u043F\u043B\u0430\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043A\u0438: <b>${Math.floor(t.price-t.price*(c/100))}</b>
\u0420\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447: \u{1F517}<code>${l}</code>
\u0411\u043E\u043D\u0443\u0441 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u043E\u0432: <b>${c}%</b>
\u0421\u0432\u044F\u0437\u044C \u0441 \u0430\u0434\u043C\u0438\u043D\u043E\u043C: @a_korop`,{parse_mode:"HTML"})}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function he(e){if(e.chat?.id){let t=await n.users.select(e.chat.id),{text:a}=e;if(t)if(t.refKeyStatus==="false"){let r=a?.slice(10);if(r){let s=await n.users.select_refAgents_by_refKey(r);s?t.userId!==s.userId?(await n.users.update_refKeyStatus(t.userId,"true"),await n.users.update_payment(t.userId,"vip0"),await n.users.update_refAgents(s.userId,s.refAgents+1),await n.referral.insert(s.userId,t.userId,r),await e.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447!
\u0412\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u0438 \u0434\u043E\u0441\u0442\u0443\u043F \u043A\u043E \u0432\u0441\u0435\u043C \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C \u043D\u0430 2 \u043C\u0435\u0441\u044F\u0446\u0430 (\u0434\u043E 1-\u0433\u043E \u0447\u0438\u0441\u043B\u0430 2-\u0433\u043E \u043C\u0435\u0441\u044F\u0446\u0430)`)):await e.reply("\u0412\u044B \u043D\u0435 \u043C\u043E\u0436\u0435\u0442\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u0441\u0432\u043E\u0439 \u0436\u0435 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447"):await e.reply(`\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u0430\u0433\u0435\u043D\u0442 \u0434\u043B\u044F \u043A\u043B\u044E\u0447\u0430: ${r}`)}else await e.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447(/referral \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447)")}else await e.reply("\u0412\u044B \u0443\u0436\u0435 \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0440\u0435\u0444\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043B\u044E\u0447, \u043B\u0438\u0431\u043E \u043E\u043F\u043B\u0430\u0447\u0438\u0432\u0430\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443 \u0440\u0430\u043D\u0435\u0435");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}var we=require("telegraf"),$e=S(require("node-html-to-image"));async function _e(e){if(e.chat?.id){let t=await n.users.select(e.chat?.id);if(t)if(t.payment!=="ban"){let a=(await n.replacement.select_by_index(0)).html,r=await n.gradients.select_all_replGradients(),s=t.theme==="standard"?r[Math.floor(Math.random()*(r.length-1))]:`background-image: url(${t.theme});`,l=await(0,$e.default)({html:`${f.HTMLSTART1}${s}${f.HTMLSTART2}${a}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});await e.replyWithPhoto(we.Input.fromBuffer(Buffer.from(l),"schedule.png")),await p.payment.alert(t)}else await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Te(e){e.chat?.id===6018898378?(await e.reply("\u0411\u043E\u0442 \u0432\u044B\u043A\u043B\u044E\u0447\u0435\u043D!"),setTimeout(()=>{process.exit(0)},1e3*60)):await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}var Ee=require("telegraf");var Se=S(require("node-html-to-image"));async function ke(e){if(e.chat?.id){let t=await n.users.select(e.chat.id);if(t)if(t.payment!=="ban")if(t.groupName!=="null"){let a=(await n.groups.select_schedule(t.groupName)).schedule;if(a!=="null"){let r=await n.gradients.select_all_gradients(),s=t.theme==="standard"?r[Math.floor(Math.random()*(r.length-1))]:`background-image: url(${t.theme});`,l=await(0,Se.default)({html:`${f.HTMLSTART1}${s}${f.HTMLSTART2}${a}${f.HTMLEND}`,puppeteerArgs:f.PUPPETEER});await e.replyWithPhoto(Ee.Input.fromBuffer(Buffer.from(l),"schedule.png")),await p.payment.alert(t)}else await e.reply("\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B\u043E \u0441\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u043E")}else await e.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443 /setgroup");else await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C");else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function De(e){if(e.chat?.id)if(await n.users.select(e.chat.id)){let a=await n.groups.select_all(),r=[[]],s=0,l=0;for(let u of a)s%5===0&&s!==0?(l+=1,r.push([]),r[l].push({text:u.name,callback_data:`setGroup${u.name}`}),s+=1):(r[l].push({text:u.name,callback_data:`setGroup${u.name}`}),s+=1);await e.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u0440\u0443\u043F\u043F\u0443:",{reply_markup:{inline_keyboard:r}})}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}async function Me(e){if(e.chat?.id){let t=await n.users.select(e.chat.id),{text:a}=e;if(t){let r=a?.slice(9);r?(await n.users.update_name(t.userId,r),await e.reply(`\u0412\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F - ${r}`)):await e.reply("\u0412\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043B\u0438 \u0444\u0430\u043C\u0438\u043B\u0438\u044E(/setname \u0432\u0430\u0448\u0430 \u0444\u0430\u043C\u0438\u043B\u0438\u044F)")}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Ie(e){if(e.chat?.id){let t=await n.users.select(e.chat?.id);t?await e.reply("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",{reply_markup:{inline_keyboard:await p.callback_query.settings.keyboard(t)}}):await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}}async function Pe(e){if(e.chat?.id===6018898378){let t=await p.payment.paid();await e.reply("\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043B\u044F:",{reply_markup:{inline_keyboard:t}})}else await e.reply("\u041D\u0430\u043F\u0438\u0441\u0430\u043D\u043E \u0436\u0435 \u0414\u041B\u042F \u0410\u0414\u041C\u0418\u041D\u041E\u0412")}async function Re(e){if(e.chat?.id){let t=await n.users.select(e.chat?.id),{text:a}=e,r=a?.slice(7);t.payment!=="ban"?t&&r&&!r.startsWith("monica_schedule_bot")&&r.match(/\.(jpeg|jpg|png)$/)!=null?(await n.users.update_theme(t.userId,r),await e.reply(`\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0442\u0435\u043C\u0430: ${r}`)):await e.reply("\u041E\u0448\u0438\u0431\u043A\u0430, \u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0432\u044B \u043D\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0432 \u0431\u043E\u0442\u0435, \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443, \u043A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0438\u0437 \u0433\u0440\u0443\u043F\u043F\u044B \u0438\u043B\u0438 \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0435 \u0432\u0435\u0434\u0435\u0442 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443"):await e.reply("\u0412\u044B \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C")}}async function Ne(e){if(e.chat?.id)if(await n.users.select(e.chat.id)){let a=[{name:"\u041F\u043D\u0434",value:1},{name:"\u0412\u0442\u0440",value:2},{name:"\u0421\u0440\u0434",value:3},{name:"\u0427\u0442\u0432",value:4},{name:"\u041F\u0442\u043D",value:5},{name:"\u0421\u0431\u0442",value:6}],r=[[]];for(let s of a)r[0].push({text:s.name,callback_data:`setDutyDay${s.value}`});await e.reply("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u043D\u044C:",{reply_markup:{inline_keyboard:r}})}else await e.reply("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C \u0432 \u0431\u043E\u0442\u0435 /start")}var T={start:me,send:pe,duty:fe,fetch:ge,paid:be,profile:ye,referral:he,replacement:_e,restart:Te,schedule:ke,setGroup:De,setName:Me,settings:Ie,status:Pe,theme:Re,setDutyDay:Ne};var R=require("fs"),d=new Le.Telegraf(f.TOKEN);d.launch();d.telegram.sendMessage(6018898378,"\u0411\u043E\u0442 \u0437\u0430\u043F\u0443\u0449\u0435\u043D!").then(e=>setTimeout(()=>{d.telegram.deleteMessage(e.chat.id,e.message_id)},30*1e3)).catch(e=>{console.log(e)});var $=(0,Ae.default)();$.use((0,He.default)());$.get("/",(e,t)=>{t.sendFile(M.join(__dirname+"/html/index.html"))});$.get("/scheduleTable/[0-9]+",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(15))),r=await n.groups.select_schedule(a.groupName);t.send({table:r.schedule})});$.get("/replacementTable/[0-9]+",async(e,t)=>{let a=await n.replacement.select_by_index(Number(e.url.slice(18))),r=a?a.html:null;t.send({table:r})});$.get("/dutyTable/[0-9]+/[0-9]+",async(e,t)=>{let a=e.url.match(/[0-9]+/g);if(!a)return;let r=await n.users.select(Number(a[0])),s=await p.duty.generateHTML(r.groupName,Number(a[1]));t.send({table:s})});$.get("/randomGradient/[0-9]+",async(e,t)=>{let a=(await n.users.select(Number(e.url.slice(16)))).theme,r=await n.gradients.select_all_gradients(),s=r[Math.floor(Math.random()*(r.length-1))];t.send({gradient:a==="standard"?s.slice(11,-1):a})});$.get("/selectGroup/[0-9]+",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(13))),r=await n.groups.select_all(),s=[],l=[];for(let u of r)u.name===a.groupName?s.push(`<option selected value='${u.name}'>${u.name}</option>`):u.schedule==="null"?l.push(`<option disabled value='${u.name}'>${u.name}</option>`):s.push(`<option value='${u.name}'>${u.name}</option>`);t.send({table:s.concat(l).join("")})});$.get("/updateGroup/[0-9%A-Za-z-]+",async(e,t)=>{let a=await n.groups.select_schedule(decodeURI(e.url.slice(13)));t.send({table:a.schedule})});$.get("/profile",async(e,t)=>{t.send({body:(0,R.readFileSync)(M.join(__dirname+"/html/profile.html"),"utf-8")})});$.get("/settings",async(e,t)=>{t.send({body:(0,R.readFileSync)(M.join(__dirname+"/html/settings.html"),"utf-8")})});$.get("/home",async(e,t)=>{t.send({body:(0,R.readFileSync)(M.join(__dirname+"/html/home.html"),"utf-8")})});$.get("/profile/[0-9]+",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(9))),r=await p.profile(a);t.send({table:r})});$.get("/settingsNotification/[0-9]+",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(22))),r=await p.settings.notification(a);t.send({table:r})});$.get("/settingsNotification/schedule/[0-9]+",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(31))),r=a.settingsSchedule==="on"?"off":"on";await n.users.settings.update_schedule(a.userId,r),a.settingsSchedule=r;let s=await p.settings.notification(a);t.send({table:s})});$.get("/settingsNotification/replacement/[0-9]+",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(34))),r=a.settingsReplacement==="on"?"off":"on";await n.users.settings.update_replacement(a.userId,r),a.settingsReplacement=r;let s=await p.settings.notification(a);t.send({table:s})});$.get("/settingsNotification/duty/[0-9]+",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(27))),r=a.settingsDuty==="on"?"off":"on";await n.users.settings.update_duty(a.userId,r),a.settingsDuty=r;let s=await p.settings.notification(a);t.send({table:s})});$.get("/settingsTheme/bg",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(18).match(/[0-9]+/)[0])),r;console.log(e.body);try{r=decodeURI(e.body.url),r=r.match(/\.(jpeg|jpg|png)$/)!=null?r:"standard"}catch{r="standard"}console.log(r,a.userId.toString().length),await n.users.update_theme(a.userId,r);let s=await p.settings.theme(a);t.send({table:s})});$.get("/settingsTheme/[0-9]+",async(e,t)=>{let a=await n.users.select(Number(e.url.slice(15))),r=await p.settings.theme(a);t.send({table:r})});$.get("/editGroup/[0-9]+/[0-9%A-Za-z-]+",async(e,t)=>{let a=e.url.slice(11).match(/[0-9]+/g),r=e.url.slice(11).match(/[0-9%A-Za-z\-]+/g),s=await n.users.select(Number(a[0]));await n.users.update_group(s.userId,decodeURI(r[1])).then(()=>{t.send()})});$.get("/editDutyDay/[0-9]+/[0-9]+",async(e,t)=>{let a=e.url.slice(13).match(/[0-9]+/g),r=await n.users.select(Number(a[0]));await n.users.update_scheduleDate(r.userId,a[1]).then(()=>{t.send()})});$.get("/editName/[0-9]+/[0-9%A-Za-z-]+",async(e,t)=>{let a=e.url.slice(10).match(/[0-9]+/g),r=e.url.slice(10).match(/[0-9%A-Za-z\-]+/g),s=await n.users.select(Number(a[0]));await n.users.update_name(s.userId,decodeURI(r[1])).then(()=>{t.send()})});var dt=Ce.createServer($);dt.listen(3e3,"46.23.96.113");d.command("start",e=>{T.start(e)});d.command("fetch",e=>{T.fetch(e.chat.id,e)});d.command("send",e=>{T.send(e)});d.command("schedule",e=>{T.schedule(e)});d.command("theme",e=>{T.theme(e)});d.command("status",e=>{T.status(e)});d.command("settings",e=>{T.settings(e)});d.command("profile",e=>{console.log("111"),T.profile(e)});d.command("setname",e=>{T.setName(e)});d.command("setgroup",e=>{T.setGroup(e)});d.command("referral",e=>{T.referral(e)});d.command("paid",e=>{T.paid(e)});d.hears("\u041E\u0442\u0434\u0435\u0436\u0443\u0440\u0438\u043B",e=>{p.hears.duty(e)});d.command("replacement",e=>{T.replacement(e)});d.command("restart",e=>{T.restart(e)});d.command("duty",e=>{T.duty(e)});d.command("setdutydate",e=>{T.setDutyDay(e)});d.on("callback_query",async e=>{let t=e.callbackQuery?.data;t.startsWith("userPaid")?await p.callback_query.userPaid(e,8):t.startsWith("paidStatus")?await p.callback_query.paidStatus(e):t.startsWith("userStatus")?await p.callback_query.userStatus(e):t.startsWith("vipStatus")?await p.callback_query.vipStatus(e):t.startsWith("settings")?t.startsWith("settingsSchedule")?await p.callback_query.settings.schedule(e):t.startsWith("settingsReplacement")?await p.callback_query.settings.replacement(e):t.startsWith("settingsDuty")&&await p.callback_query.settings.duty(e):t.startsWith("setGroup")?await p.callback_query.setGroup(e):t.startsWith("setDutyDay")&&await p.callback_query.setDutyDay(e)});P.CronJob.from({cronTime:"0 10 14 * * 1-5,7",onTick:async()=>{await T.fetch(6018898378)},start:!0});P.CronJob.from({cronTime:"0 0 13 1 * *",onTick:async()=>{await p.payment.recount().catch(e=>{console.log(e)})},start:!0});P.CronJob.from({cronTime:"0 35 7 25-31 * *",onTick:async()=>{await p.payment.preAlert().catch(e=>{console.log(e)})},start:!0});0&&(module.exports={bot});
