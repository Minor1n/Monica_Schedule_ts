<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Monica Schedule</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        html{width:100vw;min-height: 100vh;scrollbar-width: none;}
        body{
            margin: 0;
            font-family: Arial, sans-serif;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
        }
        div{width:100%;}
        .buf{
            height: 12vw;
        }
        .fill{
            background-color: rgb(0,0,0,0.2);
            min-height: 100%;
            width: 100%;
        }
        table{
            padding: 1vw;
            width: 100%;
        }
        td{
            background-color: rgba(255,255,255,0.70);
            text-align: center;
            height: 3.5vw;
        }
        b{font-size: 2vw; margin:0.5vw;}
        .line{background-color: rgb(0,0,0,0.0); height: 1vw;}
        .title{font-size: 5vw;}
        .title b{font-size: 5vw;}
        .profileB{font-size: 3vw}

        button{
            border: none;
            background: none;
            padding:0;
        }
        .arrow svg {
            width:5vw;
            height: auto;
            margin: 0 2rem;
            cursor: pointer;
            overflow: visible;
        }
        .arrow svg polygon,
        .arrow svg path {
            transition: all 0.5s cubic-bezier(0.2, 1, 0.3, 1);
            fill: #000;
        }
        .arrow svg:hover polygon,
        .arrow svg:hover path {
            transition: all 1s cubic-bezier(0.2, 1, 0.3, 1);
            fill: #000;
        }
        .arrow svg:hover .arrow-pl {
            animation: arrow-anim 1s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .arrow svg:hover .arrow-pl-fixed {
            animation: arrow-fixed-anim 1s cubic-bezier(0.2, 1, 0.3, 1);
        }

        @keyframes arrow-anim {
            0% {
                opacity: 1;
                transform: translateX(0);
            }
            5% {
                transform: translateX(-0.1rem);
            }
            100% {
                transform: translateX(1rem);
                opacity: 0;
            }
        }
        @keyframes arrow-fixed-anim {
            5% {
                opacity: 0;
            }
            20% {
                opacity: 0.4;
            }
            100% {
                opacity: 1;
            }
        }

        select{
            all: unset;
            scrollbar-width: none;
            font-size: 5vw;
        }
        form{
            display: inline;
        }

        .mobile-nav {
            background: rgba(255,255,255,0.70);
            position: fixed;
            bottom: 0;
            height: 12vw;
            width: 100%;
            display: flex;
            justify-content: space-around;
        }
        .bloc-icon {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .bloc-icon svg {
            width: 8vw;
            height: auto;
        }

        .inputP,.selectP{
            all: unset;
            scrollbar-width: none;
            font-size: 3vw;
        }
    </style>
    <script>
        let replacementPage = 0
        let dutyPage = 0
        let u = 'https://www.minorin.ru'
        let tg = window.Telegram.WebApp;
        let user = tg?.initDataUnsafe?.user?.id ? tg.initDataUnsafe.user.id:alert('Вы не можете использовать monica_schedule в браузере')
        fetch(`${u}/randomGradient/${user}`).then(req=>{
            req.json().then(res=>{
                document.body.style.backgroundImage = String(res.gradient)
            })
        })
        home()
        function profile() {
            fetch(`${u}/profile`).then(req=>{
                req.json().then(res=>{
                    document.body.innerHTML = res.body
                    fetch(`${u}/profile/${user}`).then(req=>{
                        req.json().then(res=>{
                            document.getElementById("profile").innerHTML = `<table>${res.table}</table>`
                        })
                    })
                })
            })
        }
        function settings() {
            fetch(`${u}/settings`).then(req=>{
                req.json().then(res=>{
                    document.body.innerHTML  = res.body
                    fetch(`${u}/settings/notification/${user}`).then(req=>{
                        req.json().then(res=>{
                            document.getElementById("settingsNotification").innerHTML = `<table>${res.table}</table>`
                        })
                    })
                    fetch(`${u}/settings/theme/${user}`).then(req=>{
                        req.json().then(res=>{
                            document.getElementById("settingsTheme").innerHTML = `<table>${res.table}</table>`
                        })
                    })
                })
            })
        }
        function home() {
            fetch(`${u}/home/${user}`).then(req=>{
                req.json().then(res=>{
                    document.body.innerHTML  = res.body

                    fetch(`${u}/home/scheduleTable/${user}`).then(req=>{
                        req.json().then(res=>{
                            document.getElementById("schedule").innerHTML = `<table>${res.table}</table>`
                        })
                    })

                    fetch(`${u}/home/replacementTable/${replacementPage}`).then(req=>{
                        req.json().then(res=>{
                            document.getElementById("replacement").innerHTML = `<table>${res.table}</table>`
                        })
                    })

                    fetch(`${u}/home/dutyTable/${user}/${dutyPage}`).then(req=>{
                        req.json().then(res=>{
                            document.getElementById("duty").innerHTML = `<table>${res.table}</table>`
                        })
                    })

                    fetch(`${u}/home/scheduleTable/selectGroup/${user}`).then(req=>{
                        req.json().then(res=>{
                            document.getElementById("selectGroup").innerHTML = `${res.table}`
                        })
                    })
                })
            })
        }
        function updateSettingsSchedule(){
            fetch(`${u}/settings/notification/schedule/${user}`).then(req=>{
                req.json().then(res=>{
                    document.getElementById("settingsNotification").innerHTML = `<table>${res.table}</table>`
                })
            })
        }
        function updateSettingsReplacement(){
            fetch(`${u}/settings/notification/replacement/${user}`).then(req=>{
                req.json().then(res=>{
                    document.getElementById("settingsNotification").innerHTML = `<table>${res.table}</table>`
                })
            })
        }
        function updateSettingsDuty(){
            fetch(`${u}/settings/notification/duty/${user}`).then(req=>{
                req.json().then(res=>{
                    document.getElementById("settingsNotification").innerHTML = `<table>${res.table}</table>`
                })
            })
        }
        function updateSettingsTheme() {
            let url = document.querySelector("input").value
            console.log(url)
            fetch(`${u}/settings/theme/bg?user=${user}&url=${url}`,{
                method:'POST'
            }).then(()=>{
                fetch(`${u}/settings/theme/${user}`).then(req=>{
                    req.json().then(res=>{
                        document.getElementById("settingsTheme").innerHTML = `<table>${res.table}</table>`
                        fetch(`${u}/randomGradient/${user}`).then(req=>{
                            req.json().then(res=>{
                                document.body.style.backgroundImage = String(res.gradient)
                            })
                        })
                    })
                })
            })
        }
        function updateSettingsThemeStandard() {
            let url = document.querySelector("input").value
            fetch(`${u}/settings/theme/bg?user=${user}&url=standard`,{
                method:'POST'
            }).then(()=>{
                fetch(`${u}/settings/theme/${user}`).then(req=>{
                    req.json().then(res=>{
                        document.getElementById("settingsTheme").innerHTML = `<table>${res.table}</table>`
                        fetch(`${u}/randomGradient/${user}`).then(req=>{
                            req.json().then(res=>{
                                document.body.style.backgroundImage = String(res.gradient)
                            })
                        })
                    })
                })
            })
        }
        function updateSettingsLightMode() {
            fetch(`${u}/settings/theme/lightMode?user=${user}`,{
                method:'POST'
            }).then(()=>{
                fetch(`${u}/settings/theme/${user}`).then(req=>{
                    req.json().then(res=>{
                        document.getElementById("settingsTheme").innerHTML = `<table>${res.table}</table>`
                        fetch(`${u}/randomGradient/${user}`).then(req=>{
                            req.json().then(res=>{
                                document.body.style.backgroundImage = String(res.gradient)
                            })
                        })
                    })
                })
            })
        }
        function changePage(i){
            if(replacementPage+i<0){alert('Замены не найдены!')}
            else{
                fetch(`${u}/home/replacementTable/${replacementPage+i}`).then(req=>{
                    req.json().then(res=>{
                        if(res.table!==null){
                            replacementPage += i
                            document.getElementById("replacement").innerHTML = `<table>${res.table}</table>`
                        }else{
                            alert('Замены не найдены!')
                        }
                    })
                })
            }
        }

        function changePageDuty(i){
            if(dutyPage+i<0){alert('Дежурства не найдены!')}
            else{
                fetch(`${u}/home/dutyTable/${user}/${dutyPage+i}`).then(req=>{
                    req.json().then(res=>{
                        if(res.table!==null){
                            dutyPage += i
                            document.getElementById("duty").innerHTML = `<table>${res.table}</table>`
                        }else{
                            alert('Дежурства не найдены!')
                        }
                    })
                })
            }
        }

        function changeOption(){
            let sGroup = document.myForm.selectGroup
            const selectedOption = sGroup.options[sGroup.selectedIndex];
            console.log(selectedOption.value)
            fetch(`${u}/home/scheduleTable/updateGroup/${selectedOption.value}`).then(req=>{
                req.json().then(res=>{
                    document.getElementById("schedule").innerHTML = `<table>${res.table}</table>`
                })
            })
        }

        async function update(){
            let group = document.myForm.selectGroup
            let dutyDay = document.myForm2.selectDutyDay
            let name = document.querySelector("input").value
            const selectedGroup = group.options[group.selectedIndex].value
            const selectedDutyDay = dutyDay.options[dutyDay.selectedIndex].value
            await fetch(`${u}/profile/editDutyDay/${user}/${selectedDutyDay}`).then(async ()=>{
                await fetch(`${u}/profile/editGroup/${user}/${selectedGroup}`).then(async ()=>{
                    if(name!==''){
                        await fetch(`${u}/profile/editName/${user}/${name}`).then(async ()=>{
                            fetch(`${u}/profile/${user}`).then(req=>{
                                req.json().then(res=>{
                                    document.getElementById("profile").innerHTML = `<table>${res.table}</table>`
                                })
                            })
                        })
                    }else{
                        fetch(`${u}/profile/${user}`).then(req=>{
                            req.json().then(res=>{
                                document.getElementById("profile").innerHTML = `<table>${res.table}</table>`
                            })
                        })
                    }
                })
            })
        }
    </script>
</head>
<body>
</body>
</html>